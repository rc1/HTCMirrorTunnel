"use strict";function makeWebSocketClient(e){return W.promise(function(n,t){console.log("Connecting to websocket client:",e.wsUrl),e.wsClient=new W.JSONSocketConnection({socketUrl:e.wsUrl});var r=once(function(){$("[data-disconnected-warning]").remove(),report("CONNECTED","to:",e.wsUrl),n(e)});e.wsClient.on("open",r),e.wsClient.on("error",makeReporter("Web Socket Error")),e.wsClient.on("close",makeReporter("Web Socket Close")),e.wsClient.openSocketConnection()})}function subscribeToHostControlMode(e){return W.promise(function(n,t){e.controlMode="",RestesqueUtil.subscribeWithInitialGet(e.wsClient,"/host/control/mode/",function(n){e.controlMode=n.getBody(),console.log("Control Mode Change to:",e.controlMode)}).success(function(){n(e)})})}function addPunterCid(e){return W.promise(function(n,t){e.punterCid=$("[data-punter-cid]").data("punterCid"),n(e)})}function makePunterVizs(e){return W.promise(function(n,t){$("[data-punter-viz]").toArray().map(function(n){e.punterViz=PunterViz.makeViz(),e.punterViz.containerEl=n;PunterViz.initViz(e.punterViz).error(function(e){console.error("Failed to create Punter app",e)}).success(function(n){if(window.location.search.indexOf("debug")>-1){var t=document.createElement("input");t.setAttribute("type","range"),t.setAttribute("min",-1),t.setAttribute("max",1),t.setAttribute("step",.01),t.setAttribute("value",.25),t.setAttribute("style","position: absolute"),$(t).asEventStream("change").map(function(e){return e.currentTarget}).map(function(e){return $(e).val()}).onValue(function(e){return PunterViz.setVelocity(n,null,e,null)}),$("#punter").prepend(t)}var r=25.714285714,o=$(window).asEventStream("deviceorientation").map(function(e){return e.originalEvent.gamma});o.map(function(e){return-r>e?"backward":e>r?"forward":"none"}).skipDuplicates().throttle(100).onValue(function(n){"phone-"+e.punterCid===e.controlMode&&RestesqueUtil.post(e.wsClient,"/motor/rotation/direction/",n)}),o.map(function(e){return Math.abs(e)}).map(function(e){return e>90-r?"high":e>90-2*r?"medium":"low"}).throttle(100).onValue(function(n){"phone-"+e.punterCid===e.controlMode&&RestesqueUtil.post(e.wsClient,"/motor/rotation/speed/",n)}),console.log("Punter application made")})}),n(e)})}function makeRestRadioButtons(e){return W.promise(function(n,t){$('[data-rest-type="radio-post"]').toArray().map($).map(function(n){var t=n.parent();t.on("click touchend",function(t){return t.preventDefault(),console.log("sending",n.val(),"to",n.data("restUri")),RestesqueUtil.post(e.wsClient,n.data("restUri"),n.val()),!1})}),$('[data-rest-type="feildset"]').toArray().map($).map(function(n){var t=n.find('input[type="radio"]').checkboxradio();console.log("got a field set",n.data("restUri")),RestesqueUtil.subscribeWithInitialGet(e.wsClient,n.data("restUri"),function(e){t.prop("checked",!1).checkboxradio("refresh").filter('input[value="'+e.getBody()+'"]').attr("checked","checked").checkboxradio("refresh").parent().find("label").removeClass("ui-radio-off").addClass("ui-radio-on")})}),n(e)})}function once(e){var n=!1;return function(){n||(e(),n=!0)}}function report(e,n){console.log("[",e,"]",W.rest(W.toArray(arguments)).join(" "))}function makeReporter(e,n){var t=arguments;return function(){report.apply(this,t);var e=arguments;return W.promise(function(n,t){n.apply(this,e)})}}var PunterViz=function(){function e(){return{containerEl:document.createElement("div"),backroundColor:6382180,velocity:[0,0,0],preRenderFns:[],preCubeCamRenderFns:[],postCubeCamRenderFns:[]}}function n(e){return W.promise(function(n,t){e.camera=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,1,3e3),l(e,0,0,200),e.scene=new THREE.Scene,e.renderer=new THREE.WebGLRenderer({antialias:!1}),e.renderer.setPixelRatio(window.devicePixelRatio),e.renderer.setSize(window.innerWidth,window.innerHeight),e.renderer.setClearColor(e.backgroundColor),e.renderer.sortObjects=!1,e.containerEl.appendChild(e.renderer.domElement),n(e)})}function t(e){return W.promise(function(n,t){var r=document.createElement("video");r.autoplay=!0,navigator.webkitGetUserMedia({video:!0},function(e){r.src=URL.createObjectURL(e)},function(e){console.log("Failed to get a stream due to",e)}),e.webCamTexture=new THREE.Texture(r),e.webCamTexture.minFilter=THREE.LinearFilter,u(e,function(n,t){r.readyState===r.HAVE_ENOUGH_DATA&&(e.webCamTexture.needsUpdate=!0)}),n(e)})}function r(e){return W.promise(function(n,t){e.cubeCamera=new THREE.CubeCamera(1,3e3,256),e.cubeCamera.renderTarget.minFilter=THREE.LinearMipMapLinearFilter,u(e,function(n,t){e.preCubeCamRenderFns.forEach(function(e){return e(n,t)}),e.cubeCamera.updateCubeMap(e.renderer,e.scene),e.postCubeCamRenderFns.forEach(function(e){return e(n,t)})}),n(e)})}function o(e){return W.promise(function(n,t){e.webCamMaterial=new THREE.MeshBasicMaterial({map:e.webCamTexture,color:16777215,side:THREE.DoubleSide}),n(e)})}function i(e){return W.promise(function(n,t){function r(t){console.log(t.children[0]),e.webCamHedronMesh=t.children[0].clone(),e.webCamHedronMesh.material=e.webCamMaterial.clone();var r=2800;e.webCamHedronMesh.scale.set(r,r,r);var o=W.randomBetween(2e-4,2e-5),i=W.randomBetween(2e-4,2e-5),a=W.randomBetween(2e-4,2e-5);u(e,function(n,t){e.webCamHedronMesh.rotation.x+=n*o,e.webCamHedronMesh.rotation.y+=n*i,e.webCamHedronMesh.rotation.z+=n*a}),e.scene.add(e.webCamHedronMesh),e.preCubeCamRenderFns.push(function(){e.webCamHedronMesh.visible=!0,e.webCamHedronMesh.material.color.set(16777215)}),e.postCubeCamRenderFns.push(function(){e.webCamHedronMesh.visible=!0,e.webCamHedronMesh.material.color.set(14276019)}),n(e)}var o=new THREE.OBJLoader;o.load("/obj/hedron.obj",r)})}function a(e){return W.promise(function(n,t){e.scene.add(new THREE.AmbientLight(2236962));var r=new THREE.DirectionalLight(16777215,2);r.position.set(2,1.2,10).normalize(),e.scene.add(r),r=new THREE.DirectionalLight(16777215,1),r.position.set(-2,1.2,-10).normalize(),e.scene.add(r),n(e)})}function s(e){return W.promise(function(n,t){function r(e){this.velocity=W.randomBetween(.2,1),this.mesh=e.clone(),this.mesh.material=r.material.clone(),this.mesh.scale.x=r.initialScale,this.mesh.scale.y=r.initialScale,this.mesh.scale.z=r.initialScale;var n=100;this.mesh.position.set((Math.random()-.5)*n,(Math.random()-.5)*n,(Math.random()-.5)*n),this.anchor=new THREE.Object3D,this.anchor.add(this.mesh)}function o(n){var t=n.children[0],o=100,a=5,s=100;!function c(){if(i.length<o){var n=new r(t);e.swarmObject3D.add(n.anchor),i.push(n),setTimeout(c,W.map(i.length/o,0,1,s,a,W.interpolations.easeIn))}}()}var i=[];e.swarmObject3D=new THREE.Object3D,e.scene.add(e.swarmObject3D),e.preCubeCamRenderFns.push(function(){e.swarmObject3D.visible=!1}),e.postCubeCamRenderFns.push(function(){e.swarmObject3D.visible=!0}),u(e,function(e,n){i.forEach(function(t){return t.update(e,n)})}),r.material=new THREE.MeshPhongMaterial({color:16777215,shininess:0,specular:16777215,envMap:e.cubeCamera.renderTarget,reflectivity:1,side:THREE.DoubleSide}),r.initialScale=200,r.prototype.update=function(n,t){this.anchor.rotation.x+=e.velocity[0]/10,this.anchor.rotation.y+=e.velocity[1]/10,this.anchor.rotation.z+=e.velocity[2]/10,this.mesh.rotation.x+=.002,this.mesh.rotation.y+=.001,this.mesh.rotation.z+=.003};var a=new THREE.OBJLoader;a.load("/obj/pillow-box.obj",o),n(e)})}function c(e){return W.promise(function(n,t){var r=0,o=0;!function i(n){window.requestAnimationFrame(i),o=n-r,r=n,e.preRenderFns.forEach(function(e){return e(o,n)}),e.renderer.clear(),e.renderer.render(e.scene,e.camera)}(r),n(e)})}function u(e,n){return e.preRenderFns.push(n),e}function l(e,n,t,r){return e.camera.position.x=n,e.camera.position.y=t,e.camera.position.z=r,e}function d(e,n,t,r){return W.isDefined(n)&&null!==n&&(e.velocity[0]=n),W.isDefined(t)&&null!==t&&(e.velocity[1]=t),W.isDefined(r)&&null!==r&&(e.velocity[2]=r),e}var m=W.composePromisers(n,t,o,r,i,s,a,c);return{makeViz:e,initViz:m,setVelocity:d}}(),makeApp=function(){return{wsUrl:W.join("https:"===document.location.protocol?"wss://":"ws://",document.location.host,"/")}},initApp=W.composePromisers(makeWebSocketClient,subscribeToHostControlMode,addPunterCid,makePunterVizs,makeRestRadioButtons);$(function(){initApp(makeApp()).success(function(e){report("OK","TheWorkers.net"),window.app=e})});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFsbC5qcyIsIm1haW4uanMiLCJwdW50ZXItdml6LmpzIl0sIm5hbWVzIjpbIm1ha2VXZWJTb2NrZXRDbGllbnQiLCJhcHAiLCJXIiwicHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJjb25zb2xlIiwibG9nIiwid3NVcmwiLCJ3c0NsaWVudCIsIkpTT05Tb2NrZXRDb25uZWN0aW9uIiwic29ja2V0VXJsIiwicmVzb2x2ZU9uRmlyc3RDb25uZWN0Iiwib25jZSIsIiQiLCJyZW1vdmUiLCJyZXBvcnQiLCJvbiIsIm1ha2VSZXBvcnRlciIsIm9wZW5Tb2NrZXRDb25uZWN0aW9uIiwic3Vic2NyaWJlVG9Ib3N0Q29udHJvbE1vZGUiLCJjb250cm9sTW9kZSIsIlJlc3Rlc3F1ZVV0aWwiLCJzdWJzY3JpYmVXaXRoSW5pdGlhbEdldCIsInBhY2tldCIsImdldEJvZHkiLCJzdWNjZXNzIiwiYWRkUHVudGVyQ2lkIiwicHVudGVyQ2lkIiwiZGF0YSIsIm1ha2VQdW50ZXJWaXpzIiwidG9BcnJheSIsIm1hcCIsImVsIiwicHVudGVyVml6IiwiUHVudGVyVml6IiwibWFrZVZpeiIsImNvbnRhaW5lckVsIiwiaW5pdFZpeiIsImVycm9yIiwiZXJyIiwidml6Iiwid2luZG93IiwibG9jYXRpb24iLCJzZWFyY2giLCJpbmRleE9mIiwicmFuZ2VFbCIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInNldEF0dHJpYnV0ZSIsImFzRXZlbnRTdHJlYW0iLCJldmVudCIsImN1cnJlbnRUYXJnZXQiLCJ2YWwiLCJvblZhbHVlIiwidiIsInNldFZlbG9jaXR5IiwicHJlcGVuZCIsInJvdGF0aW9uU3RlcCIsImdhbW1hU3RyZWFtIiwiZSIsIm9yaWdpbmFsRXZlbnQiLCJnYW1tYSIsImciLCJza2lwRHVwbGljYXRlcyIsInRocm90dGxlIiwiZGlyZWN0aW9uIiwicG9zdCIsIk1hdGgiLCJhYnMiLCJzcGVlZCIsIm1ha2VSZXN0UmFkaW9CdXR0b25zIiwiJGVsIiwiJHdyYXBwZXJFbCIsInBhcmVudCIsInByZXZlbnREZWZhdWx0IiwicmFkaW9FbHMiLCJmaW5kIiwiY2hlY2tib3hyYWRpbyIsInByb3AiLCJmaWx0ZXIiLCJhdHRyIiwicmVtb3ZlQ2xhc3MiLCJhZGRDbGFzcyIsImZuIiwiaGFzVHJpZ2dlcmVkIiwic3RhdHVzIiwic3RyIiwicmVzdCIsImFyZ3VtZW50cyIsImpvaW4iLCJyZXBvcnRBcmdzIiwiYXBwbHkiLCJ0aGlzIiwiY2FsbGVlQXJncyIsImJhY2tyb3VuZENvbG9yIiwidmVsb2NpdHkiLCJwcmVSZW5kZXJGbnMiLCJwcmVDdWJlQ2FtUmVuZGVyRm5zIiwicG9zdEN1YmVDYW1SZW5kZXJGbnMiLCJtYWtlQ2FtZXJhU2NlbmVSZW5kZXJlciIsImNhbWVyYSIsIlRIUkVFIiwiUGVyc3BlY3RpdmVDYW1lcmEiLCJpbm5lcldpZHRoIiwiaW5uZXJIZWlnaHQiLCJzZXRDYW1lcmFQb3NpdGlvbiIsInNjZW5lIiwiU2NlbmUiLCJyZW5kZXJlciIsIldlYkdMUmVuZGVyZXIiLCJhbnRpYWxpYXMiLCJzZXRQaXhlbFJhdGlvIiwiZGV2aWNlUGl4ZWxSYXRpbyIsInNldFNpemUiLCJzZXRDbGVhckNvbG9yIiwiYmFja2dyb3VuZENvbG9yIiwic29ydE9iamVjdHMiLCJhcHBlbmRDaGlsZCIsImRvbUVsZW1lbnQiLCJtYWtlV2ViQ2FtVGV4dHVyZSIsIndlYkNhbUVsIiwiYXV0b3BsYXkiLCJuYXZpZ2F0b3IiLCJ3ZWJraXRHZXRVc2VyTWVkaWEiLCJ2aWRlbyIsInN0cmVhbSIsInNyYyIsIlVSTCIsImNyZWF0ZU9iamVjdFVSTCIsIndlYkNhbVRleHR1cmUiLCJUZXh0dXJlIiwibWluRmlsdGVyIiwiTGluZWFyRmlsdGVyIiwiYWRkUHJlUmVuZGVyRm4iLCJkZXRsYU1TIiwidGltZXN0YW1wTVMiLCJyZWFkeVN0YXRlIiwiSEFWRV9FTk9VR0hfREFUQSIsIm5lZWRzVXBkYXRlIiwibWFrZUN1YmVDYW0iLCJjdWJlQ2FtZXJhIiwiQ3ViZUNhbWVyYSIsInJlbmRlclRhcmdldCIsIkxpbmVhck1pcE1hcExpbmVhckZpbHRlciIsImRlbHRhTVMiLCJmb3JFYWNoIiwidXBkYXRlQ3ViZU1hcCIsIm1ha2VXZWJDYW1NYXRlcmlhbCIsIndlYkNhbU1hdGVyaWFsIiwiTWVzaEJhc2ljTWF0ZXJpYWwiLCJjb2xvciIsInNpZGUiLCJEb3VibGVTaWRlIiwibWFrZVdlYkNhbUhlZHJvbk1lc2giLCJvbk9iakxvYWRlZCIsIm9iaiIsImNoaWxkcmVuIiwid2ViQ2FtSGVkcm9uTWVzaCIsImNsb25lIiwibWF0ZXJpYWwiLCJzY2FsZSIsInNldCIsInJvdGF0aW9uWCIsInJhbmRvbUJldHdlZW4iLCJyb3RhdGlvblkiLCJyb3RhdGlvbloiLCJyb3RhdGlvbiIsIngiLCJ5IiwieiIsImFkZCIsInB1c2giLCJ2aXNpYmxlIiwibG9hZGVyIiwiT0JKTG9hZGVyIiwibG9hZCIsIm1ha2VMaWdodHMiLCJBbWJpZW50TGlnaHQiLCJkaXJlY3Rpb25hbExpZ2h0IiwiRGlyZWN0aW9uYWxMaWdodCIsInBvc2l0aW9uIiwibm9ybWFsaXplIiwibWFrZVN3YXJtIiwiUGFydGljbGUiLCJtZXNoIiwiaW5pdGlhbFNjYWxlIiwicmFuZ2UiLCJyYW5kb20iLCJhbmNob3IiLCJPYmplY3QzRCIsIm1heFBhcnRpY2xlcyIsIm1pbkNyZWF0aW9uVGltZSIsIm1heENyZWF0aW9uVGltZU1TIiwiY3JlYXRlTW9yZSIsInBhcnRpY2xlcyIsImxlbmd0aCIsInBhcnRpY2xlIiwic3dhcm1PYmplY3QzRCIsInNldFRpbWVvdXQiLCJpbnRlcnBvbGF0aW9ucyIsImVhc2VJbiIsInVwZGF0ZSIsIk1lc2hQaG9uZ01hdGVyaWFsIiwic2hpbmluZXNzIiwic3BlY3VsYXIiLCJlbnZNYXAiLCJyZWZsZWN0aXZpdHkiLCJwcm90b3R5cGUiLCJtYWtlUmVuZGVyTG9vcCIsImxhc3RUaW1lc3RhbXBNUyIsImxvb3AiLCJjdXJyZW50VGltZXN0YW1wTVMiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJjbGVhciIsInJlbmRlciIsImlzRGVmaW5lZCIsImNvbXBvc2VQcm9taXNlcnMiLCJtYWtlQXBwIiwicHJvdG9jb2wiLCJob3N0IiwiaW5pdEFwcCJdLCJtYXBwaW5ncyI6IkFBUUEsWUMwQkEsU0FBU0EscUJBQXNCQyxHQUMzQixNQUFPQyxHQUFFQyxRQUFTLFNBQVdDLEVBQVNDLEdBQ2xDQyxRQUFRQyxJQUFLLGtDQUFtQ04sRUFBSU8sT0FFcERQLEVBQUlRLFNBQVcsR0FBSVAsR0FBRVEsc0JBQ2pCQyxVQUFXVixFQUFJTyxPQUduQixJQUFJSSxHQUF3QkMsS0FBTSxXQUM5QkMsRUFBRywrQkFBZ0NDLFNBQ25DQyxPQUFRLFlBQWEsTUFBT2YsRUFBSU8sT0FDaENKLEVBQVNILElBR2JBLEdBQUlRLFNBQVNRLEdBQUksT0FBUUwsR0FDekJYLEVBQUlRLFNBQVNRLEdBQUksUUFBU0MsYUFBYyxxQkFDeENqQixFQUFJUSxTQUFTUSxHQUFJLFFBQVNDLGFBQWMscUJBQ3hDakIsRUFBSVEsU0FBU1UseUJBSXJCLFFBQVNDLDRCQUE2Qm5CLEdBQ2xDLE1BQU9DLEdBQUVDLFFBQVMsU0FBV0MsRUFBU0MsR0FDbENKLEVBQUlvQixZQUFjLEdBQ2xCQyxjQUNLQyx3QkFBeUJ0QixFQUFJUSxTQUFVLHNCQUF1QixTQUFXZSxHQUN0RXZCLEVBQUlvQixZQUFjRyxFQUFPQyxVQUN6Qm5CLFFBQVFDLElBQUssMEJBQTJCTixFQUFJb0IsZUFFL0NLLFFBQVMsV0FDTnRCLEVBQVNILE9BS3pCLFFBQVMwQixjQUFlMUIsR0FDcEIsTUFBT0MsR0FBRUMsUUFBUyxTQUFXQyxFQUFTQyxHQUNsQ0osRUFBSTJCLFVBQVlkLEVBQUcscUJBQXNCZSxLQUFNLGFBQy9DekIsRUFBU0gsS0FPakIsUUFBUzZCLGdCQUFpQjdCLEdBQ3RCLE1BQU9DLEdBQUVDLFFBQVMsU0FBV0MsRUFBU0MsR0FDbENTLEVBQUcscUJBQ0VpQixVQUNBQyxJQUFLLFNBQVdDLEdBRWJoQyxFQUFJaUMsVUFBWUMsVUFBVUMsVUFFMUJuQyxFQUFJaUMsVUFBVUcsWUFBY0osQ0FN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TixFQUFFd0YsS0FBcUMsV0FBL0IzQyxTQUFTSixTQUFTZ0wsU0FBd0IsU0FBVyxRQUNyRDVLLFNBQVNKLFNBQVNpTCxLQUNsQixPQUluQkMsUUFBVTNOLEVBQUV1TixpQkFBa0J6TixvQkFDQW9CLDJCQUNBTyxhQUNBRyxlQUNBeUMscUJBRWxDekQsR0FBRyxXQUNDK00sUUFBU0gsV0FDUmhNLFFBQVMsU0FBV3pCLEdBQ2pCZSxPQUFRLEtBQU0sa0JBQ2QwQixPQUFPekMsSUFBTUEiLCJmaWxlIjoiYWxsLmpzIiwic291cmNlc0NvbnRlbnQiOltudWxsLCIvKiBqc2hpbnQgZXNuZXh0OiB0cnVlICovXG5cbi8vIE1haW4uanNcbi8vID09PT09PT1cbi8vIEVudHJ5IHBvaW50IG9mIHRoZSBhcHBsaWNhdGlvbi5cblxuLy8gTWFrZSAmIEluaXRcbi8vID09PT09PT09PT09XG5cbnZhciBtYWtlQXBwID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB7XG4gICAgICAgIHdzVXJsOiBXLmpvaW4oIGRvY3VtZW50LmxvY2F0aW9uLnByb3RvY29sID09PSAnaHR0cHM6JyA/ICd3c3M6Ly8nIDogJ3dzOi8vJyxcbiAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQubG9jYXRpb24uaG9zdCwgLy9kb2N1bWVudC4nLy8vJy8vJ3dzczovLzE5Mi4xNjguMC43OjcwODAnXG4gICAgICAgICAgICAgICAgICAgICAgICcvJyApXG4gICAgfTtcbn07XG5cbnZhciBpbml0QXBwID0gVy5jb21wb3NlUHJvbWlzZXJzKCBtYWtlV2ViU29ja2V0Q2xpZW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YnNjcmliZVRvSG9zdENvbnRyb2xNb2RlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZFB1bnRlckNpZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYWtlUHVudGVyVml6cyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYWtlUmVzdFJhZGlvQnV0dG9ucyApO1xuXG4kKCBmdW5jdGlvbiAoKSB7XG4gICAgaW5pdEFwcCggbWFrZUFwcCgpIClcbiAgICAuc3VjY2VzcyggZnVuY3Rpb24gKCBhcHAgKSB7XG4gICAgICAgIHJlcG9ydCggJ09LJywgJ1RoZVdvcmtlcnMubmV0JyApO1xuICAgICAgICB3aW5kb3cuYXBwID0gYXBwO1xuICAgIH0pO1xufSk7XG5cbi8vIFByb21pc2Vyc1xuLy8gPT09PT09PT09XG5cbmZ1bmN0aW9uIG1ha2VXZWJTb2NrZXRDbGllbnQgKCBhcHAgKSB7XG4gICAgcmV0dXJuIFcucHJvbWlzZSggZnVuY3Rpb24gKCByZXNvbHZlLCByZWplY3QgKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCAnQ29ubmVjdGluZyB0byB3ZWJzb2NrZXQgY2xpZW50OicsIGFwcC53c1VybCApO1xuICAgICAgICBcbiAgICAgICAgYXBwLndzQ2xpZW50ID0gbmV3IFcuSlNPTlNvY2tldENvbm5lY3Rpb24oe1xuICAgICAgICAgICAgc29ja2V0VXJsOiBhcHAud3NVcmxcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICB2YXIgcmVzb2x2ZU9uRmlyc3RDb25uZWN0ID0gb25jZSggZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJCggJ1tkYXRhLWRpc2Nvbm5lY3RlZC13YXJuaW5nXScgKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIHJlcG9ydCggJ0NPTk5FQ1RFRCcsICd0bzonLCBhcHAud3NVcmwgKTtcbiAgICAgICAgICAgIHJlc29sdmUoIGFwcCApO1xuICAgICAgICB9KTtcblxuICAgICAgICBhcHAud3NDbGllbnQub24oICdvcGVuJywgcmVzb2x2ZU9uRmlyc3RDb25uZWN0ICk7XG4gICAgICAgIGFwcC53c0NsaWVudC5vbiggJ2Vycm9yJywgbWFrZVJlcG9ydGVyKCAnV2ViIFNvY2tldCBFcnJvcicgKSApO1xuICAgICAgICBhcHAud3NDbGllbnQub24oICdjbG9zZScsIG1ha2VSZXBvcnRlciggJ1dlYiBTb2NrZXQgQ2xvc2UnICkgKTtcbiAgICAgICAgYXBwLndzQ2xpZW50Lm9wZW5Tb2NrZXRDb25uZWN0aW9uKCk7XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIHN1YnNjcmliZVRvSG9zdENvbnRyb2xNb2RlICggYXBwICkge1xuICAgIHJldHVybiBXLnByb21pc2UoIGZ1bmN0aW9uICggcmVzb2x2ZSwgcmVqZWN0ICkge1xuICAgICAgICBhcHAuY29udHJvbE1vZGUgPSAnJztcbiAgICAgICAgUmVzdGVzcXVlVXRpbFxuICAgICAgICAgICAgLnN1YnNjcmliZVdpdGhJbml0aWFsR2V0KCBhcHAud3NDbGllbnQsICcvaG9zdC9jb250cm9sL21vZGUvJywgZnVuY3Rpb24gKCBwYWNrZXQgKSB7XG4gICAgICAgICAgICAgICAgYXBwLmNvbnRyb2xNb2RlID0gcGFja2V0LmdldEJvZHkoKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggJ0NvbnRyb2wgTW9kZSBDaGFuZ2UgdG86JywgYXBwLmNvbnRyb2xNb2RlICk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnN1Y2Nlc3MoIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXNvbHZlKCBhcHAgKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH0pO1xufVxuXG5mdW5jdGlvbiBhZGRQdW50ZXJDaWQgKCBhcHAgKSB7XG4gICAgcmV0dXJuIFcucHJvbWlzZSggZnVuY3Rpb24gKCByZXNvbHZlLCByZWplY3QgKSB7XG4gICAgICAgIGFwcC5wdW50ZXJDaWQgPSAkKCAnW2RhdGEtcHVudGVyLWNpZF0nICkuZGF0YSggJ3B1bnRlckNpZCcgKTtcbiAgICAgICAgcmVzb2x2ZSggYXBwICk7XG4gICAgfSk7XG59XG5cbi8vIFB1bnRlciBWaXpcbi8vIC0tLS0tLS0tLS1cblxuZnVuY3Rpb24gbWFrZVB1bnRlclZpenMgKCBhcHAgKSB7XG4gICAgcmV0dXJuIFcucHJvbWlzZSggZnVuY3Rpb24gKCByZXNvbHZlLCByZWplY3QgKSB7XG4gICAgICAgICQoIFwiW2RhdGEtcHVudGVyLXZpel1cIiApXG4gICAgICAgICAgICAudG9BcnJheSgpXG4gICAgICAgICAgICAubWFwKCBmdW5jdGlvbiAoIGVsICkge1xuICAgICAgICAgICAgICAgIC8vIE1ha2UgdGhlIHB1bnRlciBhcHBsaWNhdGlvblxuICAgICAgICAgICAgICAgIGFwcC5wdW50ZXJWaXogPSBQdW50ZXJWaXoubWFrZVZpeigpO1xuICAgICAgICAgICAgICAgIC8vIEFkZCBvdXQgZG9tIGVsZW1lbnRcbiAgICAgICAgICAgICAgICBhcHAucHVudGVyVml6LmNvbnRhaW5lckVsID0gZWw7XG5cbiAgICAgICAgICAgICAgICAvLyBJbml0YWlsaXNlIGl0XG5cbiAgICAgICAgICAgICAgICB2YXIgRk9SV0FSRFNfSElHSCA9IFsgWyAnLycgXSBdIFxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIFB1bnRlclZpelxuICAgICAgICAgICAgICAgICAgICAuaW5pdFZpeiggYXBwLnB1bnRlclZpeiApXG4gICAgICAgICAgICAgICAgICAgIC5lcnJvciggZnVuY3Rpb24gKCBlcnIgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCAnRmFpbGVkIHRvIGNyZWF0ZSBQdW50ZXIgYXBwJywgZXJyICk7XG4gICAgICAgICAgICAgICAgICAgIH0pIFxuICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyggZnVuY3Rpb24gKCB2aXogKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIERldmljZSBSb3RhdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gPT09PT09PT09PT09PT09XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5vbi1Nb2JpbGUgLyBEZWJ1Z1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIHdpbmRvdy5sb2NhdGlvbi5zZWFyY2guaW5kZXhPZiggJ2RlYnVnJykgPiAtMSApIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE1ha2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmFuZ2VFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdpbnB1dCcgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByYW5nZUVsLnNldEF0dHJpYnV0ZSggJ3R5cGUnLCAncmFuZ2UnICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFuZ2VFbC5zZXRBdHRyaWJ1dGUoICdtaW4nLCAtMSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhbmdlRWwuc2V0QXR0cmlidXRlKCAnbWF4JywgMSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhbmdlRWwuc2V0QXR0cmlidXRlKCAnc3RlcCcsIDAuMDEgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByYW5nZUVsLnNldEF0dHJpYnV0ZSggJ3ZhbHVlJywgMC4yNSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhbmdlRWwuc2V0QXR0cmlidXRlKCAnc3R5bGUnLCAncG9zaXRpb246IGFic29sdXRlJyApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCggcmFuZ2VFbCApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hc0V2ZW50U3RyZWFtKCAnY2hhbmdlJyApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5tYXAoIGV2ZW50ID0+IGV2ZW50LmN1cnJlbnRUYXJnZXQgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAubWFwKCBlbCA9PiAkKCBlbCApLnZhbCgpIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLm9uVmFsdWUoIHYgPT4gUHVudGVyVml6LnNldFZlbG9jaXR5KCB2aXosIG51bGwsIHYsIG51bGwgKSApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCggJyNwdW50ZXInICkucHJlcGVuZCggcmFuZ2VFbCApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBNb2JpbGVcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tLVxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJvdGF0aW9uU3RlcCA9IDI1LjcxNDI4NTcxNDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWRkIHRoZSByb3RhdGlvbiBjb250cm9sc1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZ2FtbWEgcmlnaHQgOTAsIGxlZnQgLTkwXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZ2FtbWFTdHJlYW0gPSAkKCB3aW5kb3cgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXNFdmVudFN0cmVhbSggJ2RldmljZW9yaWVudGF0aW9uJyApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5tYXAoIGUgPT4gZS5vcmlnaW5hbEV2ZW50LmdhbW1hICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFsgYmgsIGJtLCBibCwgbiwgZmwsIGZtLCBmaCBdXG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvcndhcmRzICYgQmFja3dhcmRzXG4gICAgICAgICAgICAgICAgICAgICAgICBnYW1tYVN0cmVhbVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5tYXAoIGZ1bmN0aW9uICggZyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBnIDwgLXJvdGF0aW9uU3RlcCApIHsgcmV0dXJuICdiYWNrd2FyZCc7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoIGcgPiByb3RhdGlvblN0ZXAgKSB7IHJldHVybiAnZm9yd2FyZCc7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7IHJldHVybiAnbm9uZSc7IH0gXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2tpcER1cGxpY2F0ZXMoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aHJvdHRsZSggMTAwIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAub25WYWx1ZSggZnVuY3Rpb24gKCBkaXJlY3Rpb24gKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggJ3Bob25lLScgKyBhcHAucHVudGVyQ2lkID09PSBhcHAuY29udHJvbE1vZGUgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZXN0ZXNxdWVVdGlsLnBvc3QoIGFwcC53c0NsaWVudCwgJy9tb3Rvci9yb3RhdGlvbi9kaXJlY3Rpb24vJywgZGlyZWN0aW9uICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3BlZWRcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhbW1hU3RyZWFtXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLm1hcCggZyA9PiBNYXRoLmFicyggZyApIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAubWFwKCBmdW5jdGlvbiAoIGcgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggZyA+IDkwIC0gcm90YXRpb25TdGVwICkgeyByZXR1cm4gJ2hpZ2gnOyB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKCBnID4gOTAgLSAoIHJvdGF0aW9uU3RlcCAqIDIgKSApIHsgcmV0dXJuICdtZWRpdW0nOyB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgeyByZXR1cm4gJ2xvdyc7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aHJvdHRsZSggMTAwIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAub25WYWx1ZSggZnVuY3Rpb24gKCBzcGVlZCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAncGhvbmUtJyArIGFwcC5wdW50ZXJDaWQgPT09IGFwcC5jb250cm9sTW9kZSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlc3Rlc3F1ZVV0aWwucG9zdCggYXBwLndzQ2xpZW50LCAnL21vdG9yL3JvdGF0aW9uL3NwZWVkLycsIHNwZWVkICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coICdQdW50ZXIgYXBwbGljYXRpb24gbWFkZScgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICByZXNvbHZlKCBhcHAgKTtcbiAgICB9KTtcbn1cblxuLy8galF1ZXJ5IE1vYmlsZSBVaSBCaW5kaW5nc1xuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5mdW5jdGlvbiBtYWtlUmVzdFJhZGlvQnV0dG9ucyAoIGFwcCApIHtcbiAgICByZXR1cm4gVy5wcm9taXNlKCBmdW5jdGlvbiAoIHJlc29sdmUsIHJlamVjdCApIHtcbiAgICAgICAgLy8gUmFkaW8gQnV0dG9uc1xuICAgICAgICAvLyA9PT09PT09PT09PT09XG4gICAgICAgICQoICdbZGF0YS1yZXN0LXR5cGU9XCJyYWRpby1wb3N0XCJdJyApXG4gICAgICAgICAgICAudG9BcnJheSgpXG4gICAgICAgICAgICAubWFwKCAkIClcbiAgICAgICAgICAgIC5tYXAoIGZ1bmN0aW9uICggJGVsICkge1xuICAgICAgICAgICAgICAgIC8vIERpc2FibGUgcmVhbCBldmVudHNcbiAgICAgICAgICAgICAgICB2YXIgJHdyYXBwZXJFbCA9ICRlbC5wYXJlbnQoKTtcbiAgICAgICAgICAgICAgICAkd3JhcHBlckVsLm9uKCAnY2xpY2sgdG91Y2hlbmQnLCBmdW5jdGlvbiAoIGUgKSB7XG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coICdzZW5kaW5nJywkZWwudmFsKCksICd0bycsICRlbC5kYXRhKCAncmVzdFVyaScgKSAgKTtcbiAgICAgICAgICAgICAgICAgICAgUmVzdGVzcXVlVXRpbC5wb3N0KCBhcHAud3NDbGllbnQsICRlbC5kYXRhKCAncmVzdFVyaScgKSwgJGVsLnZhbCgpICk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFJhZGlvIEZpZWxkIFNldHNcbiAgICAgICAgLy8gPT09PT09PT09PT09PT09PVxuICAgICAgICAkKCAnW2RhdGEtcmVzdC10eXBlPVwiZmVpbGRzZXRcIl0nIClcbiAgICAgICAgICAgIC50b0FycmF5KClcbiAgICAgICAgICAgIC5tYXAoICQgKVxuICAgICAgICAgICAgLm1hcCggZnVuY3Rpb24gKCAkZWwgKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgcmFkaW9FbHMgPSAkZWwuZmluZCggJ2lucHV0W3R5cGU9XCJyYWRpb1wiXScgKS5jaGVja2JveHJhZGlvKCk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coICAnZ290IGEgZmllbGQgc2V0JywgJGVsLmRhdGEoICdyZXN0VXJpJyApICk7XG4gICAgICAgICAgICAgICAgUmVzdGVzcXVlVXRpbC5zdWJzY3JpYmVXaXRoSW5pdGlhbEdldCggYXBwLndzQ2xpZW50LCAkZWwuZGF0YSggJ3Jlc3RVcmknICksIGZ1bmN0aW9uICggcGFja2V0ICkge1xuICAgICAgICAgICAgICAgICAgICByYWRpb0Vsc1xuICAgICAgICAgICAgICAgICAgICAgICAgLnByb3AoICdjaGVja2VkJywgZmFsc2UgKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNoZWNrYm94cmFkaW8oICdyZWZyZXNoJyApXG4gICAgICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKCAnaW5wdXRbdmFsdWU9XCInKyBwYWNrZXQuZ2V0Qm9keSgpICsnXCJdJyApXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXR0ciggJ2NoZWNrZWQnLCAnY2hlY2tlZCcgKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNoZWNrYm94cmFkaW8oICdyZWZyZXNoJyApXG4gICAgICAgICAgICAgICAgICAgICAgICAucGFyZW50KClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5maW5kKCAnbGFiZWwnIClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyggJ3VpLXJhZGlvLW9mZicgKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKCAndWktcmFkaW8tb24nICk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIHJlc29sdmUoIGFwcCApO1xuICAgIH0pO1xufVxuXG4vLyBVdGlsc1xuLy8gPT09PT1cblxuLy8gRnVuY3Rpb25cbi8vIC0tLS0tLS0tXG4gICAgXG5mdW5jdGlvbiBvbmNlICggZm4gKSB7XG4gICAgdmFyIGhhc1RyaWdnZXJlZCA9IGZhbHNlO1xuICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICggISBoYXNUcmlnZ2VyZWQgKSB7XG4gICAgICAgICAgICBmbigpO1xuICAgICAgICAgICAgaGFzVHJpZ2dlcmVkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH07XG59XG5cbi8vIFJlcG9ydGluZ1xuLy8gLS0tLS0tLS0tXG5cbmZ1bmN0aW9uIHJlcG9ydCggc3RhdHVzLCBzdHIgKSB7XG4gICAgY29uc29sZS5sb2coICdbJywgc3RhdHVzLCAnXScsIFcucmVzdCggVy50b0FycmF5KCBhcmd1bWVudHMgKSApLmpvaW4oICcgJyApICk7XG59XG5cbmZ1bmN0aW9uIG1ha2VSZXBvcnRlciggc3RhdHVzLCBzdHIgKSB7XG4gICAgdmFyIHJlcG9ydEFyZ3MgPSBhcmd1bWVudHM7XG4gICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmVwb3J0LmFwcGx5KCB0aGlzLCByZXBvcnRBcmdzICk7XG4gICAgICAgIHZhciBjYWxsZWVBcmdzID0gYXJndW1lbnRzO1xuICAgICAgICByZXR1cm4gVy5wcm9taXNlKCBmdW5jdGlvbiAoIHJlc29sdmUsIHJlamVjdCApIHtcbiAgICAgICAgICAgIHJlc29sdmUuYXBwbHkoIHRoaXMsIGNhbGxlZUFyZ3MgKTtcbiAgICAgICAgfSk7XG4gICAgfTtcbn1cbiIsIi8qIGpzaGludCBlc25leHQ6IHRydWUgKi9cblxuLy8gUHVudGVyIFZpelxuLy8gPT09PT09PT09PVxuLy8gQSB0aHJlZS5qcyB2aXN1bGlzYXRpb24gdG8gYmVcbi8vIHJ1biBvbiBhbiBIVEMgcGhvbmUgYW5kIGNhcnJpZWQgYnlcbi8vIHB1bnRlcnMgaW50byB0aGUgbWlycm9yIGJveC5cblxudmFyIFB1bnRlclZpeiA9IChmdW5jdGlvbiAoKSB7XG5cbiAgICAvLyBJbml0ICYgbWFrZVxuICAgIC8vID09PT09PT09PT09XG4gICAgZnVuY3Rpb24gbWFrZVZpeiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjb250YWluZXJFbDogZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2RpdicgKSxcbiAgICAgICAgICAgIGJhY2tyb3VuZENvbG9yOiAweDYxNjI2NCxcbiAgICAgICAgICAgIHZlbG9jaXR5OiBbIDAsIDAsIDAgXSxcbiAgICAgICAgICAgIHByZVJlbmRlckZuczogW10sXG4gICAgICAgICAgICBwcmVDdWJlQ2FtUmVuZGVyRm5zOiBbXSxcbiAgICAgICAgICAgIHBvc3RDdWJlQ2FtUmVuZGVyRm5zOiBbXVxuICAgICAgICB9O1xuICAgIH1cblxuICAgIHZhciBpbml0Vml6ID0gVy5jb21wb3NlUHJvbWlzZXJzKCBtYWtlQ2FtZXJhU2NlbmVSZW5kZXJlcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFrZVdlYkNhbVRleHR1cmUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ha2VXZWJDYW1NYXRlcmlhbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFrZUN1YmVDYW0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG1ha2VXZWJDYW1Cb3hNZXNoLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYWtlV2ViQ2FtSGVkcm9uTWVzaCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFrZVN3YXJtLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYWtlTGlnaHRzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYWtlUmVuZGVyTG9vcCApO1xuXG4gICAgLy8gUHJvbWlzZXJzXG4gICAgLy8gPT09PT09PT09XG5cbiAgICAvLyBDYW1lcmEsIFNjZW5lLCBSZW5kZXJlclxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgZnVuY3Rpb24gbWFrZUNhbWVyYVNjZW5lUmVuZGVyZXIgKCB2aXogKSB7XG4gICAgICAgIHJldHVybiBXLnByb21pc2UoIGZ1bmN0aW9uICggcmVzb2x2ZSwgcmVqZWN0ICkge1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBDYW1lcmFcbiAgICAgICAgICAgIC8vIC0tLS0tLVxuICAgICAgICAgICAgdml6LmNhbWVyYSA9IG5ldyBUSFJFRS5QZXJzcGVjdGl2ZUNhbWVyYSggNzAsIHdpbmRvdy5pbm5lcldpZHRoIC8gd2luZG93LmlubmVySGVpZ2h0LCAxLCAzMDAwICk7XG4gICAgICAgICAgICBzZXRDYW1lcmFQb3NpdGlvbiggdml6LCAwLCAwLCAyMDAgKTtcblxuICAgICAgICAgICAgLy8gU2NlbmVcbiAgICAgICAgICAgIC8vIC0tLS0tXG4gICAgICAgICAgICB2aXouc2NlbmUgPSBuZXcgVEhSRUUuU2NlbmUoKTtcblxuICAgICAgICAgICAgLy8gUmVuZGVyZXJcbiAgICAgICAgICAgIC8vIC0tLS0tLS0tXG4gICAgICAgICAgICB2aXoucmVuZGVyZXIgPSBuZXcgVEhSRUUuV2ViR0xSZW5kZXJlciggeyBhbnRpYWxpYXM6IGZhbHNlIH0gKTtcbiAgICAgICAgICAgIHZpei5yZW5kZXJlci5zZXRQaXhlbFJhdGlvKCB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyApO1xuICAgICAgICAgICAgdml6LnJlbmRlcmVyLnNldFNpemUoIHdpbmRvdy5pbm5lcldpZHRoLCB3aW5kb3cuaW5uZXJIZWlnaHQgKTtcbiAgICAgICAgICAgIHZpei5yZW5kZXJlci5zZXRDbGVhckNvbG9yKCB2aXouYmFja2dyb3VuZENvbG9yICk7XG4gICAgICAgICAgICB2aXoucmVuZGVyZXIuc29ydE9iamVjdHMgPSBmYWxzZTtcblxuICAgICAgICAgICAgdml6LmNvbnRhaW5lckVsLmFwcGVuZENoaWxkKCB2aXoucmVuZGVyZXIuZG9tRWxlbWVudCApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXNvbHZlKCB2aXogKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gV2ViIENhbVxuICAgIC8vIC0tLS0tLS1cbiAgICAvLyBNYWtlIHRoZSB3ZWIgY2FtIGF2YWlsYWJsZSBhcyBhIHRleHR1cmVcbiAgICBmdW5jdGlvbiBtYWtlV2ViQ2FtVGV4dHVyZSAoIHZpeiApIHtcbiAgICAgICAgcmV0dXJuIFcucHJvbWlzZSggZnVuY3Rpb24gKCByZXNvbHZlLCByZWplY3QgKSB7XG5cbiAgICAgICAgICAgIC8vIFdlYiBDYW0gRE9NIEVsZW1lbnRcbiAgICAgICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgIHZhciB3ZWJDYW1FbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3ZpZGVvJyk7XG4gICAgICAgICAgICB3ZWJDYW1FbC5hdXRvcGxheSA9IHRydWU7XG5cbiAgICAgICAgICAgIC8vIFdlYiBDYW0gU3RyZWFtXG4gICAgICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLVxuICAgICAgICAgICAgbmF2aWdhdG9yLndlYmtpdEdldFVzZXJNZWRpYSggeyB2aWRlbzp0cnVlIH0sIGZ1bmN0aW9uKCBzdHJlYW0gKXtcbiAgICAgICAgICAgICAgICB3ZWJDYW1FbC5zcmMgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKCBzdHJlYW0gKTtcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKCBlcnIgKXtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkZhaWxlZCB0byBnZXQgYSBzdHJlYW0gZHVlIHRvXCIsIGVycik7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gV2ViIENhbSBUZXh0dXJlXG4gICAgICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgIHZpei53ZWJDYW1UZXh0dXJlID0gbmV3IFRIUkVFLlRleHR1cmUoIHdlYkNhbUVsICk7XG4gICAgICAgICAgICB2aXoud2ViQ2FtVGV4dHVyZS5taW5GaWx0ZXIgPSBUSFJFRS5MaW5lYXJGaWx0ZXI7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFJlbmRlciBVcGRhdGVzXG4gICAgICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLVxuICAgICAgICAgICAgYWRkUHJlUmVuZGVyRm4oIHZpeiwgZnVuY3Rpb24gKCBkZXRsYU1TLCB0aW1lc3RhbXBNUyApIHtcbiAgICAgICAgICAgICAgICBpZiggd2ViQ2FtRWwucmVhZHlTdGF0ZSA9PT0gd2ViQ2FtRWwuSEFWRV9FTk9VR0hfREFUQSApe1xuICAgICAgICAgICAgICAgICAgICB2aXoud2ViQ2FtVGV4dHVyZS5uZWVkc1VwZGF0ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHJlc29sdmUoIHZpeiApO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBDdWJlIENhbWVyYVxuICAgIC8vIC0tLS0tLS0tLS0tXG4gICAgLy8gQ3JlYXRlIGEgY3ViZSBjYW0gZm9yIGEgZHluYW1pYyBlbnZNYXAuXG4gICAgLy8gVGhpcyBhbHNvIGVuYWJsZXMgdHdvIGhvb2tzOiBgcHJlQ3ViZUNhbVJlbmRlckFjdGlvbnNgICYgYHBvc3RDdWJlQ2FtUmVuZGVyQWN0aW9uc2BcbiAgICAvLyBpbiB0aGUgdml6IGZvciB0aGF0IG9iamVjdDNEIGluIHRoZSBzY2VuZSBjYW4gYmUgdHVybmVkIG9uIGFuZCBvZmYgZHVyaW5nXG4gICAgLy8gdGhlIHdlYmNhbXMgcmVuZGVyXG4gICAgZnVuY3Rpb24gbWFrZUN1YmVDYW0gKCB2aXogKSB7IFxuICAgICAgICByZXR1cm4gVy5wcm9taXNlKCBmdW5jdGlvbiAoIHJlc29sdmUsIHJlamVjdCApIHtcblxuICAgICAgICAgICAgdml6LmN1YmVDYW1lcmEgPSBuZXcgVEhSRUUuQ3ViZUNhbWVyYSgxLCAzMDAwLCAyNTYpOyAvLyBuZWFyLCBmYXIsIHJlc29sdXRpb25cbiAgICAgICAgICAgIHZpei5jdWJlQ2FtZXJhLnJlbmRlclRhcmdldC5taW5GaWx0ZXIgPSBUSFJFRS5MaW5lYXJNaXBNYXBMaW5lYXJGaWx0ZXI7IC8vIG1pcG1hcCBmaWx0ZXJcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgYWRkUHJlUmVuZGVyRm4oIHZpeiwgZnVuY3Rpb24gKCBkZWx0YU1TLCB0aW1lc3RhbXBNUyApIHsgICAgXG4gICAgICAgICAgICAgICAgLy8gUmVuZGVyIHRoZSBjdWJlIGNhbWVyYSB0byBjdWJlIG1hcFxuICAgICAgICAgICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgICAgICB2aXoucHJlQ3ViZUNhbVJlbmRlckZucy5mb3JFYWNoKCBmbiA9PiBmbiggZGVsdGFNUywgdGltZXN0YW1wTVMgKSApO1xuICAgICAgICAgICAgICAgIHZpei5jdWJlQ2FtZXJhLnVwZGF0ZUN1YmVNYXAoIHZpei5yZW5kZXJlciwgdml6LnNjZW5lICk7XG4gICAgICAgICAgICAgICAgdml6LnBvc3RDdWJlQ2FtUmVuZGVyRm5zLmZvckVhY2goIGZuID0+IGZuKCBkZWx0YU1TLCB0aW1lc3RhbXBNUyApICk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcmVzb2x2ZSggdml6ICk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFdlYiBDYW0gTWF0ZXJpYWxcbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tXG4gICAgZnVuY3Rpb24gbWFrZVdlYkNhbU1hdGVyaWFsICggdml6ICkge1xuICAgICAgICByZXR1cm4gVy5wcm9taXNlKCBmdW5jdGlvbiAoIHJlc29sdmUsIHJlamVjdCApIHtcbiAgICAgICAgICAgIHZpei53ZWJDYW1NYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7XG4gICAgICAgICAgICAgICAgbWFwOiB2aXoud2ViQ2FtVGV4dHVyZSxcbiAgICAgICAgICAgICAgICBjb2xvcjogMHhmZmZmZmYsXG4gICAgICAgICAgICAgICAgc2lkZTogVEhSRUUuRG91YmxlU2lkZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXNvbHZlKCB2aXogKTtcbiAgICAgICAgfSk7XG5cbiAgICB9XG5cbiAgICAvLyBXZWIgQ2FtIEJveCBNZXNoXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIENyZWF0ZXMgYSBib3ggd2l0aCB0aGUgd2ViIGNhbSBkaXNwbGF5ZWRcbiAgICAvLyBvbiB0aGUgaW5zaWRlIG9mIGVhY2ggb2YgaXQncyA2IHNpZGVzXG4gICAgZnVuY3Rpb24gbWFrZVdlYkNhbUJveE1lc2ggKCB2aXogKSB7XG4gICAgICAgIHJldHVybiBXLnByb21pc2UoIGZ1bmN0aW9uICggcmVzb2x2ZSwgcmVqZWN0ICkge1xuICAgICAgICAgICAgXG4gICAgICAgICAgICB2aXoud2ViQ2FtdkJveE1lc2ggPSBuZXcgVEhSRUUuTWVzaCggbmV3IFRIUkVFLkJveEdlb21ldHJ5KCAyMDAwLCAyMDAwLCAyMDAwICksIHZpei53ZWJDYW1NYXRlcmlhbCApO1xuXG4gICAgICAgICAgICB2YXIgcm90YXRpb25YID0gVy5yYW5kb21CZXR3ZWVuKCAwLjAwMDIsIDAuMDAwMDIgKTtcbiAgICAgICAgICAgIHZhciByb3RhdGlvblkgPSBXLnJhbmRvbUJldHdlZW4oIDAuMDAwMiwgMC4wMDAwMiApO1xuICAgICAgICAgICAgdmFyIHJvdGF0aW9uWiA9IFcucmFuZG9tQmV0d2VlbiggMC4wMDAyLCAwLjAwMDAyICk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIElmIHdlIHdhbnQgdG8gcm90YXRlIGl0XG4gICAgICAgICAgICBhZGRQcmVSZW5kZXJGbiggdml6LCBmdW5jdGlvbiAoIGRlbHRhTVMsIHRpbWVzdGFtcE1TICkge1xuICAgICAgICAgICAgICAgIHZpei53ZWJDYW12Qm94TWVzaC5yb3RhdGlvbi54ICs9ICggZGVsdGFNUyAqIHJvdGF0aW9uWCApO1xuICAgICAgICAgICAgICAgIHZpei53ZWJDYW12Qm94TWVzaC5yb3RhdGlvbi55ICs9ICggZGVsdGFNUyAqIHJvdGF0aW9uWSApO1xuICAgICAgICAgICAgICAgIHZpei53ZWJDYW12Qm94TWVzaC5yb3RhdGlvbi56ICs9ICggZGVsdGFNUyAqIHJvdGF0aW9uWiApO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHZpei5zY2VuZS5hZGQoIHZpei53ZWJDYW12Qm94TWVzaCApO1xuXG4gICAgICAgICAgICAvLyBTaG93IGl0IG9ubHkgZm9yIHRoZSBjdWJlIGNhbVxuICAgICAgICAgICAgdml6LnByZUN1YmVDYW1SZW5kZXJGbnMucHVzaCggZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZpei53ZWJDYW12Qm94TWVzaC52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB2aXoucG9zdEN1YmVDYW1SZW5kZXJGbnMucHVzaCggZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZpei53ZWJDYW12Qm94TWVzaC52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXNvbHZlKCB2aXogKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gV2ViIENhbSBIZWRyb24gTWVzaFxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBmdW5jdGlvbiBtYWtlV2ViQ2FtSGVkcm9uTWVzaCAoIHZpeiApIHtcbiAgICAgICAgcmV0dXJuIFcucHJvbWlzZSggZnVuY3Rpb24gKCByZXNvbHZlLCByZWplY3QgKSB7XG5cbiAgICAgICAgICAgIC8vIExvYWRlclxuICAgICAgICAgICAgLy8gLS0tLS0tXG4gICAgICAgICAgICB2YXIgbG9hZGVyID0gbmV3IFRIUkVFLk9CSkxvYWRlcigpO1xuICAgICAgICAgICAgbG9hZGVyLmxvYWQoICcvb2JqL2hlZHJvbi5vYmonLCBvbk9iakxvYWRlZCApO1xuXG4gICAgICAgICAgICAvLyBTd2FybSBDcmVhdGlvblxuICAgICAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAgICAgZnVuY3Rpb24gb25PYmpMb2FkZWQgKCBvYmogKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coIG9iai5jaGlsZHJlblsgMCBdICk7XG4gICAgICAgICAgICAgICAgdml6LndlYkNhbUhlZHJvbk1lc2ggPSBvYmouY2hpbGRyZW5bIDAgXS5jbG9uZSgpOyAvL25ldyBUSFJFRS5NZXNoKCBuZXcgVEhSRUUuQm94R2VvbWV0cnkoIDIwMDAsIDIwMDAsIDIwMDAgKSwgbWF0ZXJpYWwgKTtcbiAgICAgICAgICAgICAgICB2aXoud2ViQ2FtSGVkcm9uTWVzaC5tYXRlcmlhbCA9IHZpei53ZWJDYW1NYXRlcmlhbC5jbG9uZSgpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHZhciBzY2FsZSA9IDI4MDA7XG4gICAgICAgICAgICAgICAgdml6LndlYkNhbUhlZHJvbk1lc2guc2NhbGUuc2V0KCBzY2FsZSwgc2NhbGUsIHNjYWxlICk7XG5cbiAgICAgICAgICAgICAgICB2YXIgcm90YXRpb25YID0gVy5yYW5kb21CZXR3ZWVuKCAwLjAwMDIsIDAuMDAwMDIgKTtcbiAgICAgICAgICAgICAgICB2YXIgcm90YXRpb25ZID0gVy5yYW5kb21CZXR3ZWVuKCAwLjAwMDIsIDAuMDAwMDIgKTtcbiAgICAgICAgICAgICAgICB2YXIgcm90YXRpb25aID0gVy5yYW5kb21CZXR3ZWVuKCAwLjAwMDIsIDAuMDAwMDIgKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyBJZiB3ZSB3YW50IHRvIHJvdGF0ZSBpdFxuICAgICAgICAgICAgICAgIGFkZFByZVJlbmRlckZuKCB2aXosIGZ1bmN0aW9uICggZGVsdGFNUywgdGltZXN0YW1wTVMgKSB7XG4gICAgICAgICAgICAgICAgICAgIHZpei53ZWJDYW1IZWRyb25NZXNoLnJvdGF0aW9uLnggKz0gKCBkZWx0YU1TICogcm90YXRpb25YICk7XG4gICAgICAgICAgICAgICAgICAgIHZpei53ZWJDYW1IZWRyb25NZXNoLnJvdGF0aW9uLnkgKz0gKCBkZWx0YU1TICogcm90YXRpb25ZICk7XG4gICAgICAgICAgICAgICAgICAgIHZpei53ZWJDYW1IZWRyb25NZXNoLnJvdGF0aW9uLnogKz0gKCBkZWx0YU1TICogcm90YXRpb25aICk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgdml6LnNjZW5lLmFkZCggdml6LndlYkNhbUhlZHJvbk1lc2ggKTtcblxuICAgICAgICAgICAgICAgIC8vIFNob3cgaXQgb25seSBmb3IgdGhlIGN1YmUgY2FtXG4gICAgICAgICAgICAgICAgdml6LnByZUN1YmVDYW1SZW5kZXJGbnMucHVzaCggZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB2aXoud2ViQ2FtSGVkcm9uTWVzaC52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdml6LndlYkNhbUhlZHJvbk1lc2gubWF0ZXJpYWwuY29sb3Iuc2V0KCAweGZmZmZmZiApO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdml6LnBvc3RDdWJlQ2FtUmVuZGVyRm5zLnB1c2goIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdml6LndlYkNhbUhlZHJvbk1lc2gudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHZpei53ZWJDYW1IZWRyb25NZXNoLm1hdGVyaWFsLmNvbG9yLnNldCggMHhkOWQ1YjMgKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHJlc29sdmUoIHZpeiApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIExpZ2h0c1xuICAgIC8vIC0tLS0tLVxuICAgIGZ1bmN0aW9uIG1ha2VMaWdodHMgKCB2aXogKSB7XG4gICAgICAgIHJldHVybiBXLnByb21pc2UoIGZ1bmN0aW9uICggcmVzb2x2ZSwgcmVqZWN0ICkge1xuICAgICAgICAgICAgdml6LnNjZW5lLmFkZCggbmV3IFRIUkVFLkFtYmllbnRMaWdodCggMHgyMjIyMjIgKSApO1xuXG4gICAgICAgICAgICB2YXIgZGlyZWN0aW9uYWxMaWdodCA9IG5ldyBUSFJFRS5EaXJlY3Rpb25hbExpZ2h0KCAweGZmZmZmZiwgMiApO1xuICAgICAgICAgICAgZGlyZWN0aW9uYWxMaWdodC5wb3NpdGlvbi5zZXQoIDIsIDEuMiwgMTAgKS5ub3JtYWxpemUoKTtcbiAgICAgICAgICAgIHZpei5zY2VuZS5hZGQoIGRpcmVjdGlvbmFsTGlnaHQgKTtcblxuICAgICAgICAgICAgZGlyZWN0aW9uYWxMaWdodCA9IG5ldyBUSFJFRS5EaXJlY3Rpb25hbExpZ2h0KCAweGZmZmZmZiwgMSApO1xuICAgICAgICAgICAgZGlyZWN0aW9uYWxMaWdodC5wb3NpdGlvbi5zZXQoIC0yLCAxLjIsIC0xMCApLm5vcm1hbGl6ZSgpO1xuICAgICAgICAgICAgdml6LnNjZW5lLmFkZCggZGlyZWN0aW9uYWxMaWdodCApOyAgXG4gICAgICAgICAgICByZXNvbHZlKCB2aXogKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gU3dhcm1cbiAgICAvLyAtLS0tLVxuICAgIGZ1bmN0aW9uIG1ha2VTd2FybSAoIHZpeiApIHtcbiAgICAgICAgcmV0dXJuIFcucHJvbWlzZSggZnVuY3Rpb24gKCByZXNvbHZlLCByZWplY3QgKSB7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHZhciBwYXJ0aWNsZXMgPSBbXTtcblxuICAgICAgICAgICAgLy8gQWRkIHRvIFNjZW5lXG4gICAgICAgICAgICAvLyAtLS0tLS0tLS0tLS1cbiAgICAgICAgICAgIHZpei5zd2FybU9iamVjdDNEID0gbmV3IFRIUkVFLk9iamVjdDNEKCk7XG4gICAgICAgICAgICB2aXouc2NlbmUuYWRkKCB2aXouc3dhcm1PYmplY3QzRCApO1xuICAgICAgICAgICAgdml6LnByZUN1YmVDYW1SZW5kZXJGbnMucHVzaCggZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZpei5zd2FybU9iamVjdDNELnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdml6LnBvc3RDdWJlQ2FtUmVuZGVyRm5zLnB1c2goIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2aXouc3dhcm1PYmplY3QzRC52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBVcGRhdGluZ1xuICAgICAgICAgICAgYWRkUHJlUmVuZGVyRm4oIHZpeiwgZnVuY3Rpb24gKCBkZWx0YU1TLCB0aW1lc3RhbXBNUyApIHtcbiAgICAgICAgICAgICAgICBwYXJ0aWNsZXMuZm9yRWFjaCggcGFydGljbGUgPT4gcGFydGljbGUudXBkYXRlKCBkZWx0YU1TLCB0aW1lc3RhbXBNUyApICk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gUGFydGljbGUgQ2xhc3NcbiAgICAgICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tXG4gICAgICAgICAgICBmdW5jdGlvbiBQYXJ0aWNsZSAoIG1lc2ggKSB7XG5cbiAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5ID0gVy5yYW5kb21CZXR3ZWVuKCAwLjIsIDEgKTtcblxuICAgICAgICAgICAgICAgIC8vIE1lc2hcbiAgICAgICAgICAgICAgICB0aGlzLm1lc2ggPSBtZXNoLmNsb25lKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5tZXNoLm1hdGVyaWFsID0gUGFydGljbGUubWF0ZXJpYWwuY2xvbmUoKTtcbiAgICAgICAgICAgICAgICB0aGlzLm1lc2guc2NhbGUueCA9IFBhcnRpY2xlLmluaXRpYWxTY2FsZTtcbiAgICAgICAgICAgICAgICB0aGlzLm1lc2guc2NhbGUueSA9IFBhcnRpY2xlLmluaXRpYWxTY2FsZTtcbiAgICAgICAgICAgICAgICB0aGlzLm1lc2guc2NhbGUueiA9IFBhcnRpY2xlLmluaXRpYWxTY2FsZTtcblxuICAgICAgICAgICAgICAgIC8vIFBvc2l0aW9uXG4gICAgICAgICAgICAgICAgdmFyIHJhbmdlID0gMTAwO1xuICAgICAgICAgICAgICAgIHRoaXMubWVzaC5wb3NpdGlvbi5zZXQoICggTWF0aC5yYW5kb20oKSAtIDAuNSApICogcmFuZ2UsICggTWF0aC5yYW5kb20oKSAtIDAuNSApICogcmFuZ2UsICggTWF0aC5yYW5kb20oKSAtIDAuNSApICogcmFuZ2UgKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB0aGlzLmFuY2hvciA9IG5ldyBUSFJFRS5PYmplY3QzRCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuYW5jaG9yLmFkZCggdGhpcy5tZXNoICk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vICMjIyBTdGF0aWNcbiAgICAgICAgICAgIFBhcnRpY2xlLm1hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hQaG9uZ01hdGVyaWFsKCB7XG4gICAgICAgICAgICAgICAgY29sb3I6IDB4ZmZmZmZmLFxuICAgICAgICAgICAgICAgIHNoaW5pbmVzczogMC4wLFxuICAgICAgICAgICAgICAgIHNwZWN1bGFyOiAweGZmZmZmZixcbiAgICAgICAgICAgICAgICBlbnZNYXA6IHZpei5jdWJlQ2FtZXJhLnJlbmRlclRhcmdldCxcbiAgICAgICAgICAgICAgICByZWZsZWN0aXZpdHk6IDEuMCxcbiAgICAgICAgICAgICAgICBzaWRlOiBUSFJFRS5Eb3VibGVTaWRlXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgUGFydGljbGUuaW5pdGlhbFNjYWxlID0gMjAwO1xuXG4gICAgICAgICAgICAvLyAjIyMgTWV0aG9kXG4gICAgICAgICAgICBQYXJ0aWNsZS5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKCBkZWx0YU1TLCB0aW1lc3RhbXBNUyApIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFuY2hvci5yb3RhdGlvbi54ICs9IHZpei52ZWxvY2l0eVsgMCBdIC8gMTA7XG4gICAgICAgICAgICAgICAgdGhpcy5hbmNob3Iucm90YXRpb24ueSArPSB2aXoudmVsb2NpdHlbIDEgXSAvIDEwO1xuICAgICAgICAgICAgICAgIHRoaXMuYW5jaG9yLnJvdGF0aW9uLnogKz0gdml6LnZlbG9jaXR5WyAyIF0gLyAxMDtcbiAgICAgICAgICAgICAgICB0aGlzLm1lc2gucm90YXRpb24ueCArPSAwLjAwMjtcbiAgICAgICAgICAgICAgICB0aGlzLm1lc2gucm90YXRpb24ueSArPSAwLjAwMTtcbiAgICAgICAgICAgICAgICB0aGlzLm1lc2gucm90YXRpb24ueiArPSAwLjAwMztcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vIExvYWRlclxuICAgICAgICAgICAgLy8gLS0tLS0tXG4gICAgICAgICAgICB2YXIgbG9hZGVyID0gbmV3IFRIUkVFLk9CSkxvYWRlcigpO1xuICAgICAgICAgICAgbG9hZGVyLmxvYWQoICcvb2JqL3BpbGxvdy1ib3gub2JqJywgb25PYmpMb2FkZWQgKTtcblxuICAgICAgICAgICAgLy8gU3dhcm0gQ3JlYXRpb25cbiAgICAgICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgIGZ1bmN0aW9uIG9uT2JqTG9hZGVkICggb2JqICkge1xuXG4gICAgICAgICAgICAgICAgdmFyIG1lc2ggPSBvYmouY2hpbGRyZW5bIDAgXTtcblxuICAgICAgICAgICAgICAgIC8vIFBhcnRpY2xlIENyZWF0aW9uXG4gICAgICAgICAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgICAgICAvLyBFYXNlIGluIHRoZSBjcmVhdGlvbiBvZiB0aGUgcGFydGljbGVzXG4gICAgICAgICAgICAgICAgdmFyIG1heFBhcnRpY2xlcyA9IDEwMDtcbiAgICAgICAgICAgICAgICB2YXIgbWluQ3JlYXRpb25UaW1lID0gNTtcbiAgICAgICAgICAgICAgICB2YXIgbWF4Q3JlYXRpb25UaW1lTVMgPSAxMDA7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgKGZ1bmN0aW9uIGNyZWF0ZU1vcmUgKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIHBhcnRpY2xlcy5sZW5ndGggPCBtYXhQYXJ0aWNsZXMgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGFydGljbGUgPSBuZXcgUGFydGljbGUoIG1lc2ggKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZpei5zd2FybU9iamVjdDNELmFkZCggcGFydGljbGUuYW5jaG9yICk7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJ0aWNsZXMucHVzaCggcGFydGljbGUgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoIGNyZWF0ZU1vcmUsIFcubWFwKCBwYXJ0aWNsZXMubGVuZ3RoIC8gbWF4UGFydGljbGVzLCAwLCAxLCBtYXhDcmVhdGlvblRpbWVNUywgbWluQ3JlYXRpb25UaW1lLCBXLmludGVycG9sYXRpb25zLmVhc2VJbiApICk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXNvbHZlKCB2aXogKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gUmVuZGVyIExvb3BcbiAgICAvLyAtLS0tLS0tLS0tLVxuICAgIGZ1bmN0aW9uIG1ha2VSZW5kZXJMb29wICggdml6ICkge1xuICAgICAgICByZXR1cm4gVy5wcm9taXNlKCBmdW5jdGlvbiAoIHJlc29sdmUsIHJlamVjdCApIHtcblxuICAgICAgICAgICAgdmFyIGxhc3RUaW1lc3RhbXBNUyA9IDA7XG4gICAgICAgICAgICB2YXIgZGVsdGFNUyA9IDA7XG5cbiAgICAgICAgICAgIChmdW5jdGlvbiAgbG9vcCAoIGN1cnJlbnRUaW1lc3RhbXBNUyApIHtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyBSZWN1clxuICAgICAgICAgICAgICAgIC8vIC0tLS0tXG4gICAgICAgICAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSggbG9vcCApO1xuXG4gICAgICAgICAgICAgICAgLy8gVXBkYXRlIHRpbWVzdGFtcHNcbiAgICAgICAgICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgICAgICBkZWx0YU1TID0gY3VycmVudFRpbWVzdGFtcE1TIC0gbGFzdFRpbWVzdGFtcE1TO1xuICAgICAgICAgICAgICAgIGxhc3RUaW1lc3RhbXBNUyA9IGN1cnJlbnRUaW1lc3RhbXBNUztcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyBBY3Rpb25hYmxlc1xuICAgICAgICAgICAgICAgIC8vIC0tLS0tLS0tLS0tXG4gICAgICAgICAgICAgICAgdml6LnByZVJlbmRlckZucy5mb3JFYWNoKCBmbiA9PiBmbiggZGVsdGFNUywgY3VycmVudFRpbWVzdGFtcE1TICkgKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyBSZW5kZXJcbiAgICAgICAgICAgICAgICAvLyAtLS0tLS1cbiAgICAgICAgICAgICAgICB2aXoucmVuZGVyZXIuY2xlYXIoKTtcbiAgICAgICAgICAgICAgICB2aXoucmVuZGVyZXIucmVuZGVyKCB2aXouc2NlbmUsIHZpei5jYW1lcmEgKTtcblxuICAgICAgICAgICAgfSggbGFzdFRpbWVzdGFtcE1TICkpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXNvbHZlKCB2aXogKTtcbiAgICAgICAgfSk7XG5cbiAgICB9XG5cbiAgICAvLyBVdGlsc1xuICAgIC8vID09PT09XG5cbiAgICAvLyBSZW5kZXIgTG9vcFxuICAgIC8vIC0tLS0tLS0tLS0tXG4gICAgZnVuY3Rpb24gYWRkUHJlUmVuZGVyRm4gKCB2aXosIGZuICkge1xuICAgICAgICB2aXoucHJlUmVuZGVyRm5zLnB1c2goIGZuICk7XG4gICAgICAgIHJldHVybiB2aXo7XG4gICAgfVxuXG4gICAgLy8gQ2FtZXJhXG4gICAgLy8gLS0tLS0tXG4gICAgZnVuY3Rpb24gc2V0Q2FtZXJhUG9zaXRpb24gKCB2aXosIHgsIHksIHogKSB7XG4gICAgICAgIHZpei5jYW1lcmEucG9zaXRpb24ueCA9IHg7XG4gICAgICAgIHZpei5jYW1lcmEucG9zaXRpb24ueSA9IHk7XG4gICAgICAgIHZpei5jYW1lcmEucG9zaXRpb24ueiA9IHo7XG4gICAgICAgIHJldHVybiB2aXo7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2V0VmVsb2NpdHkgKCB2aXosIHgsIHksIHogKSB7XG4gICAgICAgIGlmICggVy5pc0RlZmluZWQoIHggKSAmJiB4ICE9PSBudWxsICkgeyB2aXoudmVsb2NpdHlbIDAgXSA9IHg7IH1cbiAgICAgICAgaWYgKCBXLmlzRGVmaW5lZCggeSApICYmIHkgIT09IG51bGwgKSB7IHZpei52ZWxvY2l0eVsgMSBdID0geTsgfVxuICAgICAgICBpZiAoIFcuaXNEZWZpbmVkKCB6ICkgJiYgeiAhPT0gbnVsbCApIHsgdml6LnZlbG9jaXR5WyAyIF0gPSB6OyB9XG4gICAgICAgIHJldHVybiB2aXo7XG4gICAgfVxuICAgIFxuICAgIC8vIEV4cG9ydFxuICAgIC8vID09PT09PSAgICBcbiAgICByZXR1cm4ge1xuICAgICAgICBtYWtlVml6OiBtYWtlVml6LFxuICAgICAgICBpbml0Vml6OiBpbml0Vml6LFxuICAgICAgICBzZXRWZWxvY2l0eTogc2V0VmVsb2NpdHlcbiAgICB9O1xuICAgIFxufSgpKTtcblxuXG5cblxuXG5cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==