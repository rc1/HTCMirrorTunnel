"use strict";function makeWebSocketClient(e){return W.promise(function(n,t){console.log("Connecting to websocket client:",e.wsUrl),e.wsClient=new W.JSONSocketConnection({socketUrl:e.wsUrl});var r=once(function(){$("[data-disconnected-warning]").remove(),report("CONNECTED","to:",e.wsUrl),n(e)});e.wsClient.on("open",r),e.wsClient.on("error",makeReporter("Web Socket Error")),e.wsClient.on("close",makeReporter("Web Socket Close")),e.wsClient.openSocketConnection()})}function makePunterVizs(e){return W.promise(function(n,t){$("[data-punter-viz]").toArray().map(function(n){e.punterViz=PunterViz.makeApp(),e.punterViz.containerEl=n;PunterViz.initApp(e.punterViz).error(function(e){console.error("Failed to create Punter app",e)}).success(function(n){console.log("Punter application made");var t=25.714285714,r=$(window).asEventStream("deviceorientation").map(function(e){return e.originalEvent.gamma});r.map(function(e){return-t>e?"backward":e>t?"forward":"none"}).skipDuplicates().throttle(100).onValue(function(n){RestesqueUtil.post(e.wsClient,"/motor/rotation/direction/",n)}),r.map(function(e){return Math.abs(e)}).map(function(e){return e>90-t?"high":e>90-2*t?"medium":"low"}).throttle(100).onValue(function(n){RestesqueUtil.post(e.wsClient,"/motor/rotation/speed/",n)})})}),n(e)})}function makeRestRadioButtons(e){return W.promise(function(n,t){$('[data-rest-type="radio-post"]').toArray().map($).map(function(n){var t=n.parent();t.on("click touchend",function(t){return t.preventDefault(),console.log("sending",n.val(),"to",n.data("restUri")),RestesqueUtil.post(e.wsClient,n.data("restUri"),n.val()),!1})}),$('[data-rest-type="feildset"]').toArray().map($).map(function(n){var t=n.find('input[type="radio"]').checkboxradio();console.log("got a field set",n.data("restUri")),RestesqueUtil.subscribeWithInitialGet(e.wsClient,n.data("restUri"),function(e){t.prop("checked",!1).checkboxradio("refresh").filter('input[value="'+e.getBody()+'"]').attr("checked","checked").checkboxradio("refresh").parent().find("label").removeClass("ui-radio-off").addClass("ui-radio-on")})}),n(e)})}function once(e){var n=!1;return function(){n||(e(),n=!0)}}function report(e,n){console.log("[",e,"]",W.rest(W.toArray(arguments)).join(" "))}function makeReporter(e,n){var t=arguments;return function(){report.apply(this,t);var e=arguments;return W.promise(function(n,t){n.apply(this,e)})}}var PunterViz=function(){function e(){return{containerEl:document.createElement("div"),backroundColor:6382180,preRenderFns:[],preCubeCamRenderFns:[],postCubeCamRenderFns:[]}}function n(e){return W.promise(function(n,t){e.camera=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,1,3e3),u(e,0,0,200),e.scene=new THREE.Scene,e.renderer=new THREE.WebGLRenderer({antialias:!1}),e.renderer.setPixelRatio(window.devicePixelRatio),e.renderer.setSize(window.innerWidth,window.innerHeight),e.renderer.setClearColor(e.backgroundColor),e.renderer.sortObjects=!1,e.containerEl.appendChild(e.renderer.domElement),n(e)})}function t(e){return W.promise(function(n,t){var r=document.createElement("video");r.autoplay=!0,navigator.webkitGetUserMedia({video:!0},function(e){r.src=URL.createObjectURL(e)},function(e){console.log("Failed to get a stream due to",e)}),e.webCamTexture=new THREE.Texture(r),e.webCamTexture.minFilter=THREE.LinearFilter,c(e,function(n,t){r.readyState===r.HAVE_ENOUGH_DATA&&(e.webCamTexture.needsUpdate=!0)}),n(e)})}function r(e){return W.promise(function(n,t){e.cubeCamera=new THREE.CubeCamera(1,3e3,256),e.cubeCamera.renderTarget.minFilter=THREE.LinearMipMapLinearFilter,c(e,function(n,t){e.preCubeCamRenderFns.forEach(function(e){return e(n,t)}),e.cubeCamera.updateCubeMap(e.renderer,e.scene),e.postCubeCamRenderFns.forEach(function(e){return e(n,t)})}),n(e)})}function o(e){return W.promise(function(n,t){var r=new THREE.MeshBasicMaterial({map:e.webCamTexture,color:16777215,side:THREE.BackSide});e.webCamvBoxMesh=new THREE.Mesh(new THREE.BoxGeometry(2e3,2e3,2e3),r);var o=W.randomBetween(2e-4,2e-5),i=W.randomBetween(2e-4,2e-5),a=W.randomBetween(2e-4,2e-5);c(e,function(n,t){e.webCamvBoxMesh.rotation.x+=n*o,e.webCamvBoxMesh.rotation.y+=n*i,e.webCamvBoxMesh.rotation.z+=n*a}),e.scene.add(e.webCamvBoxMesh),e.preCubeCamRenderFns.push(function(){e.webCamvBoxMesh.visible=!0}),e.postCubeCamRenderFns.push(function(){e.webCamvBoxMesh.visible=!0}),n(e)})}function i(e){return W.promise(function(n,t){e.scene.add(new THREE.AmbientLight(2236962));var r=new THREE.DirectionalLight(16777215,2);r.position.set(2,1.2,10).normalize(),e.scene.add(r),r=new THREE.DirectionalLight(16777215,1),r.position.set(-2,1.2,-10).normalize(),e.scene.add(r),n(e)})}function a(e){return W.promise(function(n,t){function r(n){{var t=n.children[0],r=100,a=5,s=100;!function c(){if(i.length<r){var n=new o(t);e.swarmObject3D.add(n.anchor),i.push(n),setTimeout(c,W.map(i.length/r,0,1,s,a,W.interpolations.easeIn))}}()}}function o(e){this.velocity=W.randomBetween(.2,1),this.mesh=e.clone(),this.mesh.material=o.material.clone(),this.mesh.scale.x=o.initialScale,this.mesh.scale.y=o.initialScale,this.mesh.scale.z=o.initialScale;var n=100;this.mesh.position.set((Math.random()-.5)*n,(Math.random()-.5)*n,(Math.random()-.5)*n),this.anchor=new THREE.Object3D,this.anchor.add(this.mesh)}var i=[];e.swarmObject3D=new THREE.Object3D,e.scene.add(e.swarmObject3D),e.preCubeCamRenderFns.push(function(){e.swarmObject3D.visible=!1}),e.postCubeCamRenderFns.push(function(){e.swarmObject3D.visible=!0});var a=new THREE.OBJLoader;a.load("/obj/pillow-box.obj",r),c(e,function(e,n){i.forEach(function(t){return t.update(e,n)})}),o.material=new THREE.MeshPhongMaterial({color:16777215,shininess:0,specular:16777215,envMap:e.cubeCamera.renderTarget,reflectivity:1,side:THREE.DoubleSide}),o.initialScale=200,o.prototype.update=function(e,n){this.anchor.rotation.x+=.002,this.anchor.rotation.y+=this.velocity/10,this.anchor.rotation.z+=.001},n(e)})}function s(e){return W.promise(function(n,t){var r=0,o=0;!function i(n){window.requestAnimationFrame(i),o=n-r,r=n,e.preRenderFns.forEach(function(e){return e(o,n)}),e.renderer.clear(),e.renderer.render(e.scene,e.camera)}(r),n(e)})}function c(e,n){e.preRenderFns.push(n)}function u(e,n,t,r){e.camera.position.x=n,e.camera.position.y=t,e.camera.position.z=r}var l=W.composePromisers(n,t,r,o,a,i,s);return{makeApp:e,initApp:l}}(),makeApp=function(){return{wsUrl:W.join("https:"===document.location.protocol?"wss://":"ws://",document.location.host,"/")}},initApp=W.composePromisers(makeWebSocketClient,makePunterVizs,makeRestRadioButtons);$(function(){initApp(makeApp()).success(function(e){report("OK","TheWorkers.net"),window.app=e})});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFsbC5qcyIsIm1haW4uanMiLCJwdW50ZXItdml6LmpzIl0sIm5hbWVzIjpbIm1ha2VXZWJTb2NrZXRDbGllbnQiLCJhcHAiLCJXIiwicHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJjb25zb2xlIiwibG9nIiwid3NVcmwiLCJ3c0NsaWVudCIsIkpTT05Tb2NrZXRDb25uZWN0aW9uIiwic29ja2V0VXJsIiwicmVzb2x2ZU9uRmlyc3RDb25uZWN0Iiwib25jZSIsIiQiLCJyZW1vdmUiLCJyZXBvcnQiLCJvbiIsIm1ha2VSZXBvcnRlciIsIm9wZW5Tb2NrZXRDb25uZWN0aW9uIiwibWFrZVB1bnRlclZpenMiLCJ0b0FycmF5IiwibWFwIiwiZWwiLCJwdW50ZXJWaXoiLCJQdW50ZXJWaXoiLCJtYWtlQXBwIiwiY29udGFpbmVyRWwiLCJpbml0QXBwIiwiZXJyb3IiLCJlcnIiLCJzdWNjZXNzIiwiaW5pdGFsaXNlZFB1bnRlckFwcCIsInJvdGF0aW9uU3RlcCIsImdhbW1hU3RyZWFtIiwid2luZG93IiwiYXNFdmVudFN0cmVhbSIsImUiLCJvcmlnaW5hbEV2ZW50IiwiZ2FtbWEiLCJnIiwic2tpcER1cGxpY2F0ZXMiLCJ0aHJvdHRsZSIsIm9uVmFsdWUiLCJkaXJlY3Rpb24iLCJSZXN0ZXNxdWVVdGlsIiwicG9zdCIsIk1hdGgiLCJhYnMiLCJzcGVlZCIsIm1ha2VSZXN0UmFkaW9CdXR0b25zIiwiJGVsIiwiJHdyYXBwZXJFbCIsInBhcmVudCIsInByZXZlbnREZWZhdWx0IiwidmFsIiwiZGF0YSIsInJhZGlvRWxzIiwiZmluZCIsImNoZWNrYm94cmFkaW8iLCJzdWJzY3JpYmVXaXRoSW5pdGlhbEdldCIsInBhY2tldCIsInByb3AiLCJmaWx0ZXIiLCJnZXRCb2R5IiwiYXR0ciIsInJlbW92ZUNsYXNzIiwiYWRkQ2xhc3MiLCJmbiIsImhhc1RyaWdnZXJlZCIsInN0YXR1cyIsInN0ciIsInJlc3QiLCJhcmd1bWVudHMiLCJqb2luIiwicmVwb3J0QXJncyIsImFwcGx5IiwidGhpcyIsImNhbGxlZUFyZ3MiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJiYWNrcm91bmRDb2xvciIsInByZVJlbmRlckZucyIsInByZUN1YmVDYW1SZW5kZXJGbnMiLCJwb3N0Q3ViZUNhbVJlbmRlckZucyIsIm1ha2VDYW1lcmFTY2VuZVJlbmRlcmVyIiwiY2FtZXJhIiwiVEhSRUUiLCJQZXJzcGVjdGl2ZUNhbWVyYSIsImlubmVyV2lkdGgiLCJpbm5lckhlaWdodCIsInNldENhbWVyYVBvc2l0aW9uIiwic2NlbmUiLCJTY2VuZSIsInJlbmRlcmVyIiwiV2ViR0xSZW5kZXJlciIsImFudGlhbGlhcyIsInNldFBpeGVsUmF0aW8iLCJkZXZpY2VQaXhlbFJhdGlvIiwic2V0U2l6ZSIsInNldENsZWFyQ29sb3IiLCJiYWNrZ3JvdW5kQ29sb3IiLCJzb3J0T2JqZWN0cyIsImFwcGVuZENoaWxkIiwiZG9tRWxlbWVudCIsIm1ha2VXZWJDYW1UZXh0dXJlIiwid2ViQ2FtRWwiLCJhdXRvcGxheSIsIm5hdmlnYXRvciIsIndlYmtpdEdldFVzZXJNZWRpYSIsInZpZGVvIiwic3RyZWFtIiwic3JjIiwiVVJMIiwiY3JlYXRlT2JqZWN0VVJMIiwid2ViQ2FtVGV4dHVyZSIsIlRleHR1cmUiLCJtaW5GaWx0ZXIiLCJMaW5lYXJGaWx0ZXIiLCJhZGRQcmVSZW5kZXJGbiIsImRldGxhTVMiLCJ0aW1lc3RhbXBNUyIsInJlYWR5U3RhdGUiLCJIQVZFX0VOT1VHSF9EQVRBIiwibmVlZHNVcGRhdGUiLCJtYWtlQ3ViZUNhbSIsImN1YmVDYW1lcmEiLCJDdWJlQ2FtZXJhIiwicmVuZGVyVGFyZ2V0IiwiTGluZWFyTWlwTWFwTGluZWFyRmlsdGVyIiwiZGVsdGFNUyIsImZvckVhY2giLCJ1cGRhdGVDdWJlTWFwIiwibWFrZVdlYkNhbUJveE1lc2giLCJ3ZWJDYW1Cb3hNYXRlcmlhbCIsIk1lc2hCYXNpY01hdGVyaWFsIiwiY29sb3IiLCJzaWRlIiwiQmFja1NpZGUiLCJ3ZWJDYW12Qm94TWVzaCIsIk1lc2giLCJCb3hHZW9tZXRyeSIsInJvdGF0aW9uWCIsInJhbmRvbUJldHdlZW4iLCJyb3RhdGlvblkiLCJyb3RhdGlvbloiLCJyb3RhdGlvbiIsIngiLCJ5IiwieiIsImFkZCIsInB1c2giLCJ2aXNpYmxlIiwibWFrZUxpZ2h0cyIsIkFtYmllbnRMaWdodCIsImRpcmVjdGlvbmFsTGlnaHQiLCJEaXJlY3Rpb25hbExpZ2h0IiwicG9zaXRpb24iLCJzZXQiLCJub3JtYWxpemUiLCJtYWtlU3dhcm0iLCJvbk9iakxvYWRlZCIsIm9iaiIsIm1lc2giLCJjaGlsZHJlbiIsIm1heFBhcnRpY2xlcyIsIm1pbkNyZWF0aW9uVGltZSIsIm1heENyZWF0aW9uVGltZU1TIiwiY3JlYXRlTW9yZSIsInBhcnRpY2xlcyIsImxlbmd0aCIsInBhcnRpY2xlIiwiUGFydGljbGUiLCJzd2FybU9iamVjdDNEIiwiYW5jaG9yIiwic2V0VGltZW91dCIsImludGVycG9sYXRpb25zIiwiZWFzZUluIiwidmVsb2NpdHkiLCJjbG9uZSIsIm1hdGVyaWFsIiwic2NhbGUiLCJpbml0aWFsU2NhbGUiLCJyYW5nZSIsInJhbmRvbSIsIk9iamVjdDNEIiwibG9hZGVyIiwiT0JKTG9hZGVyIiwibG9hZCIsInVwZGF0ZSIsIk1lc2hQaG9uZ01hdGVyaWFsIiwic2hpbmluZXNzIiwic3BlY3VsYXIiLCJlbnZNYXAiLCJyZWZsZWN0aXZpdHkiLCJEb3VibGVTaWRlIiwicHJvdG90eXBlIiwibWFrZVJlbmRlckxvb3AiLCJsYXN0VGltZXN0YW1wTVMiLCJsb29wIiwiY3VycmVudFRpbWVzdGFtcE1TIiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwiY2xlYXIiLCJyZW5kZXIiLCJjb21wb3NlUHJvbWlzZXJzIiwibG9jYXRpb24iLCJwcm90b2NvbCIsImhvc3QiXSwibWFwcGluZ3MiOiJBQVFBLFlDd0JBLFNBQVNBLHFCQUFzQkMsR0FDM0IsTUFBT0MsR0FBRUMsUUFBUyxTQUFXQyxFQUFTQyxHQUNsQ0MsUUFBUUMsSUFBSyxrQ0FBbUNOLEVB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Q0lsQixNQUFPTixFQUFFd0UsS0FBcUMsV0FBL0JLLFNBQVM4SCxTQUFTQyxTQUF3QixTQUFXLFFBQ3JEL0gsU0FBUzhILFNBQVNFLEtBQ2xCLE9BSW5CbkwsUUFBVTFCLEVBQUUwTSxpQkFBa0I1TSxvQkFDQW9CLGVBQ0E4QixxQkFFbENwQyxHQUFHLFdBQ0NjLFFBQVNGLFdBQ1JLLFFBQVMsU0FBVzlCLEdBQ2pCZSxPQUFRLEtBQU0sa0JBQ2RtQixPQUFPbEMsSUFBTUEiLCJmaWxlIjoiYWxsLmpzIiwic291cmNlc0NvbnRlbnQiOltudWxsLCIvKiBqc2hpbnQgZXNuZXh0OiB0cnVlICovXG5cbi8vIE1haW4uanNcbi8vID09PT09PT1cbi8vIEVudHJ5IHBvaW50IG9mIHRoZSBhcHBsaWNhdGlvbi5cblxuLy8gTWFrZSAmIEluaXRcbi8vID09PT09PT09PT09XG5cbnZhciBtYWtlQXBwID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB7XG4gICAgICAgIHdzVXJsOiBXLmpvaW4oIGRvY3VtZW50LmxvY2F0aW9uLnByb3RvY29sID09PSAnaHR0cHM6JyA/ICd3c3M6Ly8nIDogJ3dzOi8vJyxcbiAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQubG9jYXRpb24uaG9zdCwgLy9kb2N1bWVudC4nLy8vJy8vJ3dzczovLzE5Mi4xNjguMC43OjcwODAnXG4gICAgICAgICAgICAgICAgICAgICAgICcvJyApXG4gICAgfTtcbn07XG5cbnZhciBpbml0QXBwID0gVy5jb21wb3NlUHJvbWlzZXJzKCBtYWtlV2ViU29ja2V0Q2xpZW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ha2VQdW50ZXJWaXpzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ha2VSZXN0UmFkaW9CdXR0b25zICk7XG5cbiQoIGZ1bmN0aW9uICgpIHtcbiAgICBpbml0QXBwKCBtYWtlQXBwKCkgKVxuICAgIC5zdWNjZXNzKCBmdW5jdGlvbiAoIGFwcCApIHtcbiAgICAgICAgcmVwb3J0KCAnT0snLCAnVGhlV29ya2Vycy5uZXQnICk7XG4gICAgICAgIHdpbmRvdy5hcHAgPSBhcHA7XG4gICAgfSk7XG59KTtcblxuLy8gUHJvbWlzZXJzXG4vLyA9PT09PT09PT1cblxuZnVuY3Rpb24gbWFrZVdlYlNvY2tldENsaWVudCAoIGFwcCApIHtcbiAgICByZXR1cm4gVy5wcm9taXNlKCBmdW5jdGlvbiAoIHJlc29sdmUsIHJlamVjdCApIHtcbiAgICAgICAgY29uc29sZS5sb2coICdDb25uZWN0aW5nIHRvIHdlYnNvY2tldCBjbGllbnQ6JywgYXBwLndzVXJsICk7XG4gICAgICAgIFxuICAgICAgICBhcHAud3NDbGllbnQgPSBuZXcgVy5KU09OU29ja2V0Q29ubmVjdGlvbih7XG4gICAgICAgICAgICBzb2NrZXRVcmw6IGFwcC53c1VybFxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIHZhciByZXNvbHZlT25GaXJzdENvbm5lY3QgPSBvbmNlKCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkKCAnW2RhdGEtZGlzY29ubmVjdGVkLXdhcm5pbmddJyApLnJlbW92ZSgpO1xuICAgICAgICAgICAgcmVwb3J0KCAnQ09OTkVDVEVEJywgJ3RvOicsIGFwcC53c1VybCApO1xuICAgICAgICAgICAgcmVzb2x2ZSggYXBwICk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGFwcC53c0NsaWVudC5vbiggJ29wZW4nLCByZXNvbHZlT25GaXJzdENvbm5lY3QgKTtcbiAgICAgICAgYXBwLndzQ2xpZW50Lm9uKCAnZXJyb3InLCBtYWtlUmVwb3J0ZXIoICdXZWIgU29ja2V0IEVycm9yJyApICk7XG4gICAgICAgIGFwcC53c0NsaWVudC5vbiggJ2Nsb3NlJywgbWFrZVJlcG9ydGVyKCAnV2ViIFNvY2tldCBDbG9zZScgKSApO1xuICAgICAgICBhcHAud3NDbGllbnQub3BlblNvY2tldENvbm5lY3Rpb24oKTtcbiAgICAgICAgXG4gICAgfSk7XG59XG5cbi8vIFB1bnRlciBWaXpcbi8vIC0tLS0tLS0tLS1cblxuZnVuY3Rpb24gbWFrZVB1bnRlclZpenMgKCBhcHAgKSB7XG4gICAgcmV0dXJuIFcucHJvbWlzZSggZnVuY3Rpb24gKCByZXNvbHZlLCByZWplY3QgKSB7XG4gICAgICAgICQoIFwiW2RhdGEtcHVudGVyLXZpel1cIiApXG4gICAgICAgICAgICAudG9BcnJheSgpXG4gICAgICAgICAgICAubWFwKCBmdW5jdGlvbiAoIGVsICkge1xuICAgICAgICAgICAgICAgIC8vIE1ha2UgdGhlIHB1bnRlciBhcHBsaWNhdGlvblxuICAgICAgICAgICAgICAgIGFwcC5wdW50ZXJWaXogPSBQdW50ZXJWaXoubWFrZUFwcCgpO1xuICAgICAgICAgICAgICAgIC8vIEFkZCBvdXQgZG9tIGVsZW1lbnRcbiAgICAgICAgICAgICAgICBhcHAucHVudGVyVml6LmNvbnRhaW5lckVsID0gZWw7XG5cbiAgICAgICAgICAgICAgICAvLyBJbml0YWlsaXNlIGl0XG5cbiAgICAgICAgICAgICAgICB2YXIgRk9SV0FSRFNfSElHSCA9IFsgWyAnLycgXSBdIFxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIFB1bnRlclZpelxuICAgICAgICAgICAgICAgICAgICAuaW5pdEFwcCggYXBwLnB1bnRlclZpeiApXG4gICAgICAgICAgICAgICAgICAgIC5lcnJvciggZnVuY3Rpb24gKCBlcnIgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCAnRmFpbGVkIHRvIGNyZWF0ZSBQdW50ZXIgYXBwJywgZXJyICk7XG4gICAgICAgICAgICAgICAgICAgIH0pIFxuICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyggZnVuY3Rpb24gKCBpbml0YWxpc2VkUHVudGVyQXBwICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coICdQdW50ZXIgYXBwbGljYXRpb24gbWFkZScgKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJvdGF0aW9uU3RlcCA9IDI1LjcxNDI4NTcxNDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWRkIHRoZSByb3RhdGlvbiBjb250cm9sc1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZ2FtbWEgcmlnaHQgOTAsIGxlZnQgLTkwXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZ2FtbWFTdHJlYW0gPSAkKCB3aW5kb3cgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXNFdmVudFN0cmVhbSggJ2RldmljZW9yaWVudGF0aW9uJyApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5tYXAoIGUgPT4gZS5vcmlnaW5hbEV2ZW50LmdhbW1hICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFsgYmgsIGJtLCBibCwgbiwgZmwsIGZtLCBmaCBdXG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvcndhcmRzICYgQmFja3dhcmRzXG4gICAgICAgICAgICAgICAgICAgICAgICBnYW1tYVN0cmVhbVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5tYXAoIGZ1bmN0aW9uICggZyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBnIDwgLXJvdGF0aW9uU3RlcCApIHsgcmV0dXJuICdiYWNrd2FyZCc7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoIGcgPiByb3RhdGlvblN0ZXAgKSB7IHJldHVybiAnZm9yd2FyZCc7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7IHJldHVybiAnbm9uZSc7IH0gXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2tpcER1cGxpY2F0ZXMoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aHJvdHRsZSggMTAwIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAub25WYWx1ZSggZnVuY3Rpb24gKCBkaXJlY3Rpb24gKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlc3Rlc3F1ZVV0aWwucG9zdCggYXBwLndzQ2xpZW50LCAnL21vdG9yL3JvdGF0aW9uL2RpcmVjdGlvbi8nLCBkaXJlY3Rpb24gKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3BlZWRcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhbW1hU3RyZWFtXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLm1hcCggZyA9PiBNYXRoLmFicyggZyApIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAubWFwKCBmdW5jdGlvbiAoIGcgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggZyA+IDkwIC0gcm90YXRpb25TdGVwICkgeyByZXR1cm4gJ2hpZ2gnOyB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKCBnID4gOTAgLSAoIHJvdGF0aW9uU3RlcCAqIDIgKSApIHsgcmV0dXJuICdtZWRpdW0nOyB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgeyByZXR1cm4gJ2xvdyc7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aHJvdHRsZSggMTAwIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAub25WYWx1ZSggZnVuY3Rpb24gKCBzcGVlZCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVzdGVzcXVlVXRpbC5wb3N0KCBhcHAud3NDbGllbnQsICcvbW90b3Ivcm90YXRpb24vc3BlZWQvJywgc3BlZWQgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgcmVzb2x2ZSggYXBwICk7XG4gICAgfSk7XG59XG5cbi8vIGpRdWVyeSBNb2JpbGUgVWkgQmluZGluZ3Ncbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuZnVuY3Rpb24gbWFrZVJlc3RSYWRpb0J1dHRvbnMgKCBhcHAgKSB7XG4gICAgcmV0dXJuIFcucHJvbWlzZSggZnVuY3Rpb24gKCByZXNvbHZlLCByZWplY3QgKSB7XG4gICAgICAgIC8vIFJhZGlvIEJ1dHRvbnNcbiAgICAgICAgLy8gPT09PT09PT09PT09PVxuICAgICAgICAkKCAnW2RhdGEtcmVzdC10eXBlPVwicmFkaW8tcG9zdFwiXScgKVxuICAgICAgICAgICAgLnRvQXJyYXkoKVxuICAgICAgICAgICAgLm1hcCggJCApXG4gICAgICAgICAgICAubWFwKCBmdW5jdGlvbiAoICRlbCApIHtcbiAgICAgICAgICAgICAgICAvLyBEaXNhYmxlIHJlYWwgZXZlbnRzXG4gICAgICAgICAgICAgICAgdmFyICR3cmFwcGVyRWwgPSAkZWwucGFyZW50KCk7XG4gICAgICAgICAgICAgICAgJHdyYXBwZXJFbC5vbiggJ2NsaWNrIHRvdWNoZW5kJywgZnVuY3Rpb24gKCBlICkge1xuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnc2VuZGluZycsJGVsLnZhbCgpLCAndG8nLCAkZWwuZGF0YSggJ3Jlc3RVcmknICkgICk7XG4gICAgICAgICAgICAgICAgICAgIFJlc3Rlc3F1ZVV0aWwucG9zdCggYXBwLndzQ2xpZW50LCAkZWwuZGF0YSggJ3Jlc3RVcmknICksICRlbC52YWwoKSApO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAvLyBSYWRpbyBGaWVsZCBTZXRzXG4gICAgICAgIC8vID09PT09PT09PT09PT09PT1cbiAgICAgICAgJCggJ1tkYXRhLXJlc3QtdHlwZT1cImZlaWxkc2V0XCJdJyApXG4gICAgICAgICAgICAudG9BcnJheSgpXG4gICAgICAgICAgICAubWFwKCAkIClcbiAgICAgICAgICAgIC5tYXAoIGZ1bmN0aW9uICggJGVsICkge1xuXG4gICAgICAgICAgICAgICAgdmFyIHJhZGlvRWxzID0gJGVsLmZpbmQoICdpbnB1dFt0eXBlPVwicmFkaW9cIl0nICkuY2hlY2tib3hyYWRpbygpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCAgJ2dvdCBhIGZpZWxkIHNldCcsICRlbC5kYXRhKCAncmVzdFVyaScgKSApO1xuICAgICAgICAgICAgICAgIFJlc3Rlc3F1ZVV0aWwuc3Vic2NyaWJlV2l0aEluaXRpYWxHZXQoIGFwcC53c0NsaWVudCwgJGVsLmRhdGEoICdyZXN0VXJpJyApLCBmdW5jdGlvbiAoIHBhY2tldCApIHtcbiAgICAgICAgICAgICAgICAgICAgcmFkaW9FbHNcbiAgICAgICAgICAgICAgICAgICAgICAgIC5wcm9wKCAnY2hlY2tlZCcsIGZhbHNlIClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jaGVja2JveHJhZGlvKCAncmVmcmVzaCcgKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmZpbHRlciggJ2lucHV0W3ZhbHVlPVwiJysgcGFja2V0LmdldEJvZHkoKSArJ1wiXScgKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoICdjaGVja2VkJywgJ2NoZWNrZWQnIClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jaGVja2JveHJhZGlvKCAncmVmcmVzaCcgKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnBhcmVudCgpXG4gICAgICAgICAgICAgICAgICAgICAgICAuZmluZCggJ2xhYmVsJyApXG4gICAgICAgICAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoICd1aS1yYWRpby1vZmYnIClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcyggJ3VpLXJhZGlvLW9uJyApO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICByZXNvbHZlKCBhcHAgKTtcbiAgICB9KTtcbn1cblxuLy8gVXRpbHNcbi8vID09PT09XG5cbi8vIEZ1bmN0aW9uXG4vLyAtLS0tLS0tLVxuICAgIFxuZnVuY3Rpb24gb25jZSAoIGZuICkge1xuICAgIHZhciBoYXNUcmlnZ2VyZWQgPSBmYWxzZTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoICEgaGFzVHJpZ2dlcmVkICkge1xuICAgICAgICAgICAgZm4oKTtcbiAgICAgICAgICAgIGhhc1RyaWdnZXJlZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9O1xufVxuXG4vLyBSZXBvcnRpbmdcbi8vIC0tLS0tLS0tLVxuXG5mdW5jdGlvbiByZXBvcnQoIHN0YXR1cywgc3RyICkge1xuICAgIGNvbnNvbGUubG9nKCAnWycsIHN0YXR1cywgJ10nLCBXLnJlc3QoIFcudG9BcnJheSggYXJndW1lbnRzICkgKS5qb2luKCAnICcgKSApO1xufVxuXG5mdW5jdGlvbiBtYWtlUmVwb3J0ZXIoIHN0YXR1cywgc3RyICkge1xuICAgIHZhciByZXBvcnRBcmdzID0gYXJndW1lbnRzO1xuICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJlcG9ydC5hcHBseSggdGhpcywgcmVwb3J0QXJncyApO1xuICAgICAgICB2YXIgY2FsbGVlQXJncyA9IGFyZ3VtZW50cztcbiAgICAgICAgcmV0dXJuIFcucHJvbWlzZSggZnVuY3Rpb24gKCByZXNvbHZlLCByZWplY3QgKSB7XG4gICAgICAgICAgICByZXNvbHZlLmFwcGx5KCB0aGlzLCBjYWxsZWVBcmdzICk7XG4gICAgICAgIH0pO1xuICAgIH07XG59XG4iLCIvKiBqc2hpbnQgZXNuZXh0OiB0cnVlICovXG5cbi8vIFB1bnRlciBWaXpcbi8vID09PT09PT09PT1cbi8vIEEgdGhyZWUuanMgdmlzdWxpc2F0aW9uIHRvIGJlXG4vLyBydW4gb24gYW4gSFRDIHBob25lIGFuZCBjYXJyaWVkIGJ5XG4vLyBwdW50ZXJzIGludG8gdGhlIG1pcnJvciBib3guXG5cbnZhciBQdW50ZXJWaXogPSAoZnVuY3Rpb24gKCkge1xuXG4gICAgLy8gSW5pdCAmIG1ha2VcbiAgICAvLyA9PT09PT09PT09PVxuICAgIGZ1bmN0aW9uIG1ha2VBcHAgKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY29udGFpbmVyRWw6IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdkaXYnICksXG4gICAgICAgICAgICBiYWNrcm91bmRDb2xvcjogMHg2MTYyNjQsXG4gICAgICAgICAgICBwcmVSZW5kZXJGbnM6IFtdLFxuICAgICAgICAgICAgcHJlQ3ViZUNhbVJlbmRlckZuczogW10sXG4gICAgICAgICAgICBwb3N0Q3ViZUNhbVJlbmRlckZuczogW11cbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICB2YXIgaW5pdEFwcCA9IFcuY29tcG9zZVByb21pc2VycyggbWFrZUNhbWVyYVNjZW5lUmVuZGVyZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ha2VXZWJDYW1UZXh0dXJlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYWtlQ3ViZUNhbSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFrZVdlYkNhbUJveE1lc2gsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ha2VTd2FybSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFrZUxpZ2h0cyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFrZVJlbmRlckxvb3AgKTtcblxuICAgIC8vIFByb21pc2Vyc1xuICAgIC8vID09PT09PT09PVxuXG4gICAgLy8gQ2FtZXJhLCBTY2VuZSwgUmVuZGVyZXJcbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGZ1bmN0aW9uIG1ha2VDYW1lcmFTY2VuZVJlbmRlcmVyICggYXBwICkge1xuICAgICAgICByZXR1cm4gVy5wcm9taXNlKCBmdW5jdGlvbiAoIHJlc29sdmUsIHJlamVjdCApIHtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gQ2FtZXJhXG4gICAgICAgICAgICAvLyAtLS0tLS1cbiAgICAgICAgICAgIGFwcC5jYW1lcmEgPSBuZXcgVEhSRUUuUGVyc3BlY3RpdmVDYW1lcmEoIDcwLCB3aW5kb3cuaW5uZXJXaWR0aCAvIHdpbmRvdy5pbm5lckhlaWdodCwgMSwgMzAwMCApO1xuICAgICAgICAgICAgc2V0Q2FtZXJhUG9zaXRpb24oIGFwcCwgMCwgMCwgMjAwICk7XG5cbiAgICAgICAgICAgIC8vIFNjZW5lXG4gICAgICAgICAgICAvLyAtLS0tLVxuICAgICAgICAgICAgYXBwLnNjZW5lID0gbmV3IFRIUkVFLlNjZW5lKCk7XG5cbiAgICAgICAgICAgIC8vIFJlbmRlcmVyXG4gICAgICAgICAgICAvLyAtLS0tLS0tLVxuICAgICAgICAgICAgYXBwLnJlbmRlcmVyID0gbmV3IFRIUkVFLldlYkdMUmVuZGVyZXIoIHsgYW50aWFsaWFzOiBmYWxzZSB9ICk7XG5cdCAgICBhcHAucmVuZGVyZXIuc2V0UGl4ZWxSYXRpbyggd2luZG93LmRldmljZVBpeGVsUmF0aW8gKTtcblx0ICAgIGFwcC5yZW5kZXJlci5zZXRTaXplKCB3aW5kb3cuaW5uZXJXaWR0aCwgd2luZG93LmlubmVySGVpZ2h0ICk7XG4gICAgICAgICAgICBhcHAucmVuZGVyZXIuc2V0Q2xlYXJDb2xvciggYXBwLmJhY2tncm91bmRDb2xvciApO1xuXHQgICAgYXBwLnJlbmRlcmVyLnNvcnRPYmplY3RzID0gZmFsc2U7XG5cbiAgICAgICAgICAgIGFwcC5jb250YWluZXJFbC5hcHBlbmRDaGlsZCggYXBwLnJlbmRlcmVyLmRvbUVsZW1lbnQgKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcmVzb2x2ZSggYXBwICk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFdlYiBDYW1cbiAgICAvLyAtLS0tLS0tXG4gICAgLy8gTWFrZSB0aGUgd2ViIGNhbSBhdmFpbGFibGUgYXMgYSB0ZXh0dXJlXG4gICAgZnVuY3Rpb24gbWFrZVdlYkNhbVRleHR1cmUgKCBhcHAgKSB7XG4gICAgICAgIHJldHVybiBXLnByb21pc2UoIGZ1bmN0aW9uICggcmVzb2x2ZSwgcmVqZWN0ICkge1xuXG4gICAgICAgICAgICAvLyBXZWIgQ2FtIERPTSBFbGVtZW50XG4gICAgICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgICAgICB2YXIgd2ViQ2FtRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd2aWRlbycpO1xuICAgICAgICAgICAgd2ViQ2FtRWwuYXV0b3BsYXkgPSB0cnVlO1xuXG4gICAgICAgICAgICAvLyBXZWIgQ2FtIFN0cmVhbVxuICAgICAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgIG5hdmlnYXRvci53ZWJraXRHZXRVc2VyTWVkaWEoIHsgdmlkZW86dHJ1ZSB9LCBmdW5jdGlvbiggc3RyZWFtICl7XG4gICAgICAgICAgICAgICAgd2ViQ2FtRWwuc3JjID0gVVJMLmNyZWF0ZU9iamVjdFVSTCggc3RyZWFtICk7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbiggZXJyICl7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJGYWlsZWQgdG8gZ2V0IGEgc3RyZWFtIGR1ZSB0b1wiLCBlcnIpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIFdlYiBDYW0gVGV4dHVyZVxuICAgICAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgICAgICBhcHAud2ViQ2FtVGV4dHVyZSA9IG5ldyBUSFJFRS5UZXh0dXJlKCB3ZWJDYW1FbCApO1xuICAgICAgICAgICAgYXBwLndlYkNhbVRleHR1cmUubWluRmlsdGVyID0gVEhSRUUuTGluZWFyRmlsdGVyO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBSZW5kZXIgVXBkYXRlc1xuICAgICAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgIGFkZFByZVJlbmRlckZuKCBhcHAsIGZ1bmN0aW9uICggZGV0bGFNUywgdGltZXN0YW1wTVMgKSB7XG4gICAgICAgICAgICAgICAgaWYoIHdlYkNhbUVsLnJlYWR5U3RhdGUgPT09IHdlYkNhbUVsLkhBVkVfRU5PVUdIX0RBVEEgKXtcbiAgICAgICAgICAgICAgICAgICAgYXBwLndlYkNhbVRleHR1cmUubmVlZHNVcGRhdGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXNvbHZlKCBhcHAgKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQ3ViZSBDYW1lcmFcbiAgICAvLyAtLS0tLS0tLS0tLVxuICAgIC8vIENyZWF0ZSBhIGN1YmUgY2FtIGZvciBhIGR5bmFtaWMgZW52TWFwLlxuICAgIC8vIFRoaXMgYWxzbyBlbmFibGVzIHR3byBob29rczogYHByZUN1YmVDYW1SZW5kZXJBY3Rpb25zYCAmIGBwb3N0Q3ViZUNhbVJlbmRlckFjdGlvbnNgXG4gICAgLy8gaW4gdGhlIGFwcCBmb3IgdGhhdCBvYmplY3QzRCBpbiB0aGUgc2NlbmUgY2FuIGJlIHR1cm5lZCBvbiBhbmQgb2ZmIGR1cmluZ1xuICAgIC8vIHRoZSB3ZWJjYW1zIHJlbmRlclxuICAgIGZ1bmN0aW9uIG1ha2VDdWJlQ2FtICggYXBwICkgeyBcbiAgICAgICAgcmV0dXJuIFcucHJvbWlzZSggZnVuY3Rpb24gKCByZXNvbHZlLCByZWplY3QgKSB7XG5cbiAgICAgICAgICAgIGFwcC5jdWJlQ2FtZXJhID0gbmV3IFRIUkVFLkN1YmVDYW1lcmEoMSwgMzAwMCwgMjU2KTsgLy8gbmVhciwgZmFyLCByZXNvbHV0aW9uXG4gICAgICAgICAgICBhcHAuY3ViZUNhbWVyYS5yZW5kZXJUYXJnZXQubWluRmlsdGVyID0gVEhSRUUuTGluZWFyTWlwTWFwTGluZWFyRmlsdGVyOyAvLyBtaXBtYXAgZmlsdGVyXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGFkZFByZVJlbmRlckZuKCBhcHAsIGZ1bmN0aW9uICggZGVsdGFNUywgdGltZXN0YW1wTVMgKSB7ICAgIFxuICAgICAgICAgICAgICAgIC8vIFJlbmRlciB0aGUgY3ViZSBjYW1lcmEgdG8gY3ViZSBtYXBcbiAgICAgICAgICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgICAgICAgICAgYXBwLnByZUN1YmVDYW1SZW5kZXJGbnMuZm9yRWFjaCggZm4gPT4gZm4oIGRlbHRhTVMsIHRpbWVzdGFtcE1TICkgKTtcbiAgICAgICAgICAgICAgICBhcHAuY3ViZUNhbWVyYS51cGRhdGVDdWJlTWFwKCBhcHAucmVuZGVyZXIsIGFwcC5zY2VuZSApO1xuICAgICAgICAgICAgICAgIGFwcC5wb3N0Q3ViZUNhbVJlbmRlckZucy5mb3JFYWNoKCBmbiA9PiBmbiggZGVsdGFNUywgdGltZXN0YW1wTVMgKSApO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHJlc29sdmUoIGFwcCApO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBXZWIgQ2FtIEJveCBNZXNoXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIENyZWF0ZXMgYSBib3ggd2l0aCB0aGUgd2ViIGNhbSBkaXNwbGF5ZWRcbiAgICAvLyBvbiB0aGUgaW5zaWRlIG9mIGVhY2ggb2YgaXQncyA2IHNpZGVzXG4gICAgZnVuY3Rpb24gbWFrZVdlYkNhbUJveE1lc2ggKCBhcHAgKSB7XG4gICAgICAgIHJldHVybiBXLnByb21pc2UoIGZ1bmN0aW9uICggcmVzb2x2ZSwgcmVqZWN0ICkge1xuICAgICAgICAgICAgXG4gICAgICAgICAgICB2YXIgd2ViQ2FtQm94TWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoe1xuICAgICAgICAgICAgICAgIG1hcDogYXBwLndlYkNhbVRleHR1cmUsXG4gICAgICAgICAgICAgICAgY29sb3I6IDB4ZmZmZmZmLFxuXHQgICAgICAgIHNpZGU6IFRIUkVFLkJhY2tTaWRlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgYXBwLndlYkNhbXZCb3hNZXNoID0gbmV3IFRIUkVFLk1lc2goIG5ldyBUSFJFRS5Cb3hHZW9tZXRyeSggMjAwMCwgMjAwMCwgMjAwMCApLCB3ZWJDYW1Cb3hNYXRlcmlhbCApO1xuXG4gICAgICAgICAgICB2YXIgcm90YXRpb25YID0gVy5yYW5kb21CZXR3ZWVuKCAwLjAwMDIsIDAuMDAwMDIgKTtcbiAgICAgICAgICAgIHZhciByb3RhdGlvblkgPSBXLnJhbmRvbUJldHdlZW4oIDAuMDAwMiwgMC4wMDAwMiApO1xuICAgICAgICAgICAgdmFyIHJvdGF0aW9uWiA9IFcucmFuZG9tQmV0d2VlbiggMC4wMDAyLCAwLjAwMDAyICk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIElmIHdlIHdhbnQgdG8gcm90YXRlIGl0XG4gICAgICAgICAgICBhZGRQcmVSZW5kZXJGbiggYXBwLCBmdW5jdGlvbiAoIGRlbHRhTVMsIHRpbWVzdGFtcE1TICkge1xuICAgICAgICAgICAgICAgIGFwcC53ZWJDYW12Qm94TWVzaC5yb3RhdGlvbi54ICs9ICggZGVsdGFNUyAqIHJvdGF0aW9uWCApO1xuICAgICAgICAgICAgICAgIGFwcC53ZWJDYW12Qm94TWVzaC5yb3RhdGlvbi55ICs9ICggZGVsdGFNUyAqIHJvdGF0aW9uWSApO1xuICAgICAgICAgICAgICAgIGFwcC53ZWJDYW12Qm94TWVzaC5yb3RhdGlvbi56ICs9ICggZGVsdGFNUyAqIHJvdGF0aW9uWiApO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBcblx0ICAgIGFwcC5zY2VuZS5hZGQoIGFwcC53ZWJDYW12Qm94TWVzaCApO1xuXG4gICAgICAgICAgICAvLyBTaG93IGl0IG9ubHkgZm9yIHRoZSBjdWJlIGNhbVxuICAgICAgICAgICAgYXBwLnByZUN1YmVDYW1SZW5kZXJGbnMucHVzaCggZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGFwcC53ZWJDYW12Qm94TWVzaC52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBhcHAucG9zdEN1YmVDYW1SZW5kZXJGbnMucHVzaCggZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGFwcC53ZWJDYW12Qm94TWVzaC52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBcblxuICAgICAgICAgICAgcmVzb2x2ZSggYXBwICk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIExpZ2h0c1xuICAgIC8vIC0tLS0tLVxuICAgIGZ1bmN0aW9uIG1ha2VMaWdodHMgKCBhcHAgKSB7XG4gICAgICAgIHJldHVybiBXLnByb21pc2UoIGZ1bmN0aW9uICggcmVzb2x2ZSwgcmVqZWN0ICkge1xuICAgICAgICAgICAgYXBwLnNjZW5lLmFkZCggbmV3IFRIUkVFLkFtYmllbnRMaWdodCggMHgyMjIyMjIgKSApO1xuXG4gICAgICAgICAgICB2YXIgZGlyZWN0aW9uYWxMaWdodCA9IG5ldyBUSFJFRS5EaXJlY3Rpb25hbExpZ2h0KCAweGZmZmZmZiwgMiApO1xuXHQgICAgZGlyZWN0aW9uYWxMaWdodC5wb3NpdGlvbi5zZXQoIDIsIDEuMiwgMTAgKS5ub3JtYWxpemUoKTtcblx0ICAgIGFwcC5zY2VuZS5hZGQoIGRpcmVjdGlvbmFsTGlnaHQgKTtcblxuXHQgICAgZGlyZWN0aW9uYWxMaWdodCA9IG5ldyBUSFJFRS5EaXJlY3Rpb25hbExpZ2h0KCAweGZmZmZmZiwgMSApO1xuXHQgICAgZGlyZWN0aW9uYWxMaWdodC5wb3NpdGlvbi5zZXQoIC0yLCAxLjIsIC0xMCApLm5vcm1hbGl6ZSgpO1xuXHQgICAgYXBwLnNjZW5lLmFkZCggZGlyZWN0aW9uYWxMaWdodCApOyAgXG4gICAgICAgICAgICByZXNvbHZlKCBhcHAgKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gU3dhcm1cbiAgICAvLyAtLS0tLVxuICAgIGZ1bmN0aW9uIG1ha2VTd2FybSAoIGFwcCApIHtcbiAgICAgICAgcmV0dXJuIFcucHJvbWlzZSggZnVuY3Rpb24gKCByZXNvbHZlLCByZWplY3QgKSB7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHZhciBwYXJ0aWNsZXMgPSBbXTtcblxuICAgICAgICAgICAgLy8gQWRkIHRvIFNjZW5lXG4gICAgICAgICAgICAvLyAtLS0tLS0tLS0tLS1cbiAgICAgICAgICAgIGFwcC5zd2FybU9iamVjdDNEID0gbmV3IFRIUkVFLk9iamVjdDNEKCk7XG4gICAgICAgICAgICBhcHAuc2NlbmUuYWRkKCBhcHAuc3dhcm1PYmplY3QzRCApO1xuICAgICAgICAgICAgYXBwLnByZUN1YmVDYW1SZW5kZXJGbnMucHVzaCggZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGFwcC5zd2FybU9iamVjdDNELnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgYXBwLnBvc3RDdWJlQ2FtUmVuZGVyRm5zLnB1c2goIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBhcHAuc3dhcm1PYmplY3QzRC52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBMb2FkZXJcbiAgICAgICAgICAgIC8vIC0tLS0tLVxuICAgICAgICAgICAgdmFyIGxvYWRlciA9IG5ldyBUSFJFRS5PQkpMb2FkZXIoKTtcbiAgICAgICAgICAgIGxvYWRlci5sb2FkKCAnL29iai9waWxsb3ctYm94Lm9iaicsIG9uT2JqTG9hZGVkICk7XG5cbiAgICAgICAgICAgIC8vIFN3YXJtIENyZWF0aW9uXG4gICAgICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgICAgICBmdW5jdGlvbiBvbk9iakxvYWRlZCAoIG9iaiApIHtcblxuICAgICAgICAgICAgICAgIHZhciBtZXNoID0gb2JqLmNoaWxkcmVuWyAwIF07XG5cbiAgICAgICAgICAgICAgICAvLyBQYXJ0aWNsZSBDcmVhdGlvblxuICAgICAgICAgICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgICAgICAgICAgLy8gRWFzZSBpbiB0aGUgY3JlYXRpb24gb2YgdGhlIHBhcnRpY2xlc1xuICAgICAgICAgICAgICAgIHZhciBtYXhQYXJ0aWNsZXMgPSAxMDA7XG4gICAgICAgICAgICAgICAgdmFyIG1pbkNyZWF0aW9uVGltZSA9IDU7XG4gICAgICAgICAgICAgICAgdmFyIG1heENyZWF0aW9uVGltZU1TID0gMTAwO1xuXG4gICAgICAgICAgICAgICAgdmFyIG1hdGVyaWFsID0gXG4gICAgICAgICAgICAgICAgKGZ1bmN0aW9uIGNyZWF0ZU1vcmUgKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIHBhcnRpY2xlcy5sZW5ndGggPCBtYXhQYXJ0aWNsZXMgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGFydGljbGUgPSBuZXcgUGFydGljbGUoIG1lc2ggKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwcC5zd2FybU9iamVjdDNELmFkZCggcGFydGljbGUuYW5jaG9yICk7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJ0aWNsZXMucHVzaCggcGFydGljbGUgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoIGNyZWF0ZU1vcmUsIFcubWFwKCBwYXJ0aWNsZXMubGVuZ3RoIC8gbWF4UGFydGljbGVzLCAwLCAxLCBtYXhDcmVhdGlvblRpbWVNUywgbWluQ3JlYXRpb25UaW1lLCBXLmludGVycG9sYXRpb25zLmVhc2VJbiApICk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KCkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBVcGRhdGluZ1xuICAgICAgICAgICAgYWRkUHJlUmVuZGVyRm4oIGFwcCwgZnVuY3Rpb24gKCBkZWx0YU1TLCB0aW1lc3RhbXBNUyApIHtcbiAgICAgICAgICAgICAgICBwYXJ0aWNsZXMuZm9yRWFjaCggcGFydGljbGUgPT4gcGFydGljbGUudXBkYXRlKCBkZWx0YU1TLCB0aW1lc3RhbXBNUyApICk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gUGFydGljbGUgQ2xhc3NcbiAgICAgICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tXG4gICAgICAgICAgICBmdW5jdGlvbiBQYXJ0aWNsZSAoIG1lc2ggKSB7XG5cbiAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5ID0gVy5yYW5kb21CZXR3ZWVuKCAwLjIsIDEgKTtcblxuICAgICAgICAgICAgICAgIC8vIE1lc2hcbiAgICAgICAgICAgICAgICB0aGlzLm1lc2ggPSBtZXNoLmNsb25lKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5tZXNoLm1hdGVyaWFsID0gUGFydGljbGUubWF0ZXJpYWwuY2xvbmUoKTtcbiAgICAgICAgICAgICAgICB0aGlzLm1lc2guc2NhbGUueCA9IFBhcnRpY2xlLmluaXRpYWxTY2FsZTtcbiAgICAgICAgICAgICAgICB0aGlzLm1lc2guc2NhbGUueSA9IFBhcnRpY2xlLmluaXRpYWxTY2FsZTtcbiAgICAgICAgICAgICAgICB0aGlzLm1lc2guc2NhbGUueiA9IFBhcnRpY2xlLmluaXRpYWxTY2FsZTtcblxuICAgICAgICAgICAgICAgIC8vIFBvc2l0aW9uXG4gICAgICAgICAgICAgICAgdmFyIHJhbmdlID0gMTAwO1xuICAgICAgICAgICAgICAgIHRoaXMubWVzaC5wb3NpdGlvbi5zZXQoICggTWF0aC5yYW5kb20oKSAtIDAuNSApICogcmFuZ2UsICggTWF0aC5yYW5kb20oKSAtIDAuNSApICogcmFuZ2UsICggTWF0aC5yYW5kb20oKSAtIDAuNSApICogcmFuZ2UgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgdGhpcy5hbmNob3IgPSBuZXcgVEhSRUUuT2JqZWN0M0QoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmFuY2hvci5hZGQoIHRoaXMubWVzaCApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyAjIyMgU3RhdGljXG4gICAgICAgICAgICBQYXJ0aWNsZS5tYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoUGhvbmdNYXRlcmlhbCgge1xuXHRcdGNvbG9yOiAweGZmZmZmZixcblx0XHRzaGluaW5lc3M6IDAuMCxcblx0XHRzcGVjdWxhcjogMHhmZmZmZmYsXG5cdFx0ZW52TWFwOiBhcHAuY3ViZUNhbWVyYS5yZW5kZXJUYXJnZXQsXG4gICAgICAgICAgICAgICAgcmVmbGVjdGl2aXR5OiAxLjAsXG4gICAgICAgICAgICAgICAgc2lkZTogVEhSRUUuRG91YmxlU2lkZVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIFBhcnRpY2xlLmluaXRpYWxTY2FsZSA9IDIwMDtcblxuICAgICAgICAgICAgLy8gIyMjIE1ldGhvZFxuICAgICAgICAgICAgUGFydGljbGUucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uICggZGVsdGFNUywgdGltZXN0YW1wTVMgKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hbmNob3Iucm90YXRpb24ueCArPSAwLjAwMjtcbiAgICAgICAgICAgICAgICB0aGlzLmFuY2hvci5yb3RhdGlvbi55ICs9IHRoaXMudmVsb2NpdHkgLyAxMDtcbiAgICAgICAgICAgICAgICB0aGlzLmFuY2hvci5yb3RhdGlvbi56ICs9IDAuMDAxO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcmVzb2x2ZSggYXBwICk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFJlbmRlciBMb29wXG4gICAgLy8gLS0tLS0tLS0tLS1cbiAgICBmdW5jdGlvbiBtYWtlUmVuZGVyTG9vcCAoIGFwcCApIHtcbiAgICAgICAgcmV0dXJuIFcucHJvbWlzZSggZnVuY3Rpb24gKCByZXNvbHZlLCByZWplY3QgKSB7XG5cbiAgICAgICAgICAgIHZhciBsYXN0VGltZXN0YW1wTVMgPSAwO1xuICAgICAgICAgICAgdmFyIGRlbHRhTVMgPSAwO1xuXG4gICAgICAgICAgICAoZnVuY3Rpb24gIGxvb3AgKCBjdXJyZW50VGltZXN0YW1wTVMgKSB7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8gUmVjdXJcbiAgICAgICAgICAgICAgICAvLyAtLS0tLVxuICAgICAgICAgICAgICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoIGxvb3AgKTtcblxuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSB0aW1lc3RhbXBzXG4gICAgICAgICAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgICAgICAgICAgZGVsdGFNUyA9IGN1cnJlbnRUaW1lc3RhbXBNUyAtIGxhc3RUaW1lc3RhbXBNUztcbiAgICAgICAgICAgICAgICBsYXN0VGltZXN0YW1wTVMgPSBjdXJyZW50VGltZXN0YW1wTVM7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8gQWN0aW9uYWJsZXNcbiAgICAgICAgICAgICAgICAvLyAtLS0tLS0tLS0tLVxuICAgICAgICAgICAgICAgIGFwcC5wcmVSZW5kZXJGbnMuZm9yRWFjaCggZm4gPT4gZm4oIGRlbHRhTVMsIGN1cnJlbnRUaW1lc3RhbXBNUyApICk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8gUmVuZGVyXG4gICAgICAgICAgICAgICAgLy8gLS0tLS0tXG4gICAgICAgICAgICAgICAgYXBwLnJlbmRlcmVyLmNsZWFyKCk7XG5cdFx0YXBwLnJlbmRlcmVyLnJlbmRlciggYXBwLnNjZW5lLCBhcHAuY2FtZXJhICk7XG5cbiAgICAgICAgICAgIH0oIGxhc3RUaW1lc3RhbXBNUyApKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcmVzb2x2ZSggYXBwICk7XG4gICAgICAgIH0pO1xuXG4gICAgfVxuXG4gICAgLy8gVXRpbHNcbiAgICAvLyA9PT09PVxuXG4gICAgLy8gUmVuZGVyIExvb3BcbiAgICAvLyAtLS0tLS0tLS0tLVxuICAgIGZ1bmN0aW9uIGFkZFByZVJlbmRlckZuICggYXBwLCBmbiApIHtcbiAgICAgICAgYXBwLnByZVJlbmRlckZucy5wdXNoKCBmbiApO1xuICAgIH1cblxuICAgIC8vIENhbWVyYVxuICAgIC8vIC0tLS0tLVxuICAgIGZ1bmN0aW9uIHNldENhbWVyYVBvc2l0aW9uICggYXBwLCB4LCB5LCB6ICkge1xuICAgICAgICBhcHAuY2FtZXJhLnBvc2l0aW9uLnggPSB4O1xuICAgICAgICBhcHAuY2FtZXJhLnBvc2l0aW9uLnkgPSB5O1xuICAgICAgICBhcHAuY2FtZXJhLnBvc2l0aW9uLnogPSB6O1xuICAgIH1cbiBcbiAgICAvLyBFeHBvcnRcbiAgICAvLyA9PT09PT0gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgICAgbWFrZUFwcDogbWFrZUFwcCxcbiAgICAgICAgaW5pdEFwcDogaW5pdEFwcCAgXG4gICAgfTtcbiAgICBcbn0oKSk7XG5cblxuXG5cblxuXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=