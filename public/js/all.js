"use strict";var PunterViz=function(){function e(){return{containerEl:document.createElement("div"),backroundColor:6382180,preRenderFns:[],preCubeCamRenderFns:[],postCubeCamRenderFns:[]}}function n(e){return W.promise(function(n,r){e.camera=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,1,3e3),u(e,0,0,200),e.scene=new THREE.Scene,e.renderer=new THREE.WebGLRenderer({antialias:!1}),e.renderer.setPixelRatio(window.devicePixelRatio),e.renderer.setSize(window.innerWidth,window.innerHeight),e.renderer.setClearColor(e.backgroundColor),e.renderer.sortObjects=!1,e.containerEl.appendChild(e.renderer.domElement),n(e)})}function r(e){return W.promise(function(n,r){var t=document.createElement("video");t.autoplay=!0,navigator.webkitGetUserMedia({video:!0},function(e){t.src=URL.createObjectURL(e)},function(e){console.log("Failed to get a stream due to",e)}),e.webCamTexture=new THREE.Texture(t),e.webCamTexture.minFilter=THREE.LinearFilter,s(e,function(n,r){t.readyState===t.HAVE_ENOUGH_DATA&&(e.webCamTexture.needsUpdate=!0)}),n(e)})}function t(e){return W.promise(function(n,r){e.cubeCamera=new THREE.CubeCamera(1,3e3,256),e.cubeCamera.renderTarget.minFilter=THREE.LinearMipMapLinearFilter,s(e,function(n,r){e.preCubeCamRenderFns.forEach(function(e){return e(n,r)}),e.cubeCamera.updateCubeMap(e.renderer,e.scene),e.postCubeCamRenderFns.forEach(function(e){return e(n,r)})}),n(e)})}function i(e){return W.promise(function(n,r){var t=new THREE.MeshBasicMaterial({map:e.webCamTexture,color:16777215,side:THREE.BackSide});e.webCamvBoxMesh=new THREE.Mesh(new THREE.BoxGeometry(2e3,2e3,2e3),t);var i=W.randomBetween(2e-4,2e-5),a=W.randomBetween(2e-4,2e-5),o=W.randomBetween(2e-4,2e-5);s(e,function(n,r){e.webCamvBoxMesh.rotation.x+=n*i,e.webCamvBoxMesh.rotation.y+=n*a,e.webCamvBoxMesh.rotation.z+=n*o}),e.scene.add(e.webCamvBoxMesh),e.preCubeCamRenderFns.push(function(){e.webCamvBoxMesh.visible=!0}),e.postCubeCamRenderFns.push(function(){e.webCamvBoxMesh.visible=!1}),n(e)})}function a(e){return W.promise(function(n,r){e.scene.add(new THREE.AmbientLight(2236962));var t=new THREE.DirectionalLight(16777215,2);t.position.set(2,1.2,10).normalize(),e.scene.add(t),t=new THREE.DirectionalLight(16777215,1),t.position.set(-2,1.2,-10).normalize(),e.scene.add(t),n(e)})}function o(e){return W.promise(function(n,r){function t(n){{var r=n.children[0],t=100,o=5,c=100;!function s(){if(a.length<t){var n=new i(r);e.swarmObject3D.add(n.anchor),a.push(n),setTimeout(s,W.map(a.length/t,0,1,c,o,W.interpolations.easeIn))}}()}}function i(e){this.velocity=W.randomBetween(.2,1),this.mesh=e.clone(),this.mesh.material=i.material.clone(),this.mesh.scale.x=i.initialScale,this.mesh.scale.y=i.initialScale,this.mesh.scale.z=i.initialScale;var n=100;this.mesh.position.set((Math.random()-.5)*n,(Math.random()-.5)*n,(Math.random()-.5)*n),this.anchor=new THREE.Object3D,this.anchor.add(this.mesh)}var a=[];e.swarmObject3D=new THREE.Object3D,e.scene.add(e.swarmObject3D),e.preCubeCamRenderFns.push(function(){e.swarmObject3D.visible=!1}),e.postCubeCamRenderFns.push(function(){e.swarmObject3D.visible=!0});var o=new THREE.OBJLoader;o.load("/obj/pillow-box.obj",t),s(e,function(e,n){a.forEach(function(r){return r.update(e,n)})}),i.material=new THREE.MeshPhongMaterial({color:16777215,shininess:0,specular:16777215,envMap:e.cubeCamera.renderTarget,reflectivity:1,side:THREE.DoubleSide}),i.initialScale=200,i.prototype.update=function(e,n){this.anchor.rotation.x+=.002,this.anchor.rotation.y+=this.velocity/10,this.anchor.rotation.z+=.001},n(e)})}function c(e){return W.promise(function(n,r){var t=0,i=0;!function a(n){window.requestAnimationFrame(a),i=n-t,t=n,e.preRenderFns.forEach(function(e){return e(i,n)}),e.renderer.clear(),e.renderer.render(e.scene,e.camera)}(t),n(e)})}function s(e,n){e.preRenderFns.push(n)}function u(e,n,r,t){e.camera.position.x=n,e.camera.position.y=r,e.camera.position.z=t}var d=W.composePromisers(n,r,t,i,o,a,c);return{makeApp:e,initApp:d}}();$(function(){$("[data-punter-viz]").toArray().map(function(e){var n=PunterViz.makeApp();n.containerEl=e,PunterViz.initApp(n).error(function(e){console.error("Failed to create Punter app",e)}).success(function(e){console.log("Punter application made")})})});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFsbC5qcyIsInB1bnRlci12aXouanMiLCJtYWluLmpzIl0sIm5hbWVzIjpbIlB1bnRlclZpeiIsIm1ha2VBcHAiLCJjb250YWluZXJFbCIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImJhY2tyb3VuZENvbG9yIiwicHJlUmVuZGVyRm5zIiwicHJlQ3ViZUNhbVJlbmRlckZucyIsInBvc3RDdWJlQ2FtUmVuZGVyRm5zIiwibWFrZUNhbWVyYVNjZW5lUmVuZGVyZXIiLCJhcHAiLCJXIiwicHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJjYW1lcmEiLCJUSFJFRSIsIlBlcnNwZWN0aXZlQ2FtZXJhIiwid2luZG93IiwiaW5uZXJXaWR0aCIsImlubmVySGVpZ2h0Iiwic2V0Q2FtZXJhUG9zaXRpb24iLCJzY2VuZSIsIlNjZW5lIiwicmVuZGVyZXIiLCJXZWJHTFJlbmRlcmVyIiwiYW50aWFsaWFzIiwic2V0UGl4ZWxSYXRpbyIsImRldmljZVBpeGVsUmF0aW8iLCJzZXRTaXplIiwic2V0Q2xlYXJDb2xvciIsImJhY2tncm91bmRDb2xvciIsInNvcnRPYmplY3RzIiwiYXBwZW5kQ2hpbGQiLCJkb21FbGVtZW50IiwibWFrZVdlYkNhbVRleHR1cmUiLCJ3ZWJDYW1FbCIsImF1dG9wbGF5IiwibmF2aWdhdG9yIiwid2Via2l0R2V0VXNlck1lZGlhIiwidmlkZW8iLCJzdHJlYW0iLCJzcmMiLCJVUkwiLCJjcmVhdGVPYmplY3RVUkwiLCJlcnIiLCJjb25zb2xlIiwibG9nIiwid2ViQ2FtVGV4dHVyZSIsIlRleHR1cmUiLCJtaW5GaWx0ZXIiLCJMaW5lYXJGaWx0ZXIiLCJhZGRQcmVSZW5kZXJGbiIsImRldGxhTVMiLCJ0aW1lc3RhbXBNUyIsInJlYWR5U3RhdGUiLCJIQVZFX0VOT1VHSF9EQVRBIiwibmVlZHNVcGRhdGUiLCJtYWtlQ3ViZUNhbSIsImN1YmVDYW1lcmEiLCJDdWJlQ2FtZXJhIiwicmVuZGVyVGFyZ2V0IiwiTGluZWFyTWlwTWFwTGluZWFyRmlsdGVyIiwiZGVsdGFNUyIsImZvckVhY2giLCJmbiIsInVwZGF0ZUN1YmVNYXAiLCJtYWtlV2ViQ2FtQm94TWVzaCIsIndlYkNhbUJveE1hdGVyaWFsIiwiTWVzaEJhc2ljTWF0ZXJpYWwiLCJtYXAiLCJjb2xvciIsInNpZGUiLCJCYWNrU2lkZSIsIndlYkNhbXZCb3hNZXNoIiwiTWVzaCIsIkJveEdlb21ldHJ5Iiwicm90YXRpb25YIiwicmFuZG9tQmV0d2VlbiIsInJvdGF0aW9uWSIsInJvdGF0aW9uWiIsInJvdGF0aW9uIiwieCIsInkiLCJ6IiwiYWRkIiwicHVzaCIsInZpc2libGUiLCJtYWtlTGlnaHRzIiwiQW1iaWVudExpZ2h0IiwiZGlyZWN0aW9uYWxMaWdodCIsIkRpcmVjdGlvbmFsTGlnaHQiLCJwb3NpdGlvbiIsInNldCIsIm5vcm1hbGl6ZSIsIm1ha2VTd2FybSIsIm9uT2JqTG9hZGVkIiwib2JqIiwibWVzaCIsImNoaWxkcmVuIiwibWF4UGFydGljbGVzIiwibWluQ3JlYXRpb25UaW1lIiwibWF4Q3JlYXRpb25UaW1lTVMiLCJjcmVhdGVNb3JlIiwicGFydGljbGVzIiwibGVuZ3RoIiwicGFydGljbGUiLCJQYXJ0aWNsZSIsInN3YXJtT2JqZWN0M0QiLCJhbmNob3IiLCJzZXRUaW1lb3V0IiwiaW50ZXJwb2xhdGlvbnMiLCJlYXNlSW4iLCJ0aGlzIiwidmVsb2NpdHkiLCJjbG9uZSIsIm1hdGVyaWFsIiwic2NhbGUiLCJpbml0aWFsU2NhbGUiLCJyYW5nZSIsIk1hdGgiLCJyYW5kb20iLCJPYmplY3QzRCIsImxvYWRlciIsIk9CSkxvYWRlciIsImxvYWQiLCJ1cGRhdGUiLCJNZXNoUGhvbmdNYXRlcmlhbCIsInNoaW5pbmVzcyIsInNwZWN1bGFyIiwiZW52TWFwIiwicmVmbGVjdGl2aXR5IiwiRG91YmxlU2lkZSIsInByb3RvdHlwZSIsIm1ha2VSZW5kZXJMb29wIiwibGFzdFRpbWVzdGFtcE1TIiwibG9vcCIsImN1cnJlbnRUaW1lc3RhbXBNUyIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsImNsZWFyIiwicmVuZGVyIiwiaW5pdEFwcCIsImNvbXBvc2VQcm9taXNlcnMiLCIkIiwidG9BcnJheSIsImVsIiwiZXJyb3IiLCJzdWNjZXNzIiwiaW5pdGFsaXNlZFB1bnRlckFwcCJdLCJtYXBwaW5ncyI6IkFBUUEsWUNBQSxJQUFJQSxXQUFhLFdBSWIsUUFBU0MsS0FDTCxPQUNJQyxZQUFhQyxTQUFTQyxjQUFlLE9BQ3JDQyxlQUFnQixRQUNoQkMsZ0JBQ0FDLHVCQUNBQyx5QkFpQlIsUUFBU0MsR0FBMEJDLEdBQy9CLE1BQU9DLEdBQUVDLFFBQVMsU0FBV0MsRUFBU0MsR0FJbENKLEVBQUlLLE9BQVMsR0FBSUMsT0FBTUMsa0JBQW1CLEdBQUlDLE9BQU9DLFdBQWFELE9BQU9FLFlBQWEsRUFBRyxLQUN6RkMsRUFBbUJYLEVBQUssRUFBRyxFQUFHLEtBSTlCQSxFQUFJWSxNQUFRLEdBQUlOLE9BQU1PLE1BSXRCYixFQUFJYyxTQUFXLEdBQUlSLE9BQU1TLGVBQWlCQyxXQUFXLElBQzVEaEIsRUFBSWMsU0FBU0csY0FBZVQsT0FBT1Usa0JBQ25DbEIsRUFBSWMsU0FBU0ssUUFBU1gsT0FBT0MsV0FBWUQsT0FBT0UsYUFDekNWLEVBQUljLFNBQVNNLGNBQWVwQixFQUFJcUIsaUJBQ3ZDckIsRUFBSWMsU0FBU1EsYUFBYyxFQUVwQnRCLEVBQUlSLFlBQVkrQixZQUFhdkIsRUFBSWMsU0FBU1UsWUFFMUNyQixFQUFTSCxLQU9qQixRQUFTeUIsR0FBb0J6QixHQUN6QixNQUFPQyxHQUFFQyxRQUFTLFNBQVdDLEVBQVNDLEdBSWxDLEdBQUlzQixHQUFXakMsU0FBU0MsY0FBYyxRQUN0Q2dDLEdBQVNDLFVBQVcsRUFJcEJDLFVBQVVDLG9CQUFzQkMsT0FBTSxHQUFRLFNBQVVDLEdBQ3BETCxFQUFTTSxJQUFNQyxJQUFJQyxnQkFBaUJILElBQ3JDLFNBQVVJLEdBQ1RDLFFBQVFDLElBQUksZ0NBQWlDRixLQUtqRG5DLEVBQUlzQyxjQUFnQixHQUFJaEMsT0FBTWlDLFFBQVNiLEdBQ3ZDMUIsRUFBSXNDLGNBQWNFLFVBQVlsQyxNQUFNbUMsYUFJcENDLEVBQWdCMUMsRUFBSyxTQUFXMkMsRUFBU0MsR0FDakNsQixFQUFTbUIsYUFBZW5CLEVBQVNvQixtQkFDakM5QyxFQUFJc0MsY0FBY1MsYUFBYyxLQUl4QzVDLEVBQVNILEtBVWpCLFFBQVNnRCxHQUFjaEQsR0FDbkIsTUFBT0MsR0FBRUMsUUFBUyxTQUFXQyxFQUFTQyxHQUVsQ0osRUFBSWlELFdBQWEsR0FBSTNDLE9BQU00QyxXQUFXLEVBQUcsSUFBTSxLQUMvQ2xELEVBQUlpRCxXQUFXRSxhQUFhWCxVQUFZbEMsTUFBTThDLHlCQUU5Q1YsRUFBZ0IxQyxFQUFLLFNBQVdxRCxFQUFTVCxHQUdyQzVDLEVBQUlILG9CQUFvQnlELFFBQVMsU0FBQUMsR0RIN0IsTUNHbUNBLEdBQUlGLEVBQVNULEtBQ3BENUMsRUFBSWlELFdBQVdPLGNBQWV4RCxFQUFJYyxTQUFVZCxFQUFJWSxPQUNoRFosRUFBSUYscUJBQXFCd0QsUUFBUyxTQUFBQyxHREQ5QixNQ0NvQ0EsR0FBSUYsRUFBU1QsT0FHekR6QyxFQUFTSCxLQVFqQixRQUFTeUQsR0FBb0J6RCxHQUN6QixNQUFPQyxHQUFFQyxRQUFTLFNBQVdDLEVBQVNDLEdBRWxDLEdBQUlzRCxHQUFvQixHQUFJcEQsT0FBTXFELG1CQUM5QkMsSUFBSzVELEVBQUlzQyxjQUNUdUIsTUFBTyxTQUNkQyxLQUFNeEQsTUFBTXlELFVBR1QvRCxHQUFJZ0UsZUFBaUIsR0FBSTFELE9BQU0yRCxLQUFNLEdBQUkzRCxPQUFNNEQsWUFBYSxJQUFNLElBQU0sS0FBUVIsRUFFaEYsSUFBSVMsR0FBWWxFLEVBQUVtRSxjQUFlLEtBQVEsTUFDckNDLEVBQVlwRSxFQUFFbUUsY0FBZSxLQUFRLE1BQ3JDRSxFQUFZckUsRUFBRW1FLGNBQWUsS0FBUSxLQUd6QzFCLEdBQWdCMUMsRUFBSyxTQUFXcUQsRUFBU1QsR0FDckM1QyxFQUFJZ0UsZUFBZU8sU0FBU0MsR0FBT25CLEVBQVVjLEVBQzdDbkUsRUFBSWdFLGVBQWVPLFNBQVNFLEdBQU9wQixFQUFVZ0IsRUFDN0NyRSxFQUFJZ0UsZUFBZU8sU0FBU0csR0FBT3JCLEVBQVVpQixJQUd4RHRFLEVBQUlZLE1BQU0rRCxJQUFLM0UsRUFBSWdFLGdCQUdaaEUsRUFBSUgsb0JBQW9CK0UsS0FBTSxXQUMxQjVFLEVBQUlnRSxlQUFlYSxTQUFVLElBR2pDN0UsRUFBSUYscUJBQXFCOEUsS0FBTSxXQUMzQjVFLEVBQUlnRSxlQUFlYSxTQUFVLElBS2pDMUUsRUFBU0gsS0FNakIsUUFBUzhFLEdBQWE5RSxHQUNsQixNQUFPQyxHQUFFQyxRQUFTLFNBQVdDLEVBQVNDLEdBQ2xDSixFQUFJWSxNQUFNK0QsSUFBSyxHQUFJckUsT0FBTXlFLGFBQWMsU0FFdkMsSUFBSUMsR0FBbUIsR0FBSTFFLE9BQU0yRSxpQkFBa0IsU0FBVSxFQUNwRUQsR0FBaUJFLFNBQVNDLElBQUssRUFBRyxJQUFLLElBQUtDLFlBQzVDcEYsRUFBSVksTUFBTStELElBQUtLLEdBRWZBLEVBQW1CLEdBQUkxRSxPQUFNMkUsaUJBQWtCLFNBQVUsR0FDekRELEVBQWlCRSxTQUFTQyxJQUFLLEdBQUksSUFBSyxLQUFNQyxZQUM5Q3BGLEVBQUlZLE1BQU0rRCxJQUFLSyxHQUNSN0UsRUFBU0gsS0FNakIsUUFBU3FGLEdBQVlyRixHQUNqQixNQUFPQyxHQUFFQyxRQUFTLFNBQVdDLEVBQVNDLEdBc0JsQyxRQUFTa0YsR0FBY0MsR0FFbkIsQ0FBQSxHQUFJQyxHQUFPRCxFQUFJRSxTQUFVLEdBS3JCQyxFQUFlLElBQ2ZDLEVBQWtCLEVBQ2xCQyxFQUFvQixLQUd2QixRQUFTQyxLQUNOLEdBQUtDLEVBQVVDLE9BQVNMLEVBQWUsQ0FDbkMsR0FBSU0sR0FBVyxHQUFJQyxHQUFVVCxFQUM3QnhGLEdBQUlrRyxjQUFjdkIsSUFBS3FCLEVBQVNHLFFBQ2hDTCxFQUFVbEIsS0FBTW9CLEdBQ2hCSSxXQUFZUCxFQUFZNUYsRUFBRTJELElBQUtrQyxFQUFVQyxPQUFTTCxFQUFjLEVBQUcsRUFBR0UsRUFBbUJELEVBQWlCMUYsRUFBRW9HLGVBQWVDLGNBWXZJLFFBQVNMLEdBQVdULEdBRWhCZSxLQUFLQyxTQUFXdkcsRUFBRW1FLGNBQWUsR0FBSyxHQUd0Q21DLEtBQUtmLEtBQU9BLEVBQUtpQixRQUNqQkYsS0FBS2YsS0FBS2tCLFNBQVdULEVBQVNTLFNBQVNELFFBQ3ZDRixLQUFLZixLQUFLbUIsTUFBTW5DLEVBQUl5QixFQUFTVyxhQUM3QkwsS0FBS2YsS0FBS21CLE1BQU1sQyxFQUFJd0IsRUFBU1csYUFDN0JMLEtBQUtmLEtBQUttQixNQUFNakMsRUFBSXVCLEVBQVNXLFlBRzdCLElBQUlDLEdBQVEsR0FDWk4sTUFBS2YsS0FBS04sU0FBU0MsS0FBTzJCLEtBQUtDLFNBQVcsSUFBUUYsR0FBU0MsS0FBS0MsU0FBVyxJQUFRRixHQUFTQyxLQUFLQyxTQUFXLElBQVFGLEdBRXBITixLQUFLSixPQUFTLEdBQUk3RixPQUFNMEcsU0FDeEJULEtBQUtKLE9BQU94QixJQUFLNEIsS0FBS2YsTUFqRTFCLEdBQUlNLEtBSUo5RixHQUFJa0csY0FBZ0IsR0FBSTVGLE9BQU0wRyxTQUM5QmhILEVBQUlZLE1BQU0rRCxJQUFLM0UsRUFBSWtHLGVBQ25CbEcsRUFBSUgsb0JBQW9CK0UsS0FBTSxXQUMxQjVFLEVBQUlrRyxjQUFjckIsU0FBVSxJQUVoQzdFLEVBQUlGLHFCQUFxQjhFLEtBQU0sV0FDM0I1RSxFQUFJa0csY0FBY3JCLFNBQVUsR0FLaEMsSUFBSW9DLEdBQVMsR0FBSTNHLE9BQU00RyxTQUN2QkQsR0FBT0UsS0FBTSxzQkFBdUI3QixHQTJCcEM1QyxFQUFnQjFDLEVBQUssU0FBV3FELEVBQVNULEdBQ3JDa0QsRUFBVXhDLFFBQVMsU0FBQTBDLEdERmYsTUNFMkJBLEdBQVNvQixPQUFRL0QsRUFBU1QsT0F5QjdEcUQsRUFBU1MsU0FBVyxHQUFJcEcsT0FBTStHLG1CQUN4Q3hELE1BQU8sU0FDUHlELFVBQVcsRUFDWEMsU0FBVSxTQUNWQyxPQUFReEgsRUFBSWlELFdBQVdFLGFBQ1RzRSxhQUFjLEVBQ2QzRCxLQUFNeEQsTUFBTW9ILGFBR2hCekIsRUFBU1csYUFBZSxJQUd4QlgsRUFBUzBCLFVBQVVQLE9BQVMsU0FBVy9ELEVBQVNULEdBQzVDMkQsS0FBS0osT0FBTzVCLFNBQVNDLEdBQUssS0FDMUIrQixLQUFLSixPQUFPNUIsU0FBU0UsR0FBSzhCLEtBQUtDLFNBQVcsR0FDMUNELEtBQUtKLE9BQU81QixTQUFTRyxHQUFLLE1BRzlCdkUsRUFBU0gsS0FNakIsUUFBUzRILEdBQWlCNUgsR0FDdEIsTUFBT0MsR0FBRUMsUUFBUyxTQUFXQyxFQUFTQyxHQUVsQyxHQUFJeUgsR0FBa0IsRUFDbEJ4RSxFQUFVLEdBRWIsUUFBVXlFLEdBQU9DLEdBSWR2SCxPQUFPd0gsc0JBQXVCRixHQUk5QnpFLEVBQVUwRSxFQUFxQkYsRUFDL0JBLEVBQWtCRSxFQUlsQi9ILEVBQUlKLGFBQWEwRCxRQUFTLFNBQUFDLEdEQXRCLE1DQTRCQSxHQUFJRixFQUFTMEUsS0FJN0MvSCxFQUFJYyxTQUFTbUgsUUFDM0JqSSxFQUFJYyxTQUFTb0gsT0FBUWxJLEVBQUlZLE1BQU9aLEVBQUlLLFNBRXZCd0gsR0FFSDFILEVBQVNILEtBVWpCLFFBQVMwQyxHQUFpQjFDLEVBQUt1RCxHQUMzQnZELEVBQUlKLGFBQWFnRixLQUFNckIsR0FLM0IsUUFBUzVDLEdBQW9CWCxFQUFLd0UsRUFBR0MsRUFBR0MsR0FDcEMxRSxFQUFJSyxPQUFPNkUsU0FBU1YsRUFBSUEsRUFDeEJ4RSxFQUFJSyxPQUFPNkUsU0FBU1QsRUFBSUEsRUFDeEJ6RSxFQUFJSyxPQUFPNkUsU0FBU1IsRUFBSUEsRUFoVDVCLEdBQUl5RCxHQUFVbEksRUFBRW1JLGlCQUFrQnJJLEVBQ0EwQixFQUNBdUIsRUFDQVMsRUFDQTRCLEVBQ0FQLEVBQ0E4QyxFQStTbEMsUUFDSXJJLFFBQVNBLEVBQ1Q0SSxRQUFTQSxLQ3ZVakJFLEdBQUcsV0FJQ0EsRUFBRyxxQkFDRUMsVUFDQTFFLElBQUssU0FBVzJFLEdBR2IsR0FBSXZJLEdBQU1WLFVBQVVDLFNBRXBCUyxHQUFJUixZQUFjK0ksRUFHbEJqSixVQUNLNkksUUFBU25JLEdBQ1R3SSxNQUFPLFNBQVdyRyxHQUNmQyxRQUFRb0csTUFBTyw4QkFBK0JyRyxLQUVqRHNHLFFBQVMsU0FBV0MsR0FDakJ0RyxRQUFRQyxJQUFLIiwiZmlsZSI6ImFsbC5qcyIsInNvdXJjZXNDb250ZW50IjpbbnVsbCwiLyoganNoaW50IGVzbmV4dDogdHJ1ZSAqL1xuXG4vLyBQdW50ZXIgVml6XG4vLyA9PT09PT09PT09XG4vLyBBIHRocmVlLmpzIHZpc3VsaXNhdGlvbiB0byBiZVxuLy8gcnVuIG9uIGFuIEhUQyBwaG9uZSBhbmQgY2FycmllZCBieVxuLy8gcHVudGVycyBpbnRvIHRoZSBtaXJyb3IgYm94LlxuXG52YXIgUHVudGVyVml6ID0gKGZ1bmN0aW9uICgpIHtcblxuICAgIC8vIEluaXQgJiBtYWtlXG4gICAgLy8gPT09PT09PT09PT1cbiAgICBmdW5jdGlvbiBtYWtlQXBwICgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGNvbnRhaW5lckVsOiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnZGl2JyApLFxuICAgICAgICAgICAgYmFja3JvdW5kQ29sb3I6IDB4NjE2MjY0LFxuICAgICAgICAgICAgcHJlUmVuZGVyRm5zOiBbXSxcbiAgICAgICAgICAgIHByZUN1YmVDYW1SZW5kZXJGbnM6IFtdLFxuICAgICAgICAgICAgcG9zdEN1YmVDYW1SZW5kZXJGbnM6IFtdXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgdmFyIGluaXRBcHAgPSBXLmNvbXBvc2VQcm9taXNlcnMoIG1ha2VDYW1lcmFTY2VuZVJlbmRlcmVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYWtlV2ViQ2FtVGV4dHVyZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFrZUN1YmVDYW0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ha2VXZWJDYW1Cb3hNZXNoLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYWtlU3dhcm0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ha2VMaWdodHMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ha2VSZW5kZXJMb29wICk7XG5cbiAgICAvLyBQcm9taXNlcnNcbiAgICAvLyA9PT09PT09PT1cblxuICAgIC8vIENhbWVyYSwgU2NlbmUsIFJlbmRlcmVyXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBmdW5jdGlvbiBtYWtlQ2FtZXJhU2NlbmVSZW5kZXJlciAoIGFwcCApIHtcbiAgICAgICAgcmV0dXJuIFcucHJvbWlzZSggZnVuY3Rpb24gKCByZXNvbHZlLCByZWplY3QgKSB7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIENhbWVyYVxuICAgICAgICAgICAgLy8gLS0tLS0tXG4gICAgICAgICAgICBhcHAuY2FtZXJhID0gbmV3IFRIUkVFLlBlcnNwZWN0aXZlQ2FtZXJhKCA3MCwgd2luZG93LmlubmVyV2lkdGggLyB3aW5kb3cuaW5uZXJIZWlnaHQsIDEsIDMwMDAgKTtcbiAgICAgICAgICAgIHNldENhbWVyYVBvc2l0aW9uKCBhcHAsIDAsIDAsIDIwMCApO1xuXG4gICAgICAgICAgICAvLyBTY2VuZVxuICAgICAgICAgICAgLy8gLS0tLS1cbiAgICAgICAgICAgIGFwcC5zY2VuZSA9IG5ldyBUSFJFRS5TY2VuZSgpO1xuXG4gICAgICAgICAgICAvLyBSZW5kZXJlclxuICAgICAgICAgICAgLy8gLS0tLS0tLS1cbiAgICAgICAgICAgIGFwcC5yZW5kZXJlciA9IG5ldyBUSFJFRS5XZWJHTFJlbmRlcmVyKCB7IGFudGlhbGlhczogZmFsc2UgfSApO1xuXHQgICAgYXBwLnJlbmRlcmVyLnNldFBpeGVsUmF0aW8oIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvICk7XG5cdCAgICBhcHAucmVuZGVyZXIuc2V0U2l6ZSggd2luZG93LmlubmVyV2lkdGgsIHdpbmRvdy5pbm5lckhlaWdodCApO1xuICAgICAgICAgICAgYXBwLnJlbmRlcmVyLnNldENsZWFyQ29sb3IoIGFwcC5iYWNrZ3JvdW5kQ29sb3IgKTtcblx0ICAgIGFwcC5yZW5kZXJlci5zb3J0T2JqZWN0cyA9IGZhbHNlO1xuXG4gICAgICAgICAgICBhcHAuY29udGFpbmVyRWwuYXBwZW5kQ2hpbGQoIGFwcC5yZW5kZXJlci5kb21FbGVtZW50ICk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHJlc29sdmUoIGFwcCApO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBXZWIgQ2FtXG4gICAgLy8gLS0tLS0tLVxuICAgIC8vIE1ha2UgdGhlIHdlYiBjYW0gYXZhaWxhYmxlIGFzIGEgdGV4dHVyZVxuICAgIGZ1bmN0aW9uIG1ha2VXZWJDYW1UZXh0dXJlICggYXBwICkge1xuICAgICAgICByZXR1cm4gVy5wcm9taXNlKCBmdW5jdGlvbiAoIHJlc29sdmUsIHJlamVjdCApIHtcblxuICAgICAgICAgICAgLy8gV2ViIENhbSBET00gRWxlbWVudFxuICAgICAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAgICAgdmFyIHdlYkNhbUVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndmlkZW8nKTtcbiAgICAgICAgICAgIHdlYkNhbUVsLmF1dG9wbGF5ID0gdHJ1ZTtcblxuICAgICAgICAgICAgLy8gV2ViIENhbSBTdHJlYW1cbiAgICAgICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tXG4gICAgICAgICAgICBuYXZpZ2F0b3Iud2Via2l0R2V0VXNlck1lZGlhKCB7IHZpZGVvOnRydWUgfSwgZnVuY3Rpb24oIHN0cmVhbSApe1xuICAgICAgICAgICAgICAgIHdlYkNhbUVsLnNyYyA9IFVSTC5jcmVhdGVPYmplY3RVUkwoIHN0cmVhbSApO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24oIGVyciApe1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRmFpbGVkIHRvIGdldCBhIHN0cmVhbSBkdWUgdG9cIiwgZXJyKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBXZWIgQ2FtIFRleHR1cmVcbiAgICAgICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAgICAgYXBwLndlYkNhbVRleHR1cmUgPSBuZXcgVEhSRUUuVGV4dHVyZSggd2ViQ2FtRWwgKTtcbiAgICAgICAgICAgIGFwcC53ZWJDYW1UZXh0dXJlLm1pbkZpbHRlciA9IFRIUkVFLkxpbmVhckZpbHRlcjtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gUmVuZGVyIFVwZGF0ZXNcbiAgICAgICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tXG4gICAgICAgICAgICBhZGRQcmVSZW5kZXJGbiggYXBwLCBmdW5jdGlvbiAoIGRldGxhTVMsIHRpbWVzdGFtcE1TICkge1xuICAgICAgICAgICAgICAgIGlmKCB3ZWJDYW1FbC5yZWFkeVN0YXRlID09PSB3ZWJDYW1FbC5IQVZFX0VOT1VHSF9EQVRBICl7XG4gICAgICAgICAgICAgICAgICAgIGFwcC53ZWJDYW1UZXh0dXJlLm5lZWRzVXBkYXRlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcmVzb2x2ZSggYXBwICk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIEN1YmUgQ2FtZXJhXG4gICAgLy8gLS0tLS0tLS0tLS1cbiAgICAvLyBDcmVhdGUgYSBjdWJlIGNhbSBmb3IgYSBkeW5hbWljIGVudk1hcC5cbiAgICAvLyBUaGlzIGFsc28gZW5hYmxlcyB0d28gaG9va3M6IGBwcmVDdWJlQ2FtUmVuZGVyQWN0aW9uc2AgJiBgcG9zdEN1YmVDYW1SZW5kZXJBY3Rpb25zYFxuICAgIC8vIGluIHRoZSBhcHAgZm9yIHRoYXQgb2JqZWN0M0QgaW4gdGhlIHNjZW5lIGNhbiBiZSB0dXJuZWQgb24gYW5kIG9mZiBkdXJpbmdcbiAgICAvLyB0aGUgd2ViY2FtcyByZW5kZXJcbiAgICBmdW5jdGlvbiBtYWtlQ3ViZUNhbSAoIGFwcCApIHsgXG4gICAgICAgIHJldHVybiBXLnByb21pc2UoIGZ1bmN0aW9uICggcmVzb2x2ZSwgcmVqZWN0ICkge1xuXG4gICAgICAgICAgICBhcHAuY3ViZUNhbWVyYSA9IG5ldyBUSFJFRS5DdWJlQ2FtZXJhKDEsIDMwMDAsIDI1Nik7IC8vIG5lYXIsIGZhciwgcmVzb2x1dGlvblxuICAgICAgICAgICAgYXBwLmN1YmVDYW1lcmEucmVuZGVyVGFyZ2V0Lm1pbkZpbHRlciA9IFRIUkVFLkxpbmVhck1pcE1hcExpbmVhckZpbHRlcjsgLy8gbWlwbWFwIGZpbHRlclxuICAgICAgICAgICAgXG4gICAgICAgICAgICBhZGRQcmVSZW5kZXJGbiggYXBwLCBmdW5jdGlvbiAoIGRlbHRhTVMsIHRpbWVzdGFtcE1TICkgeyAgICBcbiAgICAgICAgICAgICAgICAvLyBSZW5kZXIgdGhlIGN1YmUgY2FtZXJhIHRvIGN1YmUgbWFwXG4gICAgICAgICAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAgICAgICAgIGFwcC5wcmVDdWJlQ2FtUmVuZGVyRm5zLmZvckVhY2goIGZuID0+IGZuKCBkZWx0YU1TLCB0aW1lc3RhbXBNUyApICk7XG4gICAgICAgICAgICAgICAgYXBwLmN1YmVDYW1lcmEudXBkYXRlQ3ViZU1hcCggYXBwLnJlbmRlcmVyLCBhcHAuc2NlbmUgKTtcbiAgICAgICAgICAgICAgICBhcHAucG9zdEN1YmVDYW1SZW5kZXJGbnMuZm9yRWFjaCggZm4gPT4gZm4oIGRlbHRhTVMsIHRpbWVzdGFtcE1TICkgKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXNvbHZlKCBhcHAgKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gV2ViIENhbSBCb3ggTWVzaFxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBDcmVhdGVzIGEgYm94IHdpdGggdGhlIHdlYiBjYW0gZGlzcGxheWVkXG4gICAgLy8gb24gdGhlIGluc2lkZSBvZiBlYWNoIG9mIGl0J3MgNiBzaWRlc1xuICAgIGZ1bmN0aW9uIG1ha2VXZWJDYW1Cb3hNZXNoICggYXBwICkge1xuICAgICAgICByZXR1cm4gVy5wcm9taXNlKCBmdW5jdGlvbiAoIHJlc29sdmUsIHJlamVjdCApIHtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgdmFyIHdlYkNhbUJveE1hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHtcbiAgICAgICAgICAgICAgICBtYXA6IGFwcC53ZWJDYW1UZXh0dXJlLFxuICAgICAgICAgICAgICAgIGNvbG9yOiAweGZmZmZmZixcblx0ICAgICAgICBzaWRlOiBUSFJFRS5CYWNrU2lkZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGFwcC53ZWJDYW12Qm94TWVzaCA9IG5ldyBUSFJFRS5NZXNoKCBuZXcgVEhSRUUuQm94R2VvbWV0cnkoIDIwMDAsIDIwMDAsIDIwMDAgKSwgd2ViQ2FtQm94TWF0ZXJpYWwgKTtcblxuICAgICAgICAgICAgdmFyIHJvdGF0aW9uWCA9IFcucmFuZG9tQmV0d2VlbiggMC4wMDAyLCAwLjAwMDAyICk7XG4gICAgICAgICAgICB2YXIgcm90YXRpb25ZID0gVy5yYW5kb21CZXR3ZWVuKCAwLjAwMDIsIDAuMDAwMDIgKTtcbiAgICAgICAgICAgIHZhciByb3RhdGlvblogPSBXLnJhbmRvbUJldHdlZW4oIDAuMDAwMiwgMC4wMDAwMiApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBJZiB3ZSB3YW50IHRvIHJvdGF0ZSBpdFxuICAgICAgICAgICAgYWRkUHJlUmVuZGVyRm4oIGFwcCwgZnVuY3Rpb24gKCBkZWx0YU1TLCB0aW1lc3RhbXBNUyApIHtcbiAgICAgICAgICAgICAgICBhcHAud2ViQ2FtdkJveE1lc2gucm90YXRpb24ueCArPSAoIGRlbHRhTVMgKiByb3RhdGlvblggKTtcbiAgICAgICAgICAgICAgICBhcHAud2ViQ2FtdkJveE1lc2gucm90YXRpb24ueSArPSAoIGRlbHRhTVMgKiByb3RhdGlvblkgKTtcbiAgICAgICAgICAgICAgICBhcHAud2ViQ2FtdkJveE1lc2gucm90YXRpb24ueiArPSAoIGRlbHRhTVMgKiByb3RhdGlvblogKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG5cdCAgICBhcHAuc2NlbmUuYWRkKCBhcHAud2ViQ2FtdkJveE1lc2ggKTtcblxuICAgICAgICAgICAgLy8gU2hvdyBpdCBvbmx5IGZvciB0aGUgY3ViZSBjYW1cbiAgICAgICAgICAgIGFwcC5wcmVDdWJlQ2FtUmVuZGVyRm5zLnB1c2goIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBhcHAud2ViQ2FtdkJveE1lc2gudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgYXBwLnBvc3RDdWJlQ2FtUmVuZGVyRm5zLnB1c2goIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBhcHAud2ViQ2FtdkJveE1lc2gudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIFxuXG4gICAgICAgICAgICByZXNvbHZlKCBhcHAgKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gTGlnaHRzXG4gICAgLy8gLS0tLS0tXG4gICAgZnVuY3Rpb24gbWFrZUxpZ2h0cyAoIGFwcCApIHtcbiAgICAgICAgcmV0dXJuIFcucHJvbWlzZSggZnVuY3Rpb24gKCByZXNvbHZlLCByZWplY3QgKSB7XG4gICAgICAgICAgICBhcHAuc2NlbmUuYWRkKCBuZXcgVEhSRUUuQW1iaWVudExpZ2h0KCAweDIyMjIyMiApICk7XG5cbiAgICAgICAgICAgIHZhciBkaXJlY3Rpb25hbExpZ2h0ID0gbmV3IFRIUkVFLkRpcmVjdGlvbmFsTGlnaHQoIDB4ZmZmZmZmLCAyICk7XG5cdCAgICBkaXJlY3Rpb25hbExpZ2h0LnBvc2l0aW9uLnNldCggMiwgMS4yLCAxMCApLm5vcm1hbGl6ZSgpO1xuXHQgICAgYXBwLnNjZW5lLmFkZCggZGlyZWN0aW9uYWxMaWdodCApO1xuXG5cdCAgICBkaXJlY3Rpb25hbExpZ2h0ID0gbmV3IFRIUkVFLkRpcmVjdGlvbmFsTGlnaHQoIDB4ZmZmZmZmLCAxICk7XG5cdCAgICBkaXJlY3Rpb25hbExpZ2h0LnBvc2l0aW9uLnNldCggLTIsIDEuMiwgLTEwICkubm9ybWFsaXplKCk7XG5cdCAgICBhcHAuc2NlbmUuYWRkKCBkaXJlY3Rpb25hbExpZ2h0ICk7ICBcbiAgICAgICAgICAgIHJlc29sdmUoIGFwcCApO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBTd2FybVxuICAgIC8vIC0tLS0tXG4gICAgZnVuY3Rpb24gbWFrZVN3YXJtICggYXBwICkge1xuICAgICAgICByZXR1cm4gVy5wcm9taXNlKCBmdW5jdGlvbiAoIHJlc29sdmUsIHJlamVjdCApIHtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgdmFyIHBhcnRpY2xlcyA9IFtdO1xuXG4gICAgICAgICAgICAvLyBBZGQgdG8gU2NlbmVcbiAgICAgICAgICAgIC8vIC0tLS0tLS0tLS0tLVxuICAgICAgICAgICAgYXBwLnN3YXJtT2JqZWN0M0QgPSBuZXcgVEhSRUUuT2JqZWN0M0QoKTtcbiAgICAgICAgICAgIGFwcC5zY2VuZS5hZGQoIGFwcC5zd2FybU9iamVjdDNEICk7XG4gICAgICAgICAgICBhcHAucHJlQ3ViZUNhbVJlbmRlckZucy5wdXNoKCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgYXBwLnN3YXJtT2JqZWN0M0QudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBhcHAucG9zdEN1YmVDYW1SZW5kZXJGbnMucHVzaCggZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGFwcC5zd2FybU9iamVjdDNELnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIExvYWRlclxuICAgICAgICAgICAgLy8gLS0tLS0tXG4gICAgICAgICAgICB2YXIgbG9hZGVyID0gbmV3IFRIUkVFLk9CSkxvYWRlcigpO1xuICAgICAgICAgICAgbG9hZGVyLmxvYWQoICcvb2JqL3BpbGxvdy1ib3gub2JqJywgb25PYmpMb2FkZWQgKTtcblxuICAgICAgICAgICAgLy8gU3dhcm0gQ3JlYXRpb25cbiAgICAgICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgIGZ1bmN0aW9uIG9uT2JqTG9hZGVkICggb2JqICkge1xuXG4gICAgICAgICAgICAgICAgdmFyIG1lc2ggPSBvYmouY2hpbGRyZW5bIDAgXTtcblxuICAgICAgICAgICAgICAgIC8vIFBhcnRpY2xlIENyZWF0aW9uXG4gICAgICAgICAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgICAgICAvLyBFYXNlIGluIHRoZSBjcmVhdGlvbiBvZiB0aGUgcGFydGljbGVzXG4gICAgICAgICAgICAgICAgdmFyIG1heFBhcnRpY2xlcyA9IDEwMDtcbiAgICAgICAgICAgICAgICB2YXIgbWluQ3JlYXRpb25UaW1lID0gNTtcbiAgICAgICAgICAgICAgICB2YXIgbWF4Q3JlYXRpb25UaW1lTVMgPSAxMDA7XG5cbiAgICAgICAgICAgICAgICB2YXIgbWF0ZXJpYWwgPSBcbiAgICAgICAgICAgICAgICAoZnVuY3Rpb24gY3JlYXRlTW9yZSAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICggcGFydGljbGVzLmxlbmd0aCA8IG1heFBhcnRpY2xlcyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXJ0aWNsZSA9IG5ldyBQYXJ0aWNsZSggbWVzaCApO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXBwLnN3YXJtT2JqZWN0M0QuYWRkKCBwYXJ0aWNsZS5hbmNob3IgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRpY2xlcy5wdXNoKCBwYXJ0aWNsZSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCggY3JlYXRlTW9yZSwgVy5tYXAoIHBhcnRpY2xlcy5sZW5ndGggLyBtYXhQYXJ0aWNsZXMsIDAsIDEsIG1heENyZWF0aW9uVGltZU1TLCBtaW5DcmVhdGlvblRpbWUsIFcuaW50ZXJwb2xhdGlvbnMuZWFzZUluICkgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0oKSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFVwZGF0aW5nXG4gICAgICAgICAgICBhZGRQcmVSZW5kZXJGbiggYXBwLCBmdW5jdGlvbiAoIGRlbHRhTVMsIHRpbWVzdGFtcE1TICkge1xuICAgICAgICAgICAgICAgIHBhcnRpY2xlcy5mb3JFYWNoKCBwYXJ0aWNsZSA9PiBwYXJ0aWNsZS51cGRhdGUoIGRlbHRhTVMsIHRpbWVzdGFtcE1TICkgKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBQYXJ0aWNsZSBDbGFzc1xuICAgICAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgIGZ1bmN0aW9uIFBhcnRpY2xlICggbWVzaCApIHtcblxuICAgICAgICAgICAgICAgIHRoaXMudmVsb2NpdHkgPSBXLnJhbmRvbUJldHdlZW4oIDAuMiwgMSApO1xuXG4gICAgICAgICAgICAgICAgLy8gTWVzaFxuICAgICAgICAgICAgICAgIHRoaXMubWVzaCA9IG1lc2guY2xvbmUoKTtcbiAgICAgICAgICAgICAgICB0aGlzLm1lc2gubWF0ZXJpYWwgPSBQYXJ0aWNsZS5tYXRlcmlhbC5jbG9uZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMubWVzaC5zY2FsZS54ID0gUGFydGljbGUuaW5pdGlhbFNjYWxlO1xuICAgICAgICAgICAgICAgIHRoaXMubWVzaC5zY2FsZS55ID0gUGFydGljbGUuaW5pdGlhbFNjYWxlO1xuICAgICAgICAgICAgICAgIHRoaXMubWVzaC5zY2FsZS56ID0gUGFydGljbGUuaW5pdGlhbFNjYWxlO1xuXG4gICAgICAgICAgICAgICAgLy8gUG9zaXRpb25cbiAgICAgICAgICAgICAgICB2YXIgcmFuZ2UgPSAxMDA7XG4gICAgICAgICAgICAgICAgdGhpcy5tZXNoLnBvc2l0aW9uLnNldCggKCBNYXRoLnJhbmRvbSgpIC0gMC41ICkgKiByYW5nZSwgKCBNYXRoLnJhbmRvbSgpIC0gMC41ICkgKiByYW5nZSwgKCBNYXRoLnJhbmRvbSgpIC0gMC41ICkgKiByYW5nZSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB0aGlzLmFuY2hvciA9IG5ldyBUSFJFRS5PYmplY3QzRCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuYW5jaG9yLmFkZCggdGhpcy5tZXNoICk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vICMjIyBTdGF0aWNcbiAgICAgICAgICAgIFBhcnRpY2xlLm1hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hQaG9uZ01hdGVyaWFsKCB7XG5cdFx0Y29sb3I6IDB4ZmZmZmZmLFxuXHRcdHNoaW5pbmVzczogMC4wLFxuXHRcdHNwZWN1bGFyOiAweGZmZmZmZixcblx0XHRlbnZNYXA6IGFwcC5jdWJlQ2FtZXJhLnJlbmRlclRhcmdldCxcbiAgICAgICAgICAgICAgICByZWZsZWN0aXZpdHk6IDEuMCxcbiAgICAgICAgICAgICAgICBzaWRlOiBUSFJFRS5Eb3VibGVTaWRlXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgUGFydGljbGUuaW5pdGlhbFNjYWxlID0gMjAwO1xuXG4gICAgICAgICAgICAvLyAjIyMgTWV0aG9kXG4gICAgICAgICAgICBQYXJ0aWNsZS5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKCBkZWx0YU1TLCB0aW1lc3RhbXBNUyApIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFuY2hvci5yb3RhdGlvbi54ICs9IDAuMDAyO1xuICAgICAgICAgICAgICAgIHRoaXMuYW5jaG9yLnJvdGF0aW9uLnkgKz0gdGhpcy52ZWxvY2l0eSAvIDEwO1xuICAgICAgICAgICAgICAgIHRoaXMuYW5jaG9yLnJvdGF0aW9uLnogKz0gMC4wMDE7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXNvbHZlKCBhcHAgKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gUmVuZGVyIExvb3BcbiAgICAvLyAtLS0tLS0tLS0tLVxuICAgIGZ1bmN0aW9uIG1ha2VSZW5kZXJMb29wICggYXBwICkge1xuICAgICAgICByZXR1cm4gVy5wcm9taXNlKCBmdW5jdGlvbiAoIHJlc29sdmUsIHJlamVjdCApIHtcblxuICAgICAgICAgICAgdmFyIGxhc3RUaW1lc3RhbXBNUyA9IDA7XG4gICAgICAgICAgICB2YXIgZGVsdGFNUyA9IDA7XG5cbiAgICAgICAgICAgIChmdW5jdGlvbiAgbG9vcCAoIGN1cnJlbnRUaW1lc3RhbXBNUyApIHtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyBSZWN1clxuICAgICAgICAgICAgICAgIC8vIC0tLS0tXG4gICAgICAgICAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSggbG9vcCApO1xuXG4gICAgICAgICAgICAgICAgLy8gVXBkYXRlIHRpbWVzdGFtcHNcbiAgICAgICAgICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgICAgICBkZWx0YU1TID0gY3VycmVudFRpbWVzdGFtcE1TIC0gbGFzdFRpbWVzdGFtcE1TO1xuICAgICAgICAgICAgICAgIGxhc3RUaW1lc3RhbXBNUyA9IGN1cnJlbnRUaW1lc3RhbXBNUztcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyBBY3Rpb25hYmxlc1xuICAgICAgICAgICAgICAgIC8vIC0tLS0tLS0tLS0tXG4gICAgICAgICAgICAgICAgYXBwLnByZVJlbmRlckZucy5mb3JFYWNoKCBmbiA9PiBmbiggZGVsdGFNUywgY3VycmVudFRpbWVzdGFtcE1TICkgKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyBSZW5kZXJcbiAgICAgICAgICAgICAgICAvLyAtLS0tLS1cbiAgICAgICAgICAgICAgICBhcHAucmVuZGVyZXIuY2xlYXIoKTtcblx0XHRhcHAucmVuZGVyZXIucmVuZGVyKCBhcHAuc2NlbmUsIGFwcC5jYW1lcmEgKTtcblxuICAgICAgICAgICAgfSggbGFzdFRpbWVzdGFtcE1TICkpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXNvbHZlKCBhcHAgKTtcbiAgICAgICAgfSk7XG5cbiAgICB9XG5cbiAgICAvLyBVdGlsc1xuICAgIC8vID09PT09XG5cbiAgICAvLyBSZW5kZXIgTG9vcFxuICAgIC8vIC0tLS0tLS0tLS0tXG4gICAgZnVuY3Rpb24gYWRkUHJlUmVuZGVyRm4gKCBhcHAsIGZuICkge1xuICAgICAgICBhcHAucHJlUmVuZGVyRm5zLnB1c2goIGZuICk7XG4gICAgfVxuXG4gICAgLy8gQ2FtZXJhXG4gICAgLy8gLS0tLS0tXG4gICAgZnVuY3Rpb24gc2V0Q2FtZXJhUG9zaXRpb24gKCBhcHAsIHgsIHksIHogKSB7XG4gICAgICAgIGFwcC5jYW1lcmEucG9zaXRpb24ueCA9IHg7XG4gICAgICAgIGFwcC5jYW1lcmEucG9zaXRpb24ueSA9IHk7XG4gICAgICAgIGFwcC5jYW1lcmEucG9zaXRpb24ueiA9IHo7XG4gICAgfVxuIFxuICAgIC8vIEV4cG9ydFxuICAgIC8vID09PT09PSAgICBcbiAgICByZXR1cm4ge1xuICAgICAgICBtYWtlQXBwOiBtYWtlQXBwLFxuICAgICAgICBpbml0QXBwOiBpbml0QXBwICBcbiAgICB9O1xuICAgIFxufSgpKTtcblxuXG5cblxuXG5cbiIsIi8qIGpzaGludCBlc25leHQ6IHRydWUgKi9cblxuLy8gTWFpbi5qc1xuLy8gPT09PT09PVxuLy8gRW50cnkgcG9pbnQgb2YgdGhlIGFwcGxpY2F0aW9uLlxuXG4kKCBmdW5jdGlvbiAoKSB7XG5cbiAgICAvLyBQdW50ZXIgVml6XG4gICAgLy8gPT09PT09PT09PVxuICAgICQoIFwiW2RhdGEtcHVudGVyLXZpel1cIiApXG4gICAgICAgIC50b0FycmF5KClcbiAgICAgICAgLm1hcCggZnVuY3Rpb24gKCBlbCApIHtcblxuICAgICAgICAgICAgLy8gTWFrZSB0aGUgcHVudGVyIGFwcGxpY2F0aW9uXG4gICAgICAgICAgICB2YXIgYXBwID0gUHVudGVyVml6Lm1ha2VBcHAoKTtcbiAgICAgICAgICAgIC8vIEFkZCBvdXQgZG9tIGVsZW1lbnRcbiAgICAgICAgICAgIGFwcC5jb250YWluZXJFbCA9IGVsO1xuXG4gICAgICAgICAgICAvLyBJbml0YWlsaXNlIGl0XG4gICAgICAgICAgICBQdW50ZXJWaXpcbiAgICAgICAgICAgICAgICAuaW5pdEFwcCggYXBwIClcbiAgICAgICAgICAgICAgICAuZXJyb3IoIGZ1bmN0aW9uICggZXJyICkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCAnRmFpbGVkIHRvIGNyZWF0ZSBQdW50ZXIgYXBwJywgZXJyICk7XG4gICAgICAgICAgICAgICAgfSkgXG4gICAgICAgICAgICAgICAgLnN1Y2Nlc3MoIGZ1bmN0aW9uICggaW5pdGFsaXNlZFB1bnRlckFwcCApIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coICdQdW50ZXIgYXBwbGljYXRpb24gbWFkZScgKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbn0pO1xuXG4vKlxuXG4gICAgLy8gUHVudGVyc1xuICAgIC8vID09PT09PT1cbiAgICAkKCBcIltkYXRhLXB1bnRlcl1cIiApXG4gICAgICAgIC50b0FycmF5KClcbiAgICAgICAgLm1hcCggZWwgPT4geyBjb250YWluZXJFbDogZWwgfSApXG4gICAgICAgIC5tYXAoIGZ1bmN0aW9uICggYXBwICkge1xuXG4gICAgICAgICAgICB2YXIgd2luZG93SGFsZlggPSB3aW5kb3cuaW5uZXJXaWR0aCAvIDI7XG5cdCAgICB2YXIgd2luZG93SGFsZlkgPSB3aW5kb3cuaW5uZXJIZWlnaHQgLyAyO1xuICAgICAgICAgICAgdmFyIGhlaWdodCA9ICB3aW5kb3cuaW5uZXJIZWlnaHQ7XG5cbiAgICAgICAgICAgIHZhciBjYW1lcmEgPSBcbiAgICAgICAgICAgICAgICAgICAgY2FtZXJhLnBvc2l0aW9uLnkgPSAwO1xuXHQgICAgY2FtZXJhLnBvc2l0aW9uLnogPSAyMDA7XG5cbiAgICAgICAgICAgIHZhciBzY2VuZSA9IG5ldyBUSFJFRS5TY2VuZSgpO1xuXG4gICAgICAgICAgICB2YXIgcmVuZGVyZXIgPSBuZXcgVEhSRUUuV2ViR0xSZW5kZXJlciggeyBhbnRpYWxpYXM6IGZhbHNlIH0gKTtcblx0ICAgIHJlbmRlcmVyLnNldFBpeGVsUmF0aW8oIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvICk7XG5cdCAgICByZW5kZXJlci5zZXRTaXplKCB3aW5kb3cuaW5uZXJXaWR0aCwgaGVpZ2h0ICk7XG4gICAgICAgICAgICByZW5kZXJlci5zZXRDbGVhckNvbG9yKCAweDYxNjI2NCApO1xuXHQgICAgcmVuZGVyZXIuc29ydE9iamVjdHMgPSBmYWxzZTtcbiAgICAgICAgICAgIFxuXHQgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKCByZW5kZXJlci5kb21FbGVtZW50ICk7XG5cbiAgICAgICAgICAgIHZhciBvYmplY3QgPSBuZXcgVEhSRUUuT2JqZWN0M0QoKTtcblx0ICAgIHNjZW5lLmFkZCggb2JqZWN0ICk7XG5cbiAgICAgICAgICAgIHZhciByID0gXCIvcG5nL1wiO1xuICAgICAgICAgICAgXG5cdCAgICB2YXIgdXJscyA9IFsgciArIFwicHguanBnXCIsIHIgKyBcIm54LmpwZ1wiLFxuXHQgICAgICAgIFx0IHIgKyBcInB5LmpwZ1wiLCByICsgXCJueS5qcGdcIixcblx0ICAgICAgICBcdCByICsgXCJwei5qcGdcIiwgciArIFwibnouanBnXCIgXTtcblxuXHQgICAgdmFyIHRleHR1cmVDdWJlID0gVEhSRUUuSW1hZ2VVdGlscy5sb2FkVGV4dHVyZUN1YmUoIHVybHMgICk7XG5cdCAgICB0ZXh0dXJlQ3ViZS5mb3JtYXQgPSBUSFJFRS5SR0JGb3JtYXQ7XG5cbiAgICAgICAgICAgIHZhciB2aWRlbyAgICAgID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndmlkZW8nKTtcbiAgICAgICAgICAgIHZpZGVvLndpZHRoICAgID0gMjAwO1xuICAgICAgICAgICAgdmlkZW8uaGVpZ2h0ICAgPSAyMDA7XG4gICAgICAgICAgICB2aWRlby5hdXRvcGxheSA9IHRydWU7XG5cbiAgICAgICAgICAgIHZhciBjdWJlQ2FtZXJhID0gbmV3IFRIUkVFLkN1YmVDYW1lcmEoMSwgMzAwMCwgMjU2KTsgLy8gcGFyYW1ldGVyczogbmVhciwgZmFyLCByZXNvbHV0aW9uXG4gICAgICAgICAgICBjdWJlQ2FtZXJhLnJlbmRlclRhcmdldC5taW5GaWx0ZXIgPSBUSFJFRS5MaW5lYXJNaXBNYXBMaW5lYXJGaWx0ZXI7IC8vIG1pcG1hcCBmaWx0ZXJcblxuICAgICAgICAgICAgc2NlbmUuYWRkKGN1YmVDYW1lcmEpO1xuXG4gICAgICAgICAgICBuYXZpZ2F0b3Iud2Via2l0R2V0VXNlck1lZGlhKCB7IHZpZGVvOnRydWUgfSwgZnVuY3Rpb24oc3RyZWFtKXtcbiAgICAgICAgICAgICAgICB2aWRlby5zcmMgICAgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKHN0cmVhbSk7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbihlcnJvcil7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJGYWlsZWQgdG8gZ2V0IGEgc3RyZWFtIGR1ZSB0b1wiLCBlcnJvcik7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdmFyIHZpZGVvVGV4dHVyZSA9IG5ldyBUSFJFRS5UZXh0dXJlKCB2aWRlbyApO1xuICAgICAgICAgICAgdmlkZW9UZXh0dXJlLm1pbkZpbHRlciA9IFRIUkVFLkxpbmVhckZpbHRlcjtcblxuICAgICAgICAgICAgdmFyIHZpZGVvQm94TWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoe1xuICAgICAgICAgICAgICAgIG1hcDogdmlkZW9UZXh0dXJlLFxuICAgICAgICAgICAgICAgIGNvbG9yOiAweGZmZmZmZixcblx0ICAgICAgICBzaWRlOiBUSFJFRS5CYWNrU2lkZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2YXIgdmlkZW9Cb3hNZXNoID0gbmV3IFRIUkVFLk1lc2goIG5ldyBUSFJFRS5Cb3hHZW9tZXRyeSggMjAwMCwgMjAwMCwgMjAwMCApLCB2aWRlb0JveE1hdGVyaWFsICk7XG5cdCAgICBzY2VuZS5hZGQoIHZpZGVvQm94TWVzaCApO1xuXG5cdCAgICAvLyBTa3lib3hcblx0ICAgIHZhciBzaGFkZXIgPSBUSFJFRS5TaGFkZXJMaWJbIFwiY3ViZVwiIF07XG5cdCAgICBzaGFkZXIudW5pZm9ybXNbIFwidEN1YmVcIiBdLnZhbHVlID0gdGV4dHVyZUN1YmU7XG5cblx0ICAgIHZhciBtYXRlcmlhbCA9IG5ldyBUSFJFRS5TaGFkZXJNYXRlcmlhbCgge1xuXHQgICAgICAgIGZyYWdtZW50U2hhZGVyOiBzaGFkZXIuZnJhZ21lbnRTaGFkZXIsXG5cdCAgICAgICAgdmVydGV4U2hhZGVyOiBzaGFkZXIudmVydGV4U2hhZGVyLFxuXHQgICAgICAgIHVuaWZvcm1zOiBzaGFkZXIudW5pZm9ybXMsXG5cdCAgICAgICAgZGVwdGhXcml0ZTogZmFsc2UsXG5cdCAgICAgICAgc2lkZTogVEhSRUUuQmFja1NpZGVcblx0ICAgIH0gKTtcblxuICAgICAgICAgICAgdmFyIG1lc2ggPSBuZXcgVEhSRUUuTWVzaCggbmV3IFRIUkVFLkJveEdlb21ldHJ5KCAxMDAwLCAxMDAwLCAxMDAwICksIG1hdGVyaWFsICk7XG5cdCAgICAvLyBzY2VuZS5hZGQoIG1lc2ggKTtcblxuICAgICAgICAgICAgLy8gaW5zdGFudGlhdGUgYSBsb2FkZXJcbiAgICAgICAgICAgIHZhciBsb2FkZXIgPSBuZXcgVEhSRUUuT0JKTG9hZGVyKCk7XG5cbiAgICAgICAgICAgIC8vIGxvYWQgYSByZXNvdXJjZVxuICAgICAgICAgICAgbG9hZGVyLmxvYWQoXG4gICAgICAgICAgICAgICAgLy8gcmVzb3VyY2UgVVJMXG4gICAgICAgICAgICAgICAgJy9waWxsb3ctYm94Lm9iaicsXG4gICAgICAgICAgICAgICAgLy8gRnVuY3Rpb24gd2hlbiByZXNvdXJjZSBpcyBsb2FkZWRcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoIG9iamVjdCApIHtcbiAgICAgICAgICAgICAgICAgICAgLy9vYmplY3Quc2NhbGUuc2V0KCA2MDAsIDYwMCwgNjAwICk7XG4gICAgICAgICAgICAgICAgICAgIGNyZWF0ZU9yYiggb2JqZWN0LmNoaWxkcmVuWyAwIF0gKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAvLyBBZGQgQmFsbHNcblx0ICAgIHZhciBnZW9tZXRyeSA9IG5ldyBUSFJFRS5QbGFuZUdlb21ldHJ5KCAxMCwgMTAsIDMgKTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gY3JlYXRlT3JiKCBtZXNoICkge1xuXG5cdCAgICAgICAgZm9yICggdmFyIGkgPSAwOyBpIDwgMjA7IGkgKysgKSB7XG5cdFx0ICAgIC8vIE1lc2hQaG9uZ01hdGVyaWFsXG5cdFx0ICAgIHZhciBiYWxsbWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaFBob25nTWF0ZXJpYWwoIHtcblx0XHQgICAgICAgIGNvbG9yOiAweGU4ZTJjMSxcblx0XHQgICAgICAgIHNoaW5pbmVzczogMC4wLFxuXHRcdCAgICAgICAgc3BlY3VsYXI6IDB4ZmZmZmZmICxcblx0XHQgICAgICAgIGVudk1hcDogY3ViZUNhbWVyYS5yZW5kZXJUYXJnZXQsXG4gICAgICAgICAgICAgICAgICAgICAgICByZWZsZWN0aXZpdHk6IDEuMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGVcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vbWFwOiB2aWRlb1RleHR1cmVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cblx0XHQgICAgLy92YXIgbWVzaCA9IG5ldyBUSFJFRS5NZXNoKCBnZW9tZXRyeSwgYmFsbG1hdGVyaWFsICk7XG4gICAgICAgICAgICAgICAgICAgIG1lc2ggPSBtZXNoLmNsb25lKCk7XG4gICAgICAgICAgICAgICAgICAgIG1lc2gubWF0ZXJpYWwgPSBiYWxsbWF0ZXJpYWw7XG5cbiAgICAgICAgICAgICAgICAgICAgbWVzaC5zY2FsZS5zZXQoIDEwLCAxMCwgMTAgKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFuY2hvciA9IG5ldyBUSFJFRS5PYmplY3QzRCgpO1xuICAgICAgICAgICAgICAgICAgICBhbmNob3IuYWRkKCBtZXNoICk7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHBvc2l0aW9uU2NhbGFyID0gMzAwO1xuICAgICAgICAgICAgICAgICAgICB2YXIgc3BlZWQgPSBXLnJhbmRvbUJldHdlZW4oIDAuMywgMSApO1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBzID0gMS4yXG4gICAgICAgICAgICAgICAgICAgIG1lc2guc2NhbGUuc2V0KCAoMS1zcGVlZCkqcywgKDEtc3BlZWQpKnMsICgxLXNwZWVkKSpzICk7XG4gICAgICAgICAgICAgICAgICAgIFxuXHRcdCAgICBtZXNoLnBvc2l0aW9uLnNldChcblx0XHQgICAgICAgIC8vKCBNYXRoLnJhbmRvbSgpIC0gMC41ICkgKiBwb3NpdGlvblNjYWxhcixcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIDAsXG5cdFx0ICAgICAgICBXLm1hcCggc3BlZWQsIDAuMSwgMSwgcG9zaXRpb25TY2FsYXIvMiwgcG9zaXRpb25TY2FsYXIgKiAwLjIgKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAwXG5cdFx0ICAgICAgICAvLyggTWF0aC5yYW5kb20oKSAtIDAuNSApICogcG9zaXRpb25TY2FsYXJcblx0XHQgICAgKTtcblxuICAgICAgICAgICAgICAgICAgICBhbmNob3Iucm90YXRpb24uc2V0KCAoIE1hdGgucmFuZG9tKCkgLSAwLjUgKSAqIDEuMiwgKCBNYXRoLnJhbmRvbSgpIC0gMC41ICkgKiAxLjMsICggTWF0aC5yYW5kb20oKSAtIDAuNSApICogVy5QSV8yICk7XG5cblx0XHQgICAgbWVzaC5zY2FsZS5tdWx0aXBseVNjYWxhciggNTAwICk7XG5cdFx0ICAgIG9iamVjdC5hZGQoIGFuY2hvciApO1xuXG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbnMucHVzaCggKCBmdW5jdGlvbiAoIGFuY2hvciwgbWVzaCwgc3BlZWQgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuY2hvci5yb3RhdGlvbi55ICs9IFcubWFwKCBzcGVlZCwgMSwgMCwgMC4wOSwgMC4wMDAwMSwgVy5pbnRlcnBvbGF0aW9ucy5leHBvbmVudGlhbEVhc2VPdXQgICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzaC5yb3RhdGlvbi54ICs9IFcubWFwKCBzcGVlZCwgMSwgMCwgMC4wOSwgMC4wMDAwMSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc2gucm90YXRpb24ueSArPSBXLm1hcCggc3BlZWQsIDEsIDAsIDAuMDksIDAuMDAwMDEgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNoLnJvdGF0aW9uLnogKz0gVy5tYXAoIHNwZWVkLCAxLCAwLCAwLjA5LCAwLjAwMDAxICk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9OyBcbiAgICAgICAgICAgICAgICAgICAgfSggYW5jaG9yLCBtZXNoLCBzcGVlZCApKSk7XG5cdCAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzY2VuZS5hZGQoIG5ldyBUSFJFRS5BbWJpZW50TGlnaHQoIDB4MjIyMjIyICkgKTtcblxuICAgICAgICAgICAgdmFyIGRpcmVjdGlvbmFsTGlnaHQgPSBuZXcgVEhSRUUuRGlyZWN0aW9uYWxMaWdodCggMHhmZmZmZmYsIDIgKTtcblx0ICAgIGRpcmVjdGlvbmFsTGlnaHQucG9zaXRpb24uc2V0KCAyLCAxLjIsIDEwICkubm9ybWFsaXplKCk7XG5cdCAgICBzY2VuZS5hZGQoIGRpcmVjdGlvbmFsTGlnaHQgKTtcblxuXHQgICAgZGlyZWN0aW9uYWxMaWdodCA9IG5ldyBUSFJFRS5EaXJlY3Rpb25hbExpZ2h0KCAweGZmZmZmZiwgMSApO1xuXHQgICAgZGlyZWN0aW9uYWxMaWdodC5wb3NpdGlvbi5zZXQoIC0yLCAxLjIsIC0xMCApLm5vcm1hbGl6ZSgpO1xuXHQgICAgc2NlbmUuYWRkKCBkaXJlY3Rpb25hbExpZ2h0ICk7ICBcblxuXG4gICAgICAgICAgICAvLyBSZW5kZXJcbiAgICAgICAgICAgIHZhciB0aW1lID0gMDtcbiAgICAgICAgICAgIChmdW5jdGlvbiBsb29wICggZGVsdGEgKSB7XG4gICAgICAgICAgICAgICAgaWYoIHZpZGVvLnJlYWR5U3RhdGUgPT09IHZpZGVvLkhBVkVfRU5PVUdIX0RBVEEgKXtcbiAgICAgICAgICAgICAgICAgICAgdmlkZW9UZXh0dXJlLm5lZWRzVXBkYXRlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmlkZW9Cb3hNZXNoLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIG9iamVjdC52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgY3ViZUNhbWVyYS51cGRhdGVDdWJlTWFwKHJlbmRlcmVyLCBzY2VuZSk7XG4gICAgICAgICAgICAgICAgb2JqZWN0LnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHZpZGVvQm94TWVzaC52aXNpYmxlID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAvLyB2aWRlb0JveE1lc2gucm90YXRpb24ueCArPSAwLjE7XG4gICAgICAgICAgICAgICAgLy8gdmlkZW9Cb3hNZXNoLnJvdGF0aW9uLnkgKz0gMC4xO1xuICAgICAgICAgICAgICAgIC8vIHZpZGVvQm94TWVzaC5yb3RhdGlvbi56ICs9IDAuMTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKCBsb29wICk7XG4gICAgICAgICAgICAgICAgcmVuZGVyZXIuY2xlYXIoKTtcblx0XHRyZW5kZXJlci5yZW5kZXIoIHNjZW5lLCBjYW1lcmEgKTtcbiAgICAgICAgICAgICAgICB0aW1lICs9IGRlbHRhO1xuICAgICAgICAgICAgICAgIGFjdGlvbnMuZm9yRWFjaCggZnVuY3Rpb24gKCBhY3Rpb24gKSB7IGFjdGlvbiggZGVsdGEsIHRpbWUgKTsgfSApO1xuICAgICAgICAgICAgfSggMCApKTsgIFxuXG4gICAgICAgICAgICBcbiAgICAgICAgfSk7XG5cbn0pO1xuXG4qL1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9