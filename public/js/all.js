"use strict";function makeWebSocketClient(e){return W.promise(function(n,t){console.log("Connecting to websocket client:",e.wsUrl),e.wsClient=new W.JSONSocketConnection({socketUrl:e.wsUrl});var r=once(function(){$("[data-disconnected-warning]").remove(),report("CONNECTED","to:",e.wsUrl),n(e)});e.wsClient.on("open",r),e.wsClient.on("error",makeReporter("Web Socket Error")),e.wsClient.on("close",makeReporter("Web Socket Close")),e.wsClient.openSocketConnection()})}function addPunterCid(e){return W.promise(function(n,t){e.punterCid=$("[data-punter-cid]").data("punterCid"),n(e)})}function makePunterVizs(e){return W.promise(function(n,t){$("[data-punter-viz]").toArray().map(function(n){e.punterViz=PunterViz.makeViz(),e.punterViz.containerEl=n,e.punterViz.wsClient=e.wsClient;PunterViz.initViz(e.punterViz).error(function(e){console.error("Failed to create Punter app",e)}).success(function(n){if(window.location.search.indexOf("debug")>-1){var t=document.createElement("input");t.setAttribute("type","range"),t.setAttribute("min",-1),t.setAttribute("max",1),t.setAttribute("step",.01),t.setAttribute("value",.25),t.setAttribute("style","position: absolute"),$(t).asEventStream("change").map(function(e){return e.currentTarget}).map(function(e){return $(e).val()}).onValue(function(e){return PunterViz.setVelocity(n,null,e,null)}),$("#punter").prepend(t)}var r=25.714285714,o=$(window).asEventStream("deviceorientation").map(function(e){return[e.originalEvent.gamma,e.originalEvent.alpha,e.originalEvent.beta]}),i=o.map(function(e){return e[0]});o.throttle(100).onValue(function(e){return PunterViz.setVelocity(n,null,W.map(e[0],-180,180,-1,1,!0),null)}),i.map(function(e){return-r>e?"backward":e>r?"forward":"none"}).skipDuplicates().throttle(100).onValue(function(n){"phone-"+e.punterCid===e.controlMode&&RestesqueUtil.post(e.wsClient,"/motor/rotation/direction/",n)}),i.map(function(e){return Math.abs(e)}).map(function(e){return e>90-r?"high":e>90-2*r?"medium":"low"}).throttle(100).onValue(function(n){"phone-"+e.punterCid===e.controlMode&&RestesqueUtil.post(e.wsClient,"/motor/rotation/speed/",n)}),console.log("Punter application made")})}),n(e)})}function makeRestRadioButtons(e){return W.promise(function(n,t){$('[data-rest-type="radio-post"]').toArray().map($).map(function(n){var t=n.parent();t.on("click touchend",function(t){return t.preventDefault(),console.log("sending",n.val(),"to",n.data("restUri")),RestesqueUtil.post(e.wsClient,n.data("restUri"),n.val()),!1})}),$('[data-rest-type="feildset"]').toArray().map($).map(function(n){function t(){RestesqueUtil.subscribeWithInitialGet(e.wsClient,n.data("restUri"),function(e){r.prop("checked",!1).checkboxradio("refresh").filter('input[value="'+e.getBody()+'"]').attr("checked","checked").checkboxradio("refresh").parent().find("label").removeClass("ui-radio-off").addClass("ui-radio-on")})}var r=n.find('input[type="radio"]').checkboxradio();console.log("Got a field set",n.data("restUri")),t(),e.wsClient.on("open",function(){console.log("Subscribnig:",n.data("restUri")),t()})}),n(e)})}function once(e){var n=!1;return function(){n||(e(),n=!0)}}function report(e,n){console.log("[",e,"]",W.rest(W.toArray(arguments)).join(" "))}function makeReporter(e,n){var t=arguments;return function(){report.apply(this,t);var e=arguments;return W.promise(function(n,t){n.apply(this,e)})}}var PunterViz=function(){function e(){return{containerEl:document.createElement("div"),backroundColor:6382180,velocity:[0,0,0],preRenderFns:[],preCubeCamRenderFns:[],postCubeCamRenderFns:[],wsClient:void 0}}function n(e){return W.promise(function(n,t){function r(){RestesqueUtil.subscribeWithInitialGet(app.wsClient,"/host/control/mode/",function(e){app.controlMode=e.getBody(),console.log("Control Mode Change to:",app.controlMode)})}e.controlMode="",r(),e.wsClient.on("open",r),n(e)})}function t(e){return W.promise(function(n,t){e.camera=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,1,3e3),d(e,0,0,200),e.scene=new THREE.Scene,e.renderer=new THREE.WebGLRenderer({antialias:!1}),e.renderer.setPixelRatio(window.devicePixelRatio),e.renderer.setSize(window.innerWidth,window.innerHeight),e.renderer.setClearColor(e.backgroundColor),e.renderer.sortObjects=!1,e.containerEl.appendChild(e.renderer.domElement),n(e)})}function r(e){return W.promise(function(n,t){var r=document.createElement("video");r.autoplay=!0,navigator.webkitGetUserMedia({video:!0},function(e){r.src=URL.createObjectURL(e)},function(e){console.log("Failed to get a stream due to",e)}),e.webCamTexture=new THREE.Texture(r),e.webCamTexture.minFilter=THREE.LinearFilter,l(e,function(n,t){r.readyState===r.HAVE_ENOUGH_DATA&&(e.webCamTexture.needsUpdate=!0)}),n(e)})}function o(e){return W.promise(function(n,t){e.cubeCamera=new THREE.CubeCamera(1,3e3,256),e.cubeCamera.renderTarget.minFilter=THREE.LinearMipMapLinearFilter,l(e,function(n,t){e.preCubeCamRenderFns.forEach(function(e){return e(n,t)}),e.cubeCamera.updateCubeMap(e.renderer,e.scene),e.postCubeCamRenderFns.forEach(function(e){return e(n,t)})}),n(e)})}function i(e){return W.promise(function(n,t){e.webCamMaterial=new THREE.MeshBasicMaterial({map:e.webCamTexture,color:16777215,side:THREE.DoubleSide}),n(e)})}function a(e){return W.promise(function(n,t){function r(t){console.log(t.children[0]),e.webCamHedronMesh=t.children[0].clone(),e.webCamHedronMesh.material=e.webCamMaterial.clone();var r=2800;e.webCamHedronMesh.scale.set(r,r,r);var o=W.randomBetween(2e-4,2e-5),i=W.randomBetween(2e-4,2e-5),a=W.randomBetween(2e-4,2e-5);l(e,function(n,t){e.webCamHedronMesh.rotation.x+=n*o,e.webCamHedronMesh.rotation.y+=n*i,e.webCamHedronMesh.rotation.z+=n*a}),e.scene.add(e.webCamHedronMesh),e.preCubeCamRenderFns.push(function(){e.webCamHedronMesh.visible=!0,e.webCamHedronMesh.material.color.set(16777215)}),e.postCubeCamRenderFns.push(function(){e.webCamHedronMesh.visible=!0,e.webCamHedronMesh.material.color.set(7170113)}),n(e)}var o=new THREE.OBJLoader;o.load("/obj/hedron.obj",r)})}function s(e){return W.promise(function(n,t){e.scene.add(new THREE.AmbientLight(2236962));var r=new THREE.DirectionalLight(16777215,2);r.position.set(2,1.2,10).normalize(),e.scene.add(r),r=new THREE.DirectionalLight(16777215,1),r.position.set(-2,1.2,-10).normalize(),e.scene.add(r),n(e)})}function c(e){return W.promise(function(n,t){function r(e){this.positionScalar=W.interpolations.cubicEaseOut(Math.random());var n=r.initialScale*W.map(this.positionScalar,0,1,.4,1);this.mesh=e.clone(),this.anchor=new THREE.Object3D,this.anchor.add(this.mesh),this.mesh.material=r.material.clone(),this.mesh.scale.x=n,this.mesh.scale.y=n,this.mesh.scale.z=n;var t=60;this.mesh.position.set(t*(1-this.positionScalar),W.randomBetween(-50,50),0),this.mesh.rotation.x=W.randomBetween(-180,180),this.mesh.rotation.y=W.randomBetween(-180,180),this.mesh.rotation.z=W.randomBetween(-180,180),this.anchor.rotation.y+=W.randomBetween(-180,180)}function o(n){var t=n.children[0],o=100,a=5,s=20;!function c(){if(i.length<o){var n=new r(t);e.swarmObject3D.add(n.anchor),i.push(n),setTimeout(c,W.map(i.length/o,0,1,s,a,W.interpolations.easeIn))}}()}var i=[];e.swarmObject3D=new THREE.Object3D,e.scene.add(e.swarmObject3D),e.preCubeCamRenderFns.push(function(){e.swarmObject3D.visible=!1}),e.postCubeCamRenderFns.push(function(){e.swarmObject3D.visible=!0}),l(e,function(e,n){i.forEach(function(t){return t.update(e,n)})}),r.material=new THREE.MeshPhongMaterial({color:16777215,shininess:0,specular:16777215,envMap:e.cubeCamera.renderTarget,reflectivity:1,side:THREE.DoubleSide}),r.initialScale=300,r.prototype.update=function(n,t){this.anchor.rotation.x+=e.velocity[0]*(1-this.positionScalar)*.4,this.anchor.rotation.y+=e.velocity[1]*(1-this.positionScalar)*.4,this.anchor.rotation.z+=e.velocity[2]*(1-this.positionScalar)*.4,this.mesh.rotation.x+=.002,this.mesh.rotation.y+=.001,this.mesh.rotation.z+=.003};var a=new THREE.OBJLoader;a.load("/obj/pillow-box.obj",o),n(e)})}function u(e){return W.promise(function(n,t){var r=0,o=0;!function i(n){window.requestAnimationFrame(i),o=n-r,r=n,e.preRenderFns.forEach(function(e){return e(o,n)}),e.renderer.clear(),e.renderer.render(e.scene,e.camera)}(r),n(e)})}function l(e,n){return e.preRenderFns.push(n),e}function d(e,n,t,r){return e.camera.position.x=n,e.camera.position.y=t,e.camera.position.z=r,e}function p(e,n,t,r){return W.isDefined(n)&&null!==n&&(e.velocity[0]=n),W.isDefined(t)&&null!==t&&(e.velocity[1]=t),W.isDefined(r)&&null!==r&&(e.velocity[2]=r),e}var m=W.composePromisers(n,t,r,i,o,a,c,s,u);return{makeViz:e,initViz:m,setVelocity:p}}(),makeApp=function(){return{wsUrl:W.join("https:"===document.location.protocol?"wss://":"ws://",document.location.host,"/")}},initApp=W.composePromisers(makeWebSocketClient,addPunterCid,makePunterVizs,makeRestRadioButtons);$(function(){initApp(makeApp()).success(function(e){report("OK","TheWorkers.net"),window.app=e})});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFsbC5qcyIsIm1haW4uanMiLCJwdW50ZXItdml6LmpzIl0sIm5hbWVzIjpbIm1ha2VXZWJTb2NrZXRDbGllbnQiLCJhcHAiLCJXIiwicHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJjb25zb2xlIiwibG9nIiwid3NVcmwiLCJ3c0NsaWVudCIsIkpTT05Tb2NrZXRDb25uZWN0aW9uIiwic29ja2V0VXJsIiwicmVzb2x2ZU9uRmlyc3RDb25uZWN0Iiwib25jZSIsIiQiLCJyZW1vdmUiLCJyZXBvcnQiLCJvbiIsIm1ha2VSZXBvcnRlciIsIm9wZW5Tb2NrZXRDb25uZWN0aW9uIiwiYWRkUHVudGVyQ2lkIiwicHVudGVyQ2lkIiwiZGF0YSIsIm1ha2VQdW50ZXJWaXpzIiwidG9BcnJheSIsIm1hcCIsImVsIiwicHVudGVyVml6IiwiUHVudGVyVml6IiwibWFrZVZpeiIsImNvbnRhaW5lckVsIiwiaW5pdFZpeiIsImVycm9yIiwiZXJyIiwic3VjY2VzcyIsInZpeiIsIndpbmRvdyIsImxvY2F0aW9uIiwic2VhcmNoIiwiaW5kZXhPZiIsInJhbmdlRWwiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJzZXRBdHRyaWJ1dGUiLCJhc0V2ZW50U3RyZWFtIiwiZXZlbnQiLCJjdXJyZW50VGFyZ2V0IiwidmFsIiwib25WYWx1ZSIsInYiLCJzZXRWZWxvY2l0eSIsInByZXBlbmQiLCJyb3RhdGlvblN0ZXAiLCJvcmllbnRhdGlvblN0cmVhbSIsImUiLCJvcmlnaW5hbEV2ZW50IiwiZ2FtbWEiLCJhbHBoYSIsImJldGEiLCJnYW1tYVN0cmVhbSIsImFyciIsInRocm90dGxlIiwiZyIsInNraXBEdXBsaWNhdGVzIiwiZGlyZWN0aW9uIiwiY29udHJvbE1vZGUiLCJSZXN0ZXNxdWVVdGlsIiwicG9zdCIsIk1hdGgiLCJhYnMiLCJzcGVlZCIsIm1ha2VSZXN0UmFkaW9CdXR0b25zIiwiJGVsIiwiJHdyYXBwZXJFbCIsInBhcmVudCIsInByZXZlbnREZWZhdWx0Iiwic3Vic2NyaWJlUmFkaW9GZWlsZFNldCIsInN1YnNjcmliZVdpdGhJbml0aWFsR2V0IiwicGFja2V0IiwicmFkaW9FbHMiLCJwcm9wIiwiY2hlY2tib3hyYWRpbyIsImZpbHRlciIsImdldEJvZHkiLCJhdHRyIiwiZmluZCIsInJlbW92ZUNsYXNzIiwiYWRkQ2xhc3MiLCJmbiIsImhhc1RyaWdnZXJlZCIsInN0YXR1cyIsInN0ciIsInJlc3QiLCJhcmd1bWVudHMiLCJqb2luIiwicmVwb3J0QXJncyIsImFwcGx5IiwidGhpcyIsImNhbGxlZUFyZ3MiLCJiYWNrcm91bmRDb2xvciIsInZlbG9jaXR5IiwicHJlUmVuZGVyRm5zIiwicHJlQ3ViZUNhbVJlbmRlckZucyIsInBvc3RDdWJlQ2FtUmVuZGVyRm5zIiwidW5kZWZpbmVkIiwic3Vic2NyaWJlVG9Ib3N0Q29udHJvbE1vZGUiLCJzdWJzY3JpYmUiLCJtYWtlQ2FtZXJhU2NlbmVSZW5kZXJlciIsImNhbWVyYSIsIlRIUkVFIiwiUGVyc3BlY3RpdmVDYW1lcmEiLCJpbm5lcldpZHRoIiwiaW5uZXJIZWlnaHQiLCJzZXRDYW1lcmFQb3NpdGlvbiIsInNjZW5lIiwiU2NlbmUiLCJyZW5kZXJlciIsIldlYkdMUmVuZGVyZXIiLCJhbnRpYWxpYXMiLCJzZXRQaXhlbFJhdGlvIiwiZGV2aWNlUGl4ZWxSYXRpbyIsInNldFNpemUiLCJzZXRDbGVhckNvbG9yIiwiYmFja2dyb3VuZENvbG9yIiwic29ydE9iamVjdHMiLCJhcHBlbmRDaGlsZCIsImRvbUVsZW1lbnQiLCJtYWtlV2ViQ2FtVGV4dHVyZSIsIndlYkNhbUVsIiwiYXV0b3BsYXkiLCJuYXZpZ2F0b3IiLCJ3ZWJraXRHZXRVc2VyTWVkaWEiLCJ2aWRlbyIsInN0cmVhbSIsInNyYyIsIlVSTCIsImNyZWF0ZU9iamVjdFVSTCIsIndlYkNhbVRleHR1cmUiLCJUZXh0dXJlIiwibWluRmlsdGVyIiwiTGluZWFyRmlsdGVyIiwiYWRkUHJlUmVuZGVyRm4iLCJkZXRsYU1TIiwidGltZXN0YW1wTVMiLCJyZWFkeVN0YXRlIiwiSEFWRV9FTk9VR0hfREFUQSIsIm5lZWRzVXBkYXRlIiwibWFrZUN1YmVDYW0iLCJjdWJlQ2FtZXJhIiwiQ3ViZUNhbWVyYSIsInJlbmRlclRhcmdldCIsIkxpbmVhck1pcE1hcExpbmVhckZpbHRlciIsImRlbHRhTVMiLCJmb3JFYWNoIiwidXBkYXRlQ3ViZU1hcCIsIm1ha2VXZWJDYW1NYXRlcmlhbCIsIndlYkNhbU1hdGVyaWFsIiwiTWVzaEJhc2ljTWF0ZXJpYWwiLCJjb2xvciIsInNpZGUiLCJEb3VibGVTaWRlIiwibWFrZVdlYkNhbUhlZHJvbk1lc2giLCJvbk9iakxvYWRlZCIsIm9iaiIsImNoaWxkcmVuIiwid2ViQ2FtSGVkcm9uTWVzaCIsImNsb25lIiwibWF0ZXJpYWwiLCJzY2FsZSIsInNldCIsInJvdGF0aW9uWCIsInJhbmRvbUJldHdlZW4iLCJyb3RhdGlvblkiLCJyb3RhdGlvbloiLCJyb3RhdGlvbiIsIngiLCJ5IiwieiIsImFkZCIsInB1c2giLCJ2aXNpYmxlIiwibG9hZGVyIiwiT0JKTG9hZGVyIiwibG9hZCIsIm1ha2VMaWdodHMiLCJBbWJpZW50TGlnaHQiLCJkaXJlY3Rpb25hbExpZ2h0IiwiRGlyZWN0aW9uYWxMaWdodCIsInBvc2l0aW9uIiwibm9ybWFsaXplIiwibWFrZVN3YXJtIiwiUGFydGljbGUiLCJtZXNoIiwicG9zaXRpb25TY2FsYXIiLCJpbnRlcnBvbGF0aW9ucyIsImN1YmljRWFzZU91dCIsInJhbmRvbSIsImluaXRpYWxTY2FsZSIsImFuY2hvciIsIk9iamVjdDNEIiwicmFuZ2VNYXhYIiwibWF4UGFydGljbGVzIiwibWluQ3JlYXRpb25UaW1lIiwibWF4Q3JlYXRpb25UaW1lTVMiLCJjcmVhdGVNb3JlIiwicGFydGljbGVzIiwibGVuZ3RoIiwicGFydGljbGUiLCJzd2FybU9iamVjdDNEIiwic2V0VGltZW91dCIsImVhc2VJbiIsInVwZGF0ZSIsIk1lc2hQaG9uZ01hdGVyaWFsIiwic2hpbmluZXNzIiwic3BlY3VsYXIiLCJlbnZNYXAiLCJyZWZsZWN0aXZpdHkiLCJwcm90b3R5cGUiLCJtYWtlUmVuZGVyTG9vcCIsImxhc3RUaW1lc3RhbXBNUyIsImxvb3AiLCJjdXJyZW50VGltZXN0YW1wTVMiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJjbGVhciIsInJlbmRlciIsImlzRGVmaW5lZCIsImNvbXBvc2VQcm9taXNlcnMiLCJtYWtlQXBwIiwicHJvdG9jb2wiLCJob3N0IiwiaW5pdEFwcCJdLCJtYXBwaW5ncyI6IkFBUUEsWUN5QkEsU0FBU0EscUJBQXNCQyxHQUMzQixNQUFPQyxHQUFFQyxRQUFTLFNBQVdDLEVBQVNDLEdBQ2xDQyxRQUFRQyxJQUFLLGtDQUFtQ04sRUFBSU8sT0FFcERQLEVBQUlRLFNBQVcsR0FBSVAsR0FBRVEsc0JBQ2pCQyxVQUFXVixFQUFJTyxPQUduQixJQUFJSSxHQUF3QkMsS0FBTSxXQUM5QkMsRUFBRywrQkFBZ0NDLFNBQ25DQyxPQUFRLFlBQWEsTUFBT2YsRUFBSU8sT0FDaENKLEVBQVNILElBR2JBLEdBQUlRLFNBQVNRLEdBQUksT0FBUUwsR0FDekJYLEVBQUlRLFNBQVNRLEdBQUksUUFBU0MsYUFBYyxxQkFDeENqQixFQUFJUSxTQUFTUSxHQUFJLFFBQVNDLGFBQWMscUJBQ3hDakIsRUFBSVEsU0FBU1UseUJBSXJCLFFBQVNDLGNBQWVuQixHQUNwQixNQUFPQyxHQUFFQyxRQUFTLFNBQVdDLEVBQVNDLEdBQ2xDSixFQUFJb0IsVUFBWVAsRUFBRyxxQkFBc0JRLEtBQU0sYUFDL0NsQixFQUFTSCxLQU9qQixRQUFTc0IsZ0JBQWlCdEIsR0FDdEIsTUFBT0MsR0FBRUMsUUFBUyxTQUFXQyxFQUFTQyxHQUNsQ1MsRUFBRyxxQkFDRVUsVUFDQUMsSUFBSyxTQUFXQyxHQUViekIsRUFBSTBCLFVBQVlDLFVBQVVDLFVBRTFCNUIsRUFBSTBCLFVBQVVHLFlBQWNKLEVBRTVCekIsRUFBSTBCLFVBQVVsQixTQUFXUixFQUFJUSxRQU03Qm1CLFdBQ0tHLFFBQVM5QixFQUFJMEIsV0FDYkssTUFBTyxTQUFXQyxHQUNmM0IsUUFBUTBCLE1BQU8sOEJBQStCQyxLQUVqREMsUUFBUyxTQUFXQyxHQU9qQixHQUFLQyxPQUFPQyxTQUFTQyxPQUFPQyxRQUFTLFNBQVcsR0FBSyxDQUdqRCxHQUFJQyxHQUFVQyxTQUFTQyxjQUFlLFFBQ3RDRixHQUFRRyxhQUFjLE9BQVEsU0FDOUJILEVBQVFHLGFBQWMsTUFBTyxJQUM3QkgsRUFBUUcsYUFBYyxNQUFPLEdBQzdCSCxFQUFRRyxhQUFjLE9BQVEsS0FDOUJILEVBQVFHLGFBQWMsUUFBUyxLQUMvQkgsRUFBUUcsYUFBYyxRQUFTLHNCQUUvQjdCLEVBQUcwQixHQUNFSSxjQUFlLFVBQ2ZuQixJQUFLLFNBQUFvQixHRHNiZCxNQ3RidUJBLEdBQU1DLGdCQUNwQnJCLElBQUssU0FBQUMsR0R1YmQsTUN2Ym9CWixHQUFHWSxHQUFLcUIsUUFDbkJDLFFBQVMsU0FBQUMsR0R3YmxCLE1DeGJ1QnJCLFdBQVVzQixZQUFhZixFQUFLLEtBQU1jLEVBQUcsUUFFeERuQyxFQUFHLFdBQVlxQyxRQUFTWCxHQU01QixHQUFJWSxHQUFlLGFBSWZDLEVBQXFCdkMsRUFBR3NCLFFBQ25CUSxjQUFlLHFCQUNmbkIsSUFBSyxTQUFBNkIsR0R1YmxCLE9DdmJ5QkEsRUFBRUMsY0FBY0MsTUFBT0YsRUFBRUMsY0FBY0UsTUFBT0gsRUFBRUMsY0FBY0csUUFFL0VDLEVBQWNOLEVBQ2I1QixJQUFLLFNBQUFtQyxHRHdiZCxNQ3hicUJBLEdBQUssSUFFdEJQLEdBQ0tRLFNBQVUsS0FDVmIsUUFBUyxTQUFBWSxHRHdibEIsTUN4YnlCaEMsV0FBVXNCLFlBQWFmLEVBQUssS0FBTWpDLEVBQUV1QixJQUFLbUMsRUFBSSxHQUFJLEtBQU0sSUFBSyxHQUFJLEdBQUcsR0FBUSxRQVNoR0QsRUFDS2xDLElBQUssU0FBV3FDLEdBQ2IsT0FBVVYsRUFBTFUsRUFBNkIsV0FDeEJBLEVBQUlWLEVBQXdCLFVBQ3hCLFNBRWpCVyxpQkFDQUYsU0FBVSxLQUNWYixRQUFTLFNBQVdnQixHQUNaLFNBQVcvRCxFQUFJb0IsWUFBY3BCLEVBQUlnRSxhQUNsQ0MsY0FBY0MsS0FBTWxFLEVBQUlRLFNBQVUsNkJBQThCdUQsS0FLNUVMLEVBQ0tsQyxJQUFLLFNBQUFxQyxHRHdiZCxNQ3hibUJNLE1BQUtDLElBQUtQLEtBQ3BCckMsSUFBSyxTQUFXcUMsR0FDYixNQUFLQSxHQUFJLEdBQUtWLEVBQXdCLE9BQzVCVSxFQUFJLEdBQXNCLEVBQWZWLEVBQThCLFNBQ3JDLFFBRWpCUyxTQUFVLEtBQ1ZiLFFBQVMsU0FBV3NCLEdBQ1osU0FBV3JFLEVBQUlvQixZQUFjcEIsRUFBSWdFLGFBQ2xDQyxjQUFjQyxLQUFNbEUsRUFBSVEsU0FBVSx5QkFBMEI2RCxLQUl4RWhFLFFBQVFDLElBQUssK0JBSTdCSCxFQUFTSCxLQU9qQixRQUFTc0Usc0JBQXVCdEUsR0FDNUIsTUFBT0MsR0FBRUMsUUFBUyxTQUFXQyxFQUFTQyxHQUdsQ1MsRUFBRyxpQ0FDRVUsVUFDQUMsSUFBS1gsR0FDTFcsSUFBSyxTQUFXK0MsR0FFYixHQUFJQyxHQUFhRCxFQUFJRSxRQUNyQkQsR0FBV3hELEdBQUksaUJBQWtCLFNBQVdxQyxHQUl4QyxNQUhBQSxHQUFFcUIsaUJBQ0ZyRSxRQUFRQyxJQUFLLFVBQVVpRSxFQUFJekIsTUFBTyxLQUFNeUIsRUFBSWxELEtBQU0sWUFDbEQ0QyxjQUFjQyxLQUFNbEUsRUFBSVEsU0FBVStELEVBQUlsRCxLQUFNLFdBQWFrRCxFQUFJekIsUUFDdEQsTUFNbkJqQyxFQUFHLCtCQUNFVSxVQUNBQyxJQUFLWCxHQUNMVyxJQUFLLFNBQVcrQyxHQVliLFFBQVNJLEtBQ0xWLGNBQWNXLHdCQUF5QjVFLEVBQUlRLFNBQVUrRCxFQUFJbEQsS0FBTSxXQUFhLFNBQVd3RCxHQUNuRkMsRUFDS0MsS0FBTSxXQUFXLEdBQ2pCQyxjQUFlLFdBQ2ZDLE9BQVEsZ0JBQWlCSixFQUFPSyxVQUFXLE1BQzNDQyxLQUFNLFVBQVcsV0FDakJILGNBQWUsV0FDZlAsU0FDQVcsS0FBTSxTQUNOQyxZQUFhLGdCQUNiQyxTQUFVLGlCQXJCdkIsR0FBSVIsR0FBV1AsRUFBSWEsS0FBTSx1QkFBd0JKLGVBRWpEM0UsU0FBUUMsSUFBTSxrQkFBbUJpRSxFQUFJbEQsS0FBTSxZQUUzQ3NELElBQ0EzRSxFQUFJUSxTQUFTUSxHQUFJLE9BQVEsV0FDckJYLFFBQVFDLElBQUssZUFBaUJpRSxFQUFJbEQsS0FBTSxZQUN4Q3NELFFBbUJaeEUsRUFBU0gsS0FVakIsUUFBU1ksTUFBTzJFLEdBQ1osR0FBSUMsSUFBZSxDQUNuQixPQUFPLFlBQ0lBLElBQ0hELElBQ0FDLEdBQWUsSUFRM0IsUUFBU3pFLFFBQVEwRSxFQUFRQyxHQUNyQnJGLFFBQVFDLElBQUssSUFBS21GLEVBQVEsSUFBS3hGLEVBQUUwRixLQUFNMUYsRUFBRXNCLFFBQVNxRSxZQUFjQyxLQUFNLE1BRzFFLFFBQVM1RSxjQUFjd0UsRUFBUUMsR0FDM0IsR0FBSUksR0FBYUYsU0FDakIsT0FBTyxZQUNIN0UsT0FBT2dGLE1BQU9DLEtBQU1GLEVBQ3BCLElBQUlHLEdBQWFMLFNBQ2pCLE9BQU8zRixHQUFFQyxRQUFTLFNBQVdDLEVBQVNDLEdBQ2xDRCxFQUFRNEYsTUFBT0MsS0FBTUMsTUM3UGpDLEdBQUl0RSxXQUFhLFdBSWIsUUFBU0MsS0FDTCxPQUNJQyxZQUFhVyxTQUFTQyxjQUFlLE9BQ3JDeUQsZUFBZ0IsUUFDaEJDLFVBQVksRUFBRyxFQUFHLEdBQ2xCQyxnQkFDQUMsdUJBQ0FDLHdCQUNBOUYsU0FBVStGLFFBb0JsQixRQUFTQyxHQUE2QnRFLEdBQ2xDLE1BQU9qQyxHQUFFQyxRQUFTLFNBQVdDLEVBQVNDLEdBTWxDLFFBQVNxRyxLQUNMeEMsY0FDS1csd0JBQXlCNUUsSUFBSVEsU0FBVSxzQkFBdUIsU0FBV3FFLEdBQ3RFN0UsSUFBSWdFLFlBQWNhLEVBQU9LLFVBQ3pCN0UsUUFBUUMsSUFBSywwQkFBMkJOLElBQUlnRSxlQVR4RDlCLEVBQUk4QixZQUFjLEdBRWxCeUMsSUFDQXZFLEVBQUkxQixTQUFTUSxHQUFJLE9BQVF5RixHQVV6QnRHLEVBQVMrQixLQU1qQixRQUFTd0UsR0FBMEJ4RSxHQUMvQixNQUFPakMsR0FBRUMsUUFBUyxTQUFXQyxFQUFTQyxHQUlsQzhCLEVBQUl5RSxPQUFTLEdBQUlDLE9BQU1DLGtCQUFtQixHQUFJMUUsT0FBTzJFLFdBQWEzRSxPQUFPNEUsWUFBYSxFQUFHLEtBQ3pGQyxFQUFtQjlFLEVBQUssRUFBRyxFQUFHLEtBSTlCQSxFQUFJK0UsTUFBUSxHQUFJTCxPQUFNTSxNQUl0QmhGLEVBQUlpRixTQUFXLEdBQUlQLE9BQU1RLGVBQWlCQyxXQUFXLElBQ3JEbkYsRUFBSWlGLFNBQVNHLGNBQWVuRixPQUFPb0Ysa0JBQ25DckYsRUFBSWlGLFNBQVNLLFFBQVNyRixPQUFPMkUsV0FBWTNFLE9BQU80RSxhQUNoRDdFLEVBQUlpRixTQUFTTSxjQUFldkYsRUFBSXdGLGlCQUNoQ3hGLEVBQUlpRixTQUFTUSxhQUFjLEVBRTNCekYsRUFBSUwsWUFBWStGLFlBQWExRixFQUFJaUYsU0FBU1UsWUFFMUMxSCxFQUFTK0IsS0FPakIsUUFBUzRGLEdBQW9CNUYsR0FDekIsTUFBT2pDLEdBQUVDLFFBQVMsU0FBV0MsRUFBU0MsR0FJbEMsR0FBSTJILEdBQVd2RixTQUFTQyxjQUFjLFFBQ3RDc0YsR0FBU0MsVUFBVyxFQUlwQkMsVUFBVUMsb0JBQXNCQyxPQUFNLEdBQVEsU0FBVUMsR0FDcERMLEVBQVNNLElBQU1DLElBQUlDLGdCQUFpQkgsSUFDckMsU0FBVXBHLEdBQ1QzQixRQUFRQyxJQUFJLGdDQUFpQzBCLEtBS2pERSxFQUFJc0csY0FBZ0IsR0FBSTVCLE9BQU02QixRQUFTVixHQUN2QzdGLEVBQUlzRyxjQUFjRSxVQUFZOUIsTUFBTStCLGFBSXBDQyxFQUFnQjFHLEVBQUssU0FBVzJHLEVBQVNDLEdBQ2pDZixFQUFTZ0IsYUFBZWhCLEVBQVNpQixtQkFDakM5RyxFQUFJc0csY0FBY1MsYUFBYyxLQUl4QzlJLEVBQVMrQixLQVVqQixRQUFTZ0gsR0FBY2hILEdBQ25CLE1BQU9qQyxHQUFFQyxRQUFTLFNBQVdDLEVBQVNDLEdBRWxDOEIsRUFBSWlILFdBQWEsR0FBSXZDLE9BQU13QyxXQUFXLEVBQUcsSUFBTSxLQUMvQ2xILEVBQUlpSCxXQUFXRSxhQUFhWCxVQUFZOUIsTUFBTTBDLHlCQUU5Q1YsRUFBZ0IxRyxFQUFLLFNBQVdxSCxFQUFTVCxHQUdyQzVHLEVBQUltRSxvQkFBb0JtRCxRQUFTLFNBQUFqRSxHRkw3QixNRUttQ0EsR0FBSWdFLEVBQVNULEtBQ3BENUcsRUFBSWlILFdBQVdNLGNBQWV2SCxFQUFJaUYsU0FBVWpGLEVBQUkrRSxPQUNoRC9FLEVBQUlvRSxxQkFBcUJrRCxRQUFTLFNBQUFqRSxHRkg5QixNRUdvQ0EsR0FBSWdFLEVBQVNULE9BR3pEM0ksRUFBUytCLEtBTWpCLFFBQVN3SCxHQUFxQnhILEdBQzFCLE1BQU9qQyxHQUFFQyxRQUFTLFNBQVdDLEVBQVNDLEdBQ2xDOEIsRUFBSXlILGVBQWlCLEdBQUkvQyxPQUFNZ0QsbUJBQzNCcEksSUFBS1UsRUFBSXNHLGNBQ1RxQixNQUFPLFNBQ1BDLEtBQU1sRCxNQUFNbUQsYUFFaEI1SixFQUFTK0IsS0EwQ2pCLFFBQVM4SCxHQUF1QjlILEdBQzVCLE1BQU9qQyxHQUFFQyxRQUFTLFNBQVdDLEVBQVNDLEdBU2xDLFFBQVM2SixHQUFjQyxHQUNuQjdKLFFBQVFDLElBQUs0SixFQUFJQyxTQUFVLElBQzNCakksRUFBSWtJLGlCQUFtQkYsRUFBSUMsU0FBVSxHQUFJRSxRQUN6Q25JLEVBQUlrSSxpQkFBaUJFLFNBQVdwSSxFQUFJeUgsZUFBZVUsT0FFbkQsSUFBSUUsR0FBUSxJQUNackksR0FBSWtJLGlCQUFpQkcsTUFBTUMsSUFBS0QsRUFBT0EsRUFBT0EsRUFFOUMsSUFBSUUsR0FBWXhLLEVBQUV5SyxjQUFlLEtBQVEsTUFDckNDLEVBQVkxSyxFQUFFeUssY0FBZSxLQUFRLE1BQ3JDRSxFQUFZM0ssRUFBRXlLLGNBQWUsS0FBUSxLQUd6QzlCLEdBQWdCMUcsRUFBSyxTQUFXcUgsRUFBU1QsR0FDckM1RyxFQUFJa0ksaUJBQWlCUyxTQUFTQyxHQUFPdkIsRUFBVWtCLEVBQy9DdkksRUFBSWtJLGlCQUFpQlMsU0FBU0UsR0FBT3hCLEVBQVVvQixFQUMvQ3pJLEVBQUlrSSxpQkFBaUJTLFNBQVNHLEdBQU96QixFQUFVcUIsSUFHbkQxSSxFQUFJK0UsTUFBTWdFLElBQUsvSSxFQUFJa0ksa0JBR25CbEksRUFBSW1FLG9CQUFvQjZFLEtBQU0sV0FDMUJoSixFQUFJa0ksaUJBQWlCZSxTQUFVLEVBQy9CakosRUFBSWtJLGlCQUFpQkUsU0FBU1QsTUFBTVcsSUFBSyxZQUc3Q3RJLEVBQUlvRSxxQkFBcUI0RSxLQUFNLFdBQzNCaEosRUFBSWtJLGlCQUFpQmUsU0FBVSxFQUMvQmpKLEVBQUlrSSxpQkFBaUJFLFNBQVNULE1BQU1XLElBQUssV0FHN0NySyxFQUFTK0IsR0FyQ2IsR0FBSWtKLEdBQVMsR0FBSXhFLE9BQU15RSxTQUN2QkQsR0FBT0UsS0FBTSxrQkFBbUJyQixLQTRDeEMsUUFBU3NCLEdBQWFySixHQUNsQixNQUFPakMsR0FBRUMsUUFBUyxTQUFXQyxFQUFTQyxHQUNsQzhCLEVBQUkrRSxNQUFNZ0UsSUFBSyxHQUFJckUsT0FBTTRFLGFBQWMsU0FFdkMsSUFBSUMsR0FBbUIsR0FBSTdFLE9BQU04RSxpQkFBa0IsU0FBVSxFQUM3REQsR0FBaUJFLFNBQVNuQixJQUFLLEVBQUcsSUFBSyxJQUFLb0IsWUFDNUMxSixFQUFJK0UsTUFBTWdFLElBQUtRLEdBRWZBLEVBQW1CLEdBQUk3RSxPQUFNOEUsaUJBQWtCLFNBQVUsR0FDekRELEVBQWlCRSxTQUFTbkIsSUFBSyxHQUFJLElBQUssS0FBTW9CLFlBQzlDMUosRUFBSStFLE1BQU1nRSxJQUFLUSxHQUNmdEwsRUFBUytCLEtBTWpCLFFBQVMySixHQUFZM0osR0FDakIsTUFBT2pDLEdBQUVDLFFBQVMsU0FBV0MsRUFBU0MsR0FzQmxDLFFBQVMwTCxHQUFXQyxHQUdoQi9GLEtBQUtnRyxlQUFpQi9MLEVBQUVnTSxlQUFlQyxhQUFjL0gsS0FBS2dJLFNBRTFELElBQUk1QixHQUFRdUIsRUFBU00sYUFBZW5NLEVBQUV1QixJQUFLd0UsS0FBS2dHLGVBQWdCLEVBQUcsRUFBRyxHQUFLLEVBRzNFaEcsTUFBSytGLEtBQU9BLEVBQUsxQixRQUNqQnJFLEtBQUtxRyxPQUFTLEdBQUl6RixPQUFNMEYsU0FDeEJ0RyxLQUFLcUcsT0FBT3BCLElBQUtqRixLQUFLK0YsTUFDdEIvRixLQUFLK0YsS0FBS3pCLFNBQVd3QixFQUFTeEIsU0FBU0QsUUFDdkNyRSxLQUFLK0YsS0FBS3hCLE1BQU1PLEVBQUlQLEVBQ3BCdkUsS0FBSytGLEtBQUt4QixNQUFNUSxFQUFJUixFQUNwQnZFLEtBQUsrRixLQUFLeEIsTUFBTVMsRUFBSVQsQ0FFcEIsSUFBSWdDLEdBQVksRUFFaEJ2RyxNQUFLK0YsS0FBS0osU0FBU25CLElBQUsrQixHQUFhLEVBQUl2RyxLQUFLZ0csZ0JBQWlCL0wsRUFBRXlLLGNBQWUsSUFBSyxJQUFNLEdBSTNGMUUsS0FBSytGLEtBQUtsQixTQUFTQyxFQUFJN0ssRUFBRXlLLGNBQWUsS0FBTSxLQUM5QzFFLEtBQUsrRixLQUFLbEIsU0FBU0UsRUFBSTlLLEVBQUV5SyxjQUFlLEtBQU0sS0FDOUMxRSxLQUFLK0YsS0FBS2xCLFNBQVNHLEVBQUkvSyxFQUFFeUssY0FBZSxLQUFNLEtBRTlDMUUsS0FBS3FHLE9BQU94QixTQUFTRSxHQUFNOUssRUFBRXlLLGNBQWUsS0FBTSxLQXNDdEQsUUFBU1QsR0FBY0MsR0FFbkIsR0FBSTZCLEdBQU83QixFQUFJQyxTQUFVLEdBS3JCcUMsRUFBZSxJQUNmQyxFQUFrQixFQUNsQkMsRUFBb0IsSUFFdkIsUUFBU0MsS0FDTixHQUFLQyxFQUFVQyxPQUFTTCxFQUFlLENBQ25DLEdBQUlNLEdBQVcsR0FBSWhCLEdBQVVDLEVBQzdCN0osR0FBSTZLLGNBQWM5QixJQUFLNkIsRUFBU1QsUUFDaENPLEVBQVUxQixLQUFNNEIsR0FDaEJFLFdBQVlMLEVBQVkxTSxFQUFFdUIsSUFBS29MLEVBQVVDLE9BQVNMLEVBQWMsRUFBRyxFQUFHRSxFQUFtQkQsRUFBaUJ4TSxFQUFFZ00sZUFBZWdCLGFBcEd2SSxHQUFJTCxLQUlKMUssR0FBSTZLLGNBQWdCLEdBQUluRyxPQUFNMEYsU0FDOUJwSyxFQUFJK0UsTUFBTWdFLElBQUsvSSxFQUFJNkssZUFDbkI3SyxFQUFJbUUsb0JBQW9CNkUsS0FBTSxXQUMxQmhKLEVBQUk2SyxjQUFjNUIsU0FBVSxJQUVoQ2pKLEVBQUlvRSxxQkFBcUI0RSxLQUFNLFdBQzNCaEosRUFBSTZLLGNBQWM1QixTQUFVLElBSWhDdkMsRUFBZ0IxRyxFQUFLLFNBQVdxSCxFQUFTVCxHQUNyQzhELEVBQVVwRCxRQUFTLFNBQUFzRCxHRkhmLE1FRzJCQSxHQUFTSSxPQUFRM0QsRUFBU1QsT0F5QzdEZ0QsRUFBU3hCLFNBQVcsR0FBSTFELE9BQU11RyxtQkFDMUJ0RCxNQUFPLFNBQ1B1RCxVQUFXLEVBQ1hDLFNBQVUsU0FDVkMsT0FBUXBMLEVBQUlpSCxXQUFXRSxhQUN2QmtFLGFBQWMsRUFDZHpELEtBQU1sRCxNQUFNbUQsYUFHaEIrQixFQUFTTSxhQUFlLElBR3hCTixFQUFTMEIsVUFBVU4sT0FBUyxTQUFXM0QsRUFBU1QsR0FDNUM5QyxLQUFLcUcsT0FBT3hCLFNBQVNDLEdBQUs1SSxFQUFJaUUsU0FBVSxJQUFRLEVBQUlILEtBQUtnRyxnQkFBbUIsR0FDNUVoRyxLQUFLcUcsT0FBT3hCLFNBQVNFLEdBQUs3SSxFQUFJaUUsU0FBVSxJQUFRLEVBQUlILEtBQUtnRyxnQkFBbUIsR0FDNUVoRyxLQUFLcUcsT0FBT3hCLFNBQVNHLEdBQUs5SSxFQUFJaUUsU0FBVSxJQUFRLEVBQUlILEtBQUtnRyxnQkFBbUIsR0FDNUVoRyxLQUFLK0YsS0FBS2xCLFNBQVNDLEdBQUssS0FDeEI5RSxLQUFLK0YsS0FBS2xCLFNBQVNFLEdBQUssS0FDeEIvRSxLQUFLK0YsS0FBS2xCLFNBQVNHLEdBQUssS0FLNUIsSUFBSUksR0FBUyxHQUFJeEUsT0FBTXlFLFNBQ3ZCRCxHQUFPRSxLQUFNLHNCQUF1QnJCLEdBeUJwQzlKLEVBQVMrQixLQU1qQixRQUFTdUwsR0FBaUJ2TCxHQUN0QixNQUFPakMsR0FBRUMsUUFBUyxTQUFXQyxFQUFTQyxHQUVsQyxHQUFJc04sR0FBa0IsRUFDbEJuRSxFQUFVLEdBRWIsUUFBVW9FLEdBQU9DLEdBSWR6TCxPQUFPMEwsc0JBQXVCRixHQUk5QnBFLEVBQVVxRSxFQUFxQkYsRUFDL0JBLEVBQWtCRSxFQUlsQjFMLEVBQUlrRSxhQUFhb0QsUUFBUyxTQUFBakUsR0ZKdEIsTUVJNEJBLEdBQUlnRSxFQUFTcUUsS0FJN0MxTCxFQUFJaUYsU0FBUzJHLFFBQ2I1TCxFQUFJaUYsU0FBUzRHLE9BQVE3TCxFQUFJK0UsTUFBTy9FLEVBQUl5RSxTQUVyQytHLEdBRUh2TixFQUFTK0IsS0FVakIsUUFBUzBHLEdBQWlCMUcsRUFBS3FELEdBRTNCLE1BREFyRCxHQUFJa0UsYUFBYThFLEtBQU0zRixHQUNoQnJELEVBS1gsUUFBUzhFLEdBQW9COUUsRUFBSzRJLEVBQUdDLEVBQUdDLEdBSXBDLE1BSEE5SSxHQUFJeUUsT0FBT2dGLFNBQVNiLEVBQUlBLEVBQ3hCNUksRUFBSXlFLE9BQU9nRixTQUFTWixFQUFJQSxFQUN4QjdJLEVBQUl5RSxPQUFPZ0YsU0FBU1gsRUFBSUEsRUFDakI5SSxFQUdYLFFBQVNlLEdBQWNmLEVBQUs0SSxFQUFHQyxFQUFHQyxHQUk5QixNQUhLL0ssR0FBRStOLFVBQVdsRCxJQUFhLE9BQU5BLElBQWU1SSxFQUFJaUUsU0FBVSxHQUFNMkUsR0FDdkQ3SyxFQUFFK04sVUFBV2pELElBQWEsT0FBTkEsSUFBZTdJLEVBQUlpRSxTQUFVLEdBQU00RSxHQUN2RDlLLEVBQUUrTixVQUFXaEQsSUFBYSxPQUFOQSxJQUFlOUksRUFBSWlFLFNBQVUsR0FBTTZFLEdBQ3JEOUksRUEzWlgsR0FBSUosR0FBVTdCLEVBQUVnTyxpQkFBa0J6SCxFQUNBRSxFQUNBb0IsRUFDQTRCLEVBQ0FSLEVBRUFjLEVBQ0E2QixFQUNBTixFQUNBa0MsRUF1WmxDLFFBQ0k3TCxRQUFTQSxFQUNURSxRQUFTQSxFQUNUbUIsWUFBYUEsTURsYmpCaUwsUUFBVSxXQUNWLE9BQ0kzTixNQUFPTixFQUFFNEYsS0FBcUMsV0FBL0JyRCxTQUFTSixTQUFTK0wsU0FBd0IsU0FBVyxRQUNyRDNMLFNBQVNKLFNBQVNnTSxLQUNsQixPQUluQkMsUUFBVXBPLEVBQUVnTyxpQkFBa0JsTyxvQkFDQW9CLGFBQ0FHLGVBQ0FnRCxxQkFFbEN6RCxHQUFHLFdBQ0N3TixRQUFTSCxXQUNSak0sUUFBUyxTQUFXakMsR0FDakJlLE9BQVEsS0FBTSxrQkFDZG9CLE9BQU9uQyxJQUFNQSIsImZpbGUiOiJhbGwuanMiLCJzb3VyY2VzQ29udGVudCI6W251bGwsIi8qIGpzaGludCBlc25leHQ6IHRydWUgKi9cblxuLy8gTWFpbi5qc1xuLy8gPT09PT09PVxuLy8gRW50cnkgcG9pbnQgb2YgdGhlIGFwcGxpY2F0aW9uLlxuXG4vLyBNYWtlICYgSW5pdFxuLy8gPT09PT09PT09PT1cblxudmFyIG1ha2VBcHAgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgd3NVcmw6IFcuam9pbiggZG9jdW1lbnQubG9jYXRpb24ucHJvdG9jb2wgPT09ICdodHRwczonID8gJ3dzczovLycgOiAnd3M6Ly8nLFxuICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5sb2NhdGlvbi5ob3N0LCAvL2RvY3VtZW50LicvLy8nLy8nd3NzOi8vMTkyLjE2OC4wLjc6NzA4MCdcbiAgICAgICAgICAgICAgICAgICAgICAgJy8nIClcbiAgICB9O1xufTtcblxudmFyIGluaXRBcHAgPSBXLmNvbXBvc2VQcm9taXNlcnMoIG1ha2VXZWJTb2NrZXRDbGllbnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkUHVudGVyQ2lkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ha2VQdW50ZXJWaXpzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ha2VSZXN0UmFkaW9CdXR0b25zICk7XG5cbiQoIGZ1bmN0aW9uICgpIHtcbiAgICBpbml0QXBwKCBtYWtlQXBwKCkgKVxuICAgIC5zdWNjZXNzKCBmdW5jdGlvbiAoIGFwcCApIHtcbiAgICAgICAgcmVwb3J0KCAnT0snLCAnVGhlV29ya2Vycy5uZXQnICk7XG4gICAgICAgIHdpbmRvdy5hcHAgPSBhcHA7XG4gICAgfSk7XG59KTtcblxuLy8gUHJvbWlzZXJzXG4vLyA9PT09PT09PT1cblxuZnVuY3Rpb24gbWFrZVdlYlNvY2tldENsaWVudCAoIGFwcCApIHtcbiAgICByZXR1cm4gVy5wcm9taXNlKCBmdW5jdGlvbiAoIHJlc29sdmUsIHJlamVjdCApIHtcbiAgICAgICAgY29uc29sZS5sb2coICdDb25uZWN0aW5nIHRvIHdlYnNvY2tldCBjbGllbnQ6JywgYXBwLndzVXJsICk7XG4gICAgICAgIFxuICAgICAgICBhcHAud3NDbGllbnQgPSBuZXcgVy5KU09OU29ja2V0Q29ubmVjdGlvbih7XG4gICAgICAgICAgICBzb2NrZXRVcmw6IGFwcC53c1VybFxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIHZhciByZXNvbHZlT25GaXJzdENvbm5lY3QgPSBvbmNlKCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkKCAnW2RhdGEtZGlzY29ubmVjdGVkLXdhcm5pbmddJyApLnJlbW92ZSgpO1xuICAgICAgICAgICAgcmVwb3J0KCAnQ09OTkVDVEVEJywgJ3RvOicsIGFwcC53c1VybCApO1xuICAgICAgICAgICAgcmVzb2x2ZSggYXBwICk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGFwcC53c0NsaWVudC5vbiggJ29wZW4nLCByZXNvbHZlT25GaXJzdENvbm5lY3QgKTtcbiAgICAgICAgYXBwLndzQ2xpZW50Lm9uKCAnZXJyb3InLCBtYWtlUmVwb3J0ZXIoICdXZWIgU29ja2V0IEVycm9yJyApICk7XG4gICAgICAgIGFwcC53c0NsaWVudC5vbiggJ2Nsb3NlJywgbWFrZVJlcG9ydGVyKCAnV2ViIFNvY2tldCBDbG9zZScgKSApO1xuICAgICAgICBhcHAud3NDbGllbnQub3BlblNvY2tldENvbm5lY3Rpb24oKTtcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gYWRkUHVudGVyQ2lkICggYXBwICkge1xuICAgIHJldHVybiBXLnByb21pc2UoIGZ1bmN0aW9uICggcmVzb2x2ZSwgcmVqZWN0ICkge1xuICAgICAgICBhcHAucHVudGVyQ2lkID0gJCggJ1tkYXRhLXB1bnRlci1jaWRdJyApLmRhdGEoICdwdW50ZXJDaWQnICk7XG4gICAgICAgIHJlc29sdmUoIGFwcCApO1xuICAgIH0pO1xufVxuXG4vLyBQdW50ZXIgVml6XG4vLyAtLS0tLS0tLS0tXG5cbmZ1bmN0aW9uIG1ha2VQdW50ZXJWaXpzICggYXBwICkge1xuICAgIHJldHVybiBXLnByb21pc2UoIGZ1bmN0aW9uICggcmVzb2x2ZSwgcmVqZWN0ICkge1xuICAgICAgICAkKCBcIltkYXRhLXB1bnRlci12aXpdXCIgKVxuICAgICAgICAgICAgLnRvQXJyYXkoKVxuICAgICAgICAgICAgLm1hcCggZnVuY3Rpb24gKCBlbCApIHtcbiAgICAgICAgICAgICAgICAvLyBNYWtlIHRoZSBwdW50ZXIgYXBwbGljYXRpb25cbiAgICAgICAgICAgICAgICBhcHAucHVudGVyVml6ID0gUHVudGVyVml6Lm1ha2VWaXooKTtcbiAgICAgICAgICAgICAgICAvLyBBZGQgb3V0IGRvbSBlbGVtZW50XG4gICAgICAgICAgICAgICAgYXBwLnB1bnRlclZpei5jb250YWluZXJFbCA9IGVsO1xuICAgICAgICAgICAgICAgIC8vIFdlYlNvY2tldHNcbiAgICAgICAgICAgICAgICBhcHAucHVudGVyVml6LndzQ2xpZW50ID0gYXBwLndzQ2xpZW50O1xuXG4gICAgICAgICAgICAgICAgLy8gSW5pdGFpbGlzZSBpdFxuXG4gICAgICAgICAgICAgICAgdmFyIEZPUldBUkRTX0hJR0ggPSBbIFsgJy8nIF0gXTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBQdW50ZXJWaXpcbiAgICAgICAgICAgICAgICAgICAgLmluaXRWaXooIGFwcC5wdW50ZXJWaXogKVxuICAgICAgICAgICAgICAgICAgICAuZXJyb3IoIGZ1bmN0aW9uICggZXJyICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvciggJ0ZhaWxlZCB0byBjcmVhdGUgUHVudGVyIGFwcCcsIGVyciApO1xuICAgICAgICAgICAgICAgICAgICB9KSBcbiAgICAgICAgICAgICAgICAgICAgLnN1Y2Nlc3MoIGZ1bmN0aW9uICggdml6ICkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBEZXZpY2UgUm90YXRpb25cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vID09PT09PT09PT09PT09PVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBOb24tTW9iaWxlIC8gRGVidWdcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCB3aW5kb3cubG9jYXRpb24uc2VhcmNoLmluZGV4T2YoICdkZWJ1ZycpID4gLTEgKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBNYWtlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJhbmdlRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnaW5wdXQnICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFuZ2VFbC5zZXRBdHRyaWJ1dGUoICd0eXBlJywgJ3JhbmdlJyApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhbmdlRWwuc2V0QXR0cmlidXRlKCAnbWluJywgLTEgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByYW5nZUVsLnNldEF0dHJpYnV0ZSggJ21heCcsIDEgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByYW5nZUVsLnNldEF0dHJpYnV0ZSggJ3N0ZXAnLCAwLjAxICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFuZ2VFbC5zZXRBdHRyaWJ1dGUoICd2YWx1ZScsIDAuMjUgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByYW5nZUVsLnNldEF0dHJpYnV0ZSggJ3N0eWxlJywgJ3Bvc2l0aW9uOiBhYnNvbHV0ZScgKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoIHJhbmdlRWwgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXNFdmVudFN0cmVhbSggJ2NoYW5nZScgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAubWFwKCBldmVudCA9PiBldmVudC5jdXJyZW50VGFyZ2V0IClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLm1hcCggZWwgPT4gJCggZWwgKS52YWwoKSApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5vblZhbHVlKCB2ID0+IFB1bnRlclZpei5zZXRWZWxvY2l0eSggdml6LCBudWxsLCB2LCBudWxsICkgKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoICcjcHVudGVyJyApLnByZXBlbmQoIHJhbmdlRWwgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gTW9iaWxlXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLS1cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciByb3RhdGlvblN0ZXAgPSAyNS43MTQyODU3MTQ7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFkZCB0aGUgcm90YXRpb24gY29udHJvbHNcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGdhbW1hIHJpZ2h0IDkwLCBsZWZ0IC05MFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9yaWVudGF0aW9uU3RyZWFtID0gICQoIHdpbmRvdyApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hc0V2ZW50U3RyZWFtKCAnZGV2aWNlb3JpZW50YXRpb24nIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLm1hcCggZSA9PiBbIGUub3JpZ2luYWxFdmVudC5nYW1tYSwgZS5vcmlnaW5hbEV2ZW50LmFscGhhLCBlLm9yaWdpbmFsRXZlbnQuYmV0YSBdICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnYW1tYVN0cmVhbSA9IG9yaWVudGF0aW9uU3RyZWFtXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLm1hcCggYXJyID0+IGFyclsgMCBdICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIG9yaWVudGF0aW9uU3RyZWFtXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRocm90dGxlKCAxMDAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5vblZhbHVlKCBhcnIgPT4gUHVudGVyVml6LnNldFZlbG9jaXR5KCB2aXosIG51bGwsIFcubWFwKCBhcnJbMF0sIC0xODAsIDE4MCwgLTEsIDEsIHRydWUgKSwgbnVsbCApICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9yaWVudGF0aW9uU3RyZWFtXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICAgLm9uVmFsdWUoIGFyciA9PiB2aXouY2FtZXJhLnJvdGF0aW9uLnogPSBhcnJbIDEgXSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFsgYmgsIGJtLCBibCwgbiwgZmwsIGZtLCBmaCBdXG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvcndhcmRzICYgQmFja3dhcmRzXG4gICAgICAgICAgICAgICAgICAgICAgICBnYW1tYVN0cmVhbVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5tYXAoIGZ1bmN0aW9uICggZyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBnIDwgLXJvdGF0aW9uU3RlcCApIHsgcmV0dXJuICdiYWNrd2FyZCc7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoIGcgPiByb3RhdGlvblN0ZXAgKSB7IHJldHVybiAnZm9yd2FyZCc7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7IHJldHVybiAnbm9uZSc7IH0gXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2tpcER1cGxpY2F0ZXMoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aHJvdHRsZSggMTAwIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAub25WYWx1ZSggZnVuY3Rpb24gKCBkaXJlY3Rpb24gKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggJ3Bob25lLScgKyBhcHAucHVudGVyQ2lkID09PSBhcHAuY29udHJvbE1vZGUgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZXN0ZXNxdWVVdGlsLnBvc3QoIGFwcC53c0NsaWVudCwgJy9tb3Rvci9yb3RhdGlvbi9kaXJlY3Rpb24vJywgZGlyZWN0aW9uICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3BlZWRcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhbW1hU3RyZWFtXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLm1hcCggZyA9PiBNYXRoLmFicyggZyApIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAubWFwKCBmdW5jdGlvbiAoIGcgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggZyA+IDkwIC0gcm90YXRpb25TdGVwICkgeyByZXR1cm4gJ2hpZ2gnOyB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKCBnID4gOTAgLSAoIHJvdGF0aW9uU3RlcCAqIDIgKSApIHsgcmV0dXJuICdtZWRpdW0nOyB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgeyByZXR1cm4gJ2xvdyc7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aHJvdHRsZSggMTAwIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAub25WYWx1ZSggZnVuY3Rpb24gKCBzcGVlZCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAncGhvbmUtJyArIGFwcC5wdW50ZXJDaWQgPT09IGFwcC5jb250cm9sTW9kZSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlc3Rlc3F1ZVV0aWwucG9zdCggYXBwLndzQ2xpZW50LCAnL21vdG9yL3JvdGF0aW9uL3NwZWVkLycsIHNwZWVkICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coICdQdW50ZXIgYXBwbGljYXRpb24gbWFkZScgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICByZXNvbHZlKCBhcHAgKTtcbiAgICB9KTtcbn1cblxuLy8galF1ZXJ5IE1vYmlsZSBVaSBCaW5kaW5nc1xuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5mdW5jdGlvbiBtYWtlUmVzdFJhZGlvQnV0dG9ucyAoIGFwcCApIHtcbiAgICByZXR1cm4gVy5wcm9taXNlKCBmdW5jdGlvbiAoIHJlc29sdmUsIHJlamVjdCApIHtcbiAgICAgICAgLy8gUmFkaW8gQnV0dG9uc1xuICAgICAgICAvLyA9PT09PT09PT09PT09XG4gICAgICAgICQoICdbZGF0YS1yZXN0LXR5cGU9XCJyYWRpby1wb3N0XCJdJyApXG4gICAgICAgICAgICAudG9BcnJheSgpXG4gICAgICAgICAgICAubWFwKCAkIClcbiAgICAgICAgICAgIC5tYXAoIGZ1bmN0aW9uICggJGVsICkge1xuICAgICAgICAgICAgICAgIC8vIERpc2FibGUgcmVhbCBldmVudHNcbiAgICAgICAgICAgICAgICB2YXIgJHdyYXBwZXJFbCA9ICRlbC5wYXJlbnQoKTtcbiAgICAgICAgICAgICAgICAkd3JhcHBlckVsLm9uKCAnY2xpY2sgdG91Y2hlbmQnLCBmdW5jdGlvbiAoIGUgKSB7XG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coICdzZW5kaW5nJywkZWwudmFsKCksICd0bycsICRlbC5kYXRhKCAncmVzdFVyaScgKSAgKTtcbiAgICAgICAgICAgICAgICAgICAgUmVzdGVzcXVlVXRpbC5wb3N0KCBhcHAud3NDbGllbnQsICRlbC5kYXRhKCAncmVzdFVyaScgKSwgJGVsLnZhbCgpICk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFJhZGlvIEZpZWxkIFNldHNcbiAgICAgICAgLy8gPT09PT09PT09PT09PT09PVxuICAgICAgICAkKCAnW2RhdGEtcmVzdC10eXBlPVwiZmVpbGRzZXRcIl0nIClcbiAgICAgICAgICAgIC50b0FycmF5KClcbiAgICAgICAgICAgIC5tYXAoICQgKVxuICAgICAgICAgICAgLm1hcCggZnVuY3Rpb24gKCAkZWwgKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgcmFkaW9FbHMgPSAkZWwuZmluZCggJ2lucHV0W3R5cGU9XCJyYWRpb1wiXScgKS5jaGVja2JveHJhZGlvKCk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coICAnR290IGEgZmllbGQgc2V0JywgJGVsLmRhdGEoICdyZXN0VXJpJyApICk7XG5cbiAgICAgICAgICAgICAgICBzdWJzY3JpYmVSYWRpb0ZlaWxkU2V0KCk7XG4gICAgICAgICAgICAgICAgYXBwLndzQ2xpZW50Lm9uKCAnb3BlbicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coICdTdWJzY3JpYm5pZzonLCAgJGVsLmRhdGEoICdyZXN0VXJpJyApICk7XG4gICAgICAgICAgICAgICAgICAgIHN1YnNjcmliZVJhZGlvRmVpbGRTZXQoKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHN1YnNjcmliZVJhZGlvRmVpbGRTZXQoKSB7XG4gICAgICAgICAgICAgICAgICAgIFJlc3Rlc3F1ZVV0aWwuc3Vic2NyaWJlV2l0aEluaXRpYWxHZXQoIGFwcC53c0NsaWVudCwgJGVsLmRhdGEoICdyZXN0VXJpJyApLCBmdW5jdGlvbiAoIHBhY2tldCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJhZGlvRWxzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnByb3AoICdjaGVja2VkJywgZmFsc2UgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jaGVja2JveHJhZGlvKCAncmVmcmVzaCcgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoICdpbnB1dFt2YWx1ZT1cIicrIHBhY2tldC5nZXRCb2R5KCkgKydcIl0nIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0ciggJ2NoZWNrZWQnLCAnY2hlY2tlZCcgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jaGVja2JveHJhZGlvKCAncmVmcmVzaCcgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5wYXJlbnQoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5maW5kKCAnbGFiZWwnIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoICd1aS1yYWRpby1vZmYnIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoICd1aS1yYWRpby1vbicgKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICByZXNvbHZlKCBhcHAgKTtcbiAgICB9KTtcbn1cblxuLy8gVXRpbHNcbi8vID09PT09XG5cbi8vIEZ1bmN0aW9uXG4vLyAtLS0tLS0tLVxuICAgIFxuZnVuY3Rpb24gb25jZSAoIGZuICkge1xuICAgIHZhciBoYXNUcmlnZ2VyZWQgPSBmYWxzZTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoICEgaGFzVHJpZ2dlcmVkICkge1xuICAgICAgICAgICAgZm4oKTtcbiAgICAgICAgICAgIGhhc1RyaWdnZXJlZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9O1xufVxuXG4vLyBSZXBvcnRpbmdcbi8vIC0tLS0tLS0tLVxuXG5mdW5jdGlvbiByZXBvcnQoIHN0YXR1cywgc3RyICkge1xuICAgIGNvbnNvbGUubG9nKCAnWycsIHN0YXR1cywgJ10nLCBXLnJlc3QoIFcudG9BcnJheSggYXJndW1lbnRzICkgKS5qb2luKCAnICcgKSApO1xufVxuXG5mdW5jdGlvbiBtYWtlUmVwb3J0ZXIoIHN0YXR1cywgc3RyICkge1xuICAgIHZhciByZXBvcnRBcmdzID0gYXJndW1lbnRzO1xuICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJlcG9ydC5hcHBseSggdGhpcywgcmVwb3J0QXJncyApO1xuICAgICAgICB2YXIgY2FsbGVlQXJncyA9IGFyZ3VtZW50cztcbiAgICAgICAgcmV0dXJuIFcucHJvbWlzZSggZnVuY3Rpb24gKCByZXNvbHZlLCByZWplY3QgKSB7XG4gICAgICAgICAgICByZXNvbHZlLmFwcGx5KCB0aGlzLCBjYWxsZWVBcmdzICk7XG4gICAgICAgIH0pO1xuICAgIH07XG59XG4iLCIvKiBqc2hpbnQgZXNuZXh0OiB0cnVlICovXG5cbi8vIFB1bnRlciBWaXpcbi8vID09PT09PT09PT1cbi8vIEEgdGhyZWUuanMgdmlzdWxpc2F0aW9uIHRvIGJlXG4vLyBydW4gb24gYW4gSFRDIHBob25lIGFuZCBjYXJyaWVkIGJ5XG4vLyBwdW50ZXJzIGludG8gdGhlIG1pcnJvciBib3guXG5cbnZhciBQdW50ZXJWaXogPSAoZnVuY3Rpb24gKCkge1xuXG4gICAgLy8gSW5pdCAmIG1ha2VcbiAgICAvLyA9PT09PT09PT09PVxuICAgIGZ1bmN0aW9uIG1ha2VWaXogKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY29udGFpbmVyRWw6IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdkaXYnICksXG4gICAgICAgICAgICBiYWNrcm91bmRDb2xvcjogMHg2MTYyNjQsXG4gICAgICAgICAgICB2ZWxvY2l0eTogWyAwLCAwLCAwIF0sXG4gICAgICAgICAgICBwcmVSZW5kZXJGbnM6IFtdLFxuICAgICAgICAgICAgcHJlQ3ViZUNhbVJlbmRlckZuczogW10sXG4gICAgICAgICAgICBwb3N0Q3ViZUNhbVJlbmRlckZuczogW10sXG4gICAgICAgICAgICB3c0NsaWVudDogdW5kZWZpbmVkXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgdmFyIGluaXRWaXogPSBXLmNvbXBvc2VQcm9taXNlcnMoIHN1YnNjcmliZVRvSG9zdENvbnRyb2xNb2RlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYWtlQ2FtZXJhU2NlbmVSZW5kZXJlcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFrZVdlYkNhbVRleHR1cmUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ha2VXZWJDYW1NYXRlcmlhbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFrZUN1YmVDYW0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG1ha2VXZWJDYW1Cb3hNZXNoLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYWtlV2ViQ2FtSGVkcm9uTWVzaCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFrZVN3YXJtLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYWtlTGlnaHRzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYWtlUmVuZGVyTG9vcCApO1xuXG4gICAgLy8gUHJvbWlzZXJzXG4gICAgLy8gPT09PT09PT09XG5cbiAgICAvLyBSZXN0ZXNxdWVcbiAgICAvLyAtLS0tLS0tLS1cbiAgICBmdW5jdGlvbiBzdWJzY3JpYmVUb0hvc3RDb250cm9sTW9kZSAoIHZpeiApIHtcbiAgICAgICAgcmV0dXJuIFcucHJvbWlzZSggZnVuY3Rpb24gKCByZXNvbHZlLCByZWplY3QgKSB7XG4gICAgICAgICAgICB2aXouY29udHJvbE1vZGUgPSAnJztcblxuICAgICAgICAgICAgc3Vic2NyaWJlKCk7XG4gICAgICAgICAgICB2aXoud3NDbGllbnQub24oICdvcGVuJywgc3Vic2NyaWJlICk7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHN1YnNjcmliZSAoKSB7XG4gICAgICAgICAgICAgICAgUmVzdGVzcXVlVXRpbFxuICAgICAgICAgICAgICAgICAgICAuc3Vic2NyaWJlV2l0aEluaXRpYWxHZXQoIGFwcC53c0NsaWVudCwgJy9ob3N0L2NvbnRyb2wvbW9kZS8nLCBmdW5jdGlvbiAoIHBhY2tldCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwcC5jb250cm9sTW9kZSA9IHBhY2tldC5nZXRCb2R5KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggJ0NvbnRyb2wgTW9kZSBDaGFuZ2UgdG86JywgYXBwLmNvbnRyb2xNb2RlICk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXNvbHZlKCB2aXogKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQ2FtZXJhLCBTY2VuZSwgUmVuZGVyZXJcbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGZ1bmN0aW9uIG1ha2VDYW1lcmFTY2VuZVJlbmRlcmVyICggdml6ICkge1xuICAgICAgICByZXR1cm4gVy5wcm9taXNlKCBmdW5jdGlvbiAoIHJlc29sdmUsIHJlamVjdCApIHtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gQ2FtZXJhXG4gICAgICAgICAgICAvLyAtLS0tLS1cbiAgICAgICAgICAgIHZpei5jYW1lcmEgPSBuZXcgVEhSRUUuUGVyc3BlY3RpdmVDYW1lcmEoIDcwLCB3aW5kb3cuaW5uZXJXaWR0aCAvIHdpbmRvdy5pbm5lckhlaWdodCwgMSwgMzAwMCApO1xuICAgICAgICAgICAgc2V0Q2FtZXJhUG9zaXRpb24oIHZpeiwgMCwgMCwgMjAwICk7XG5cbiAgICAgICAgICAgIC8vIFNjZW5lXG4gICAgICAgICAgICAvLyAtLS0tLVxuICAgICAgICAgICAgdml6LnNjZW5lID0gbmV3IFRIUkVFLlNjZW5lKCk7XG5cbiAgICAgICAgICAgIC8vIFJlbmRlcmVyXG4gICAgICAgICAgICAvLyAtLS0tLS0tLVxuICAgICAgICAgICAgdml6LnJlbmRlcmVyID0gbmV3IFRIUkVFLldlYkdMUmVuZGVyZXIoIHsgYW50aWFsaWFzOiBmYWxzZSB9ICk7XG4gICAgICAgICAgICB2aXoucmVuZGVyZXIuc2V0UGl4ZWxSYXRpbyggd2luZG93LmRldmljZVBpeGVsUmF0aW8gKTtcbiAgICAgICAgICAgIHZpei5yZW5kZXJlci5zZXRTaXplKCB3aW5kb3cuaW5uZXJXaWR0aCwgd2luZG93LmlubmVySGVpZ2h0ICk7XG4gICAgICAgICAgICB2aXoucmVuZGVyZXIuc2V0Q2xlYXJDb2xvciggdml6LmJhY2tncm91bmRDb2xvciApO1xuICAgICAgICAgICAgdml6LnJlbmRlcmVyLnNvcnRPYmplY3RzID0gZmFsc2U7XG5cbiAgICAgICAgICAgIHZpei5jb250YWluZXJFbC5hcHBlbmRDaGlsZCggdml6LnJlbmRlcmVyLmRvbUVsZW1lbnQgKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcmVzb2x2ZSggdml6ICk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFdlYiBDYW1cbiAgICAvLyAtLS0tLS0tXG4gICAgLy8gTWFrZSB0aGUgd2ViIGNhbSBhdmFpbGFibGUgYXMgYSB0ZXh0dXJlXG4gICAgZnVuY3Rpb24gbWFrZVdlYkNhbVRleHR1cmUgKCB2aXogKSB7XG4gICAgICAgIHJldHVybiBXLnByb21pc2UoIGZ1bmN0aW9uICggcmVzb2x2ZSwgcmVqZWN0ICkge1xuXG4gICAgICAgICAgICAvLyBXZWIgQ2FtIERPTSBFbGVtZW50XG4gICAgICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgICAgICB2YXIgd2ViQ2FtRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd2aWRlbycpO1xuICAgICAgICAgICAgd2ViQ2FtRWwuYXV0b3BsYXkgPSB0cnVlO1xuXG4gICAgICAgICAgICAvLyBXZWIgQ2FtIFN0cmVhbVxuICAgICAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgIG5hdmlnYXRvci53ZWJraXRHZXRVc2VyTWVkaWEoIHsgdmlkZW86dHJ1ZSB9LCBmdW5jdGlvbiggc3RyZWFtICl7XG4gICAgICAgICAgICAgICAgd2ViQ2FtRWwuc3JjID0gVVJMLmNyZWF0ZU9iamVjdFVSTCggc3RyZWFtICk7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbiggZXJyICl7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJGYWlsZWQgdG8gZ2V0IGEgc3RyZWFtIGR1ZSB0b1wiLCBlcnIpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIFdlYiBDYW0gVGV4dHVyZVxuICAgICAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgICAgICB2aXoud2ViQ2FtVGV4dHVyZSA9IG5ldyBUSFJFRS5UZXh0dXJlKCB3ZWJDYW1FbCApO1xuICAgICAgICAgICAgdml6LndlYkNhbVRleHR1cmUubWluRmlsdGVyID0gVEhSRUUuTGluZWFyRmlsdGVyO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBSZW5kZXIgVXBkYXRlc1xuICAgICAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgIGFkZFByZVJlbmRlckZuKCB2aXosIGZ1bmN0aW9uICggZGV0bGFNUywgdGltZXN0YW1wTVMgKSB7XG4gICAgICAgICAgICAgICAgaWYoIHdlYkNhbUVsLnJlYWR5U3RhdGUgPT09IHdlYkNhbUVsLkhBVkVfRU5PVUdIX0RBVEEgKXtcbiAgICAgICAgICAgICAgICAgICAgdml6LndlYkNhbVRleHR1cmUubmVlZHNVcGRhdGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXNvbHZlKCB2aXogKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQ3ViZSBDYW1lcmFcbiAgICAvLyAtLS0tLS0tLS0tLVxuICAgIC8vIENyZWF0ZSBhIGN1YmUgY2FtIGZvciBhIGR5bmFtaWMgZW52TWFwLlxuICAgIC8vIFRoaXMgYWxzbyBlbmFibGVzIHR3byBob29rczogYHByZUN1YmVDYW1SZW5kZXJBY3Rpb25zYCAmIGBwb3N0Q3ViZUNhbVJlbmRlckFjdGlvbnNgXG4gICAgLy8gaW4gdGhlIHZpeiBmb3IgdGhhdCBvYmplY3QzRCBpbiB0aGUgc2NlbmUgY2FuIGJlIHR1cm5lZCBvbiBhbmQgb2ZmIGR1cmluZ1xuICAgIC8vIHRoZSB3ZWJjYW1zIHJlbmRlclxuICAgIGZ1bmN0aW9uIG1ha2VDdWJlQ2FtICggdml6ICkgeyBcbiAgICAgICAgcmV0dXJuIFcucHJvbWlzZSggZnVuY3Rpb24gKCByZXNvbHZlLCByZWplY3QgKSB7XG5cbiAgICAgICAgICAgIHZpei5jdWJlQ2FtZXJhID0gbmV3IFRIUkVFLkN1YmVDYW1lcmEoMSwgMzAwMCwgMjU2KTsgLy8gbmVhciwgZmFyLCByZXNvbHV0aW9uXG4gICAgICAgICAgICB2aXouY3ViZUNhbWVyYS5yZW5kZXJUYXJnZXQubWluRmlsdGVyID0gVEhSRUUuTGluZWFyTWlwTWFwTGluZWFyRmlsdGVyOyAvLyBtaXBtYXAgZmlsdGVyXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGFkZFByZVJlbmRlckZuKCB2aXosIGZ1bmN0aW9uICggZGVsdGFNUywgdGltZXN0YW1wTVMgKSB7ICAgIFxuICAgICAgICAgICAgICAgIC8vIFJlbmRlciB0aGUgY3ViZSBjYW1lcmEgdG8gY3ViZSBtYXBcbiAgICAgICAgICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgICAgICAgICAgdml6LnByZUN1YmVDYW1SZW5kZXJGbnMuZm9yRWFjaCggZm4gPT4gZm4oIGRlbHRhTVMsIHRpbWVzdGFtcE1TICkgKTtcbiAgICAgICAgICAgICAgICB2aXouY3ViZUNhbWVyYS51cGRhdGVDdWJlTWFwKCB2aXoucmVuZGVyZXIsIHZpei5zY2VuZSApO1xuICAgICAgICAgICAgICAgIHZpei5wb3N0Q3ViZUNhbVJlbmRlckZucy5mb3JFYWNoKCBmbiA9PiBmbiggZGVsdGFNUywgdGltZXN0YW1wTVMgKSApO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHJlc29sdmUoIHZpeiApO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBXZWIgQ2FtIE1hdGVyaWFsXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLVxuICAgIGZ1bmN0aW9uIG1ha2VXZWJDYW1NYXRlcmlhbCAoIHZpeiApIHtcbiAgICAgICAgcmV0dXJuIFcucHJvbWlzZSggZnVuY3Rpb24gKCByZXNvbHZlLCByZWplY3QgKSB7XG4gICAgICAgICAgICB2aXoud2ViQ2FtTWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoe1xuICAgICAgICAgICAgICAgIG1hcDogdml6LndlYkNhbVRleHR1cmUsXG4gICAgICAgICAgICAgICAgY29sb3I6IDB4ZmZmZmZmLFxuICAgICAgICAgICAgICAgIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmVzb2x2ZSggdml6ICk7XG4gICAgICAgIH0pO1xuXG4gICAgfVxuXG4gICAgLy8gV2ViIENhbSBCb3ggTWVzaFxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBDcmVhdGVzIGEgYm94IHdpdGggdGhlIHdlYiBjYW0gZGlzcGxheWVkXG4gICAgLy8gb24gdGhlIGluc2lkZSBvZiBlYWNoIG9mIGl0J3MgNiBzaWRlc1xuICAgIGZ1bmN0aW9uIG1ha2VXZWJDYW1Cb3hNZXNoICggdml6ICkge1xuICAgICAgICByZXR1cm4gVy5wcm9taXNlKCBmdW5jdGlvbiAoIHJlc29sdmUsIHJlamVjdCApIHtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgdml6LndlYkNhbXZCb3hNZXNoID0gbmV3IFRIUkVFLk1lc2goIG5ldyBUSFJFRS5Cb3hHZW9tZXRyeSggMjAwMCwgMjAwMCwgMjAwMCApLCB2aXoud2ViQ2FtTWF0ZXJpYWwgKTtcblxuICAgICAgICAgICAgdmFyIHJvdGF0aW9uWCA9IFcucmFuZG9tQmV0d2VlbiggMC4wMDAyLCAwLjAwMDAyICk7XG4gICAgICAgICAgICB2YXIgcm90YXRpb25ZID0gVy5yYW5kb21CZXR3ZWVuKCAwLjAwMDIsIDAuMDAwMDIgKTtcbiAgICAgICAgICAgIHZhciByb3RhdGlvblogPSBXLnJhbmRvbUJldHdlZW4oIDAuMDAwMiwgMC4wMDAwMiApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBJZiB3ZSB3YW50IHRvIHJvdGF0ZSBpdFxuICAgICAgICAgICAgYWRkUHJlUmVuZGVyRm4oIHZpeiwgZnVuY3Rpb24gKCBkZWx0YU1TLCB0aW1lc3RhbXBNUyApIHtcbiAgICAgICAgICAgICAgICB2aXoud2ViQ2FtdkJveE1lc2gucm90YXRpb24ueCArPSAoIGRlbHRhTVMgKiByb3RhdGlvblggKTtcbiAgICAgICAgICAgICAgICB2aXoud2ViQ2FtdkJveE1lc2gucm90YXRpb24ueSArPSAoIGRlbHRhTVMgKiByb3RhdGlvblkgKTtcbiAgICAgICAgICAgICAgICB2aXoud2ViQ2FtdkJveE1lc2gucm90YXRpb24ueiArPSAoIGRlbHRhTVMgKiByb3RhdGlvblogKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICB2aXouc2NlbmUuYWRkKCB2aXoud2ViQ2FtdkJveE1lc2ggKTtcblxuICAgICAgICAgICAgLy8gU2hvdyBpdCBvbmx5IGZvciB0aGUgY3ViZSBjYW1cbiAgICAgICAgICAgIHZpei5wcmVDdWJlQ2FtUmVuZGVyRm5zLnB1c2goIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2aXoud2ViQ2FtdkJveE1lc2gudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdml6LnBvc3RDdWJlQ2FtUmVuZGVyRm5zLnB1c2goIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2aXoud2ViQ2FtdkJveE1lc2gudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmVzb2x2ZSggdml6ICk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFdlYiBDYW0gSGVkcm9uIE1lc2hcbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgZnVuY3Rpb24gbWFrZVdlYkNhbUhlZHJvbk1lc2ggKCB2aXogKSB7XG4gICAgICAgIHJldHVybiBXLnByb21pc2UoIGZ1bmN0aW9uICggcmVzb2x2ZSwgcmVqZWN0ICkge1xuXG4gICAgICAgICAgICAvLyBMb2FkZXJcbiAgICAgICAgICAgIC8vIC0tLS0tLVxuICAgICAgICAgICAgdmFyIGxvYWRlciA9IG5ldyBUSFJFRS5PQkpMb2FkZXIoKTtcbiAgICAgICAgICAgIGxvYWRlci5sb2FkKCAnL29iai9oZWRyb24ub2JqJywgb25PYmpMb2FkZWQgKTtcblxuICAgICAgICAgICAgLy8gU3dhcm0gQ3JlYXRpb25cbiAgICAgICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgIGZ1bmN0aW9uIG9uT2JqTG9hZGVkICggb2JqICkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCBvYmouY2hpbGRyZW5bIDAgXSApO1xuICAgICAgICAgICAgICAgIHZpei53ZWJDYW1IZWRyb25NZXNoID0gb2JqLmNoaWxkcmVuWyAwIF0uY2xvbmUoKTsgLy9uZXcgVEhSRUUuTWVzaCggbmV3IFRIUkVFLkJveEdlb21ldHJ5KCAyMDAwLCAyMDAwLCAyMDAwICksIG1hdGVyaWFsICk7XG4gICAgICAgICAgICAgICAgdml6LndlYkNhbUhlZHJvbk1lc2gubWF0ZXJpYWwgPSB2aXoud2ViQ2FtTWF0ZXJpYWwuY2xvbmUoKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB2YXIgc2NhbGUgPSAyODAwO1xuICAgICAgICAgICAgICAgIHZpei53ZWJDYW1IZWRyb25NZXNoLnNjYWxlLnNldCggc2NhbGUsIHNjYWxlLCBzY2FsZSApO1xuXG4gICAgICAgICAgICAgICAgdmFyIHJvdGF0aW9uWCA9IFcucmFuZG9tQmV0d2VlbiggMC4wMDAyLCAwLjAwMDAyICk7XG4gICAgICAgICAgICAgICAgdmFyIHJvdGF0aW9uWSA9IFcucmFuZG9tQmV0d2VlbiggMC4wMDAyLCAwLjAwMDAyICk7XG4gICAgICAgICAgICAgICAgdmFyIHJvdGF0aW9uWiA9IFcucmFuZG9tQmV0d2VlbiggMC4wMDAyLCAwLjAwMDAyICk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8gSWYgd2Ugd2FudCB0byByb3RhdGUgaXRcbiAgICAgICAgICAgICAgICBhZGRQcmVSZW5kZXJGbiggdml6LCBmdW5jdGlvbiAoIGRlbHRhTVMsIHRpbWVzdGFtcE1TICkge1xuICAgICAgICAgICAgICAgICAgICB2aXoud2ViQ2FtSGVkcm9uTWVzaC5yb3RhdGlvbi54ICs9ICggZGVsdGFNUyAqIHJvdGF0aW9uWCApO1xuICAgICAgICAgICAgICAgICAgICB2aXoud2ViQ2FtSGVkcm9uTWVzaC5yb3RhdGlvbi55ICs9ICggZGVsdGFNUyAqIHJvdGF0aW9uWSApO1xuICAgICAgICAgICAgICAgICAgICB2aXoud2ViQ2FtSGVkcm9uTWVzaC5yb3RhdGlvbi56ICs9ICggZGVsdGFNUyAqIHJvdGF0aW9uWiApO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHZpei5zY2VuZS5hZGQoIHZpei53ZWJDYW1IZWRyb25NZXNoICk7XG5cbiAgICAgICAgICAgICAgICAvLyBTaG93IGl0IG9ubHkgZm9yIHRoZSBjdWJlIGNhbVxuICAgICAgICAgICAgICAgIHZpei5wcmVDdWJlQ2FtUmVuZGVyRm5zLnB1c2goIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdml6LndlYkNhbUhlZHJvbk1lc2gudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHZpei53ZWJDYW1IZWRyb25NZXNoLm1hdGVyaWFsLmNvbG9yLnNldCggMHhmZmZmZmYgKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHZpei5wb3N0Q3ViZUNhbVJlbmRlckZucy5wdXNoKCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHZpei53ZWJDYW1IZWRyb25NZXNoLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB2aXoud2ViQ2FtSGVkcm9uTWVzaC5tYXRlcmlhbC5jb2xvci5zZXQoIDB4NmQ2ODQxICk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICByZXNvbHZlKCB2aXogKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBMaWdodHNcbiAgICAvLyAtLS0tLS1cbiAgICBmdW5jdGlvbiBtYWtlTGlnaHRzICggdml6ICkge1xuICAgICAgICByZXR1cm4gVy5wcm9taXNlKCBmdW5jdGlvbiAoIHJlc29sdmUsIHJlamVjdCApIHtcbiAgICAgICAgICAgIHZpei5zY2VuZS5hZGQoIG5ldyBUSFJFRS5BbWJpZW50TGlnaHQoIDB4MjIyMjIyICkgKTtcblxuICAgICAgICAgICAgdmFyIGRpcmVjdGlvbmFsTGlnaHQgPSBuZXcgVEhSRUUuRGlyZWN0aW9uYWxMaWdodCggMHhmZmZmZmYsIDIgKTtcbiAgICAgICAgICAgIGRpcmVjdGlvbmFsTGlnaHQucG9zaXRpb24uc2V0KCAyLCAxLjIsIDEwICkubm9ybWFsaXplKCk7XG4gICAgICAgICAgICB2aXouc2NlbmUuYWRkKCBkaXJlY3Rpb25hbExpZ2h0ICk7XG5cbiAgICAgICAgICAgIGRpcmVjdGlvbmFsTGlnaHQgPSBuZXcgVEhSRUUuRGlyZWN0aW9uYWxMaWdodCggMHhmZmZmZmYsIDEgKTtcbiAgICAgICAgICAgIGRpcmVjdGlvbmFsTGlnaHQucG9zaXRpb24uc2V0KCAtMiwgMS4yLCAtMTAgKS5ub3JtYWxpemUoKTtcbiAgICAgICAgICAgIHZpei5zY2VuZS5hZGQoIGRpcmVjdGlvbmFsTGlnaHQgKTsgIFxuICAgICAgICAgICAgcmVzb2x2ZSggdml6ICk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFN3YXJtXG4gICAgLy8gLS0tLS1cbiAgICBmdW5jdGlvbiBtYWtlU3dhcm0gKCB2aXogKSB7XG4gICAgICAgIHJldHVybiBXLnByb21pc2UoIGZ1bmN0aW9uICggcmVzb2x2ZSwgcmVqZWN0ICkge1xuICAgICAgICAgICAgXG4gICAgICAgICAgICB2YXIgcGFydGljbGVzID0gW107XG5cbiAgICAgICAgICAgIC8vIEFkZCB0byBTY2VuZVxuICAgICAgICAgICAgLy8gLS0tLS0tLS0tLS0tXG4gICAgICAgICAgICB2aXouc3dhcm1PYmplY3QzRCA9IG5ldyBUSFJFRS5PYmplY3QzRCgpO1xuICAgICAgICAgICAgdml6LnNjZW5lLmFkZCggdml6LnN3YXJtT2JqZWN0M0QgKTtcbiAgICAgICAgICAgIHZpei5wcmVDdWJlQ2FtUmVuZGVyRm5zLnB1c2goIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2aXouc3dhcm1PYmplY3QzRC52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHZpei5wb3N0Q3ViZUNhbVJlbmRlckZucy5wdXNoKCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdml6LnN3YXJtT2JqZWN0M0QudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gVXBkYXRpbmdcbiAgICAgICAgICAgIGFkZFByZVJlbmRlckZuKCB2aXosIGZ1bmN0aW9uICggZGVsdGFNUywgdGltZXN0YW1wTVMgKSB7XG4gICAgICAgICAgICAgICAgcGFydGljbGVzLmZvckVhY2goIHBhcnRpY2xlID0+IHBhcnRpY2xlLnVwZGF0ZSggZGVsdGFNUywgdGltZXN0YW1wTVMgKSApO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIFBhcnRpY2xlIENsYXNzXG4gICAgICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLVxuICAgICAgICAgICAgZnVuY3Rpb24gUGFydGljbGUgKCBtZXNoICkge1xuXG4gICAgICAgICAgICAgICAgLy8gIyMjIFBvc2l0aW9uaW5nXG4gICAgICAgICAgICAgICAgdGhpcy5wb3NpdGlvblNjYWxhciA9IFcuaW50ZXJwb2xhdGlvbnMuY3ViaWNFYXNlT3V0KCBNYXRoLnJhbmRvbSgpICk7XG4gICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB2YXIgc2NhbGUgPSBQYXJ0aWNsZS5pbml0aWFsU2NhbGUgKiBXLm1hcCggdGhpcy5wb3NpdGlvblNjYWxhciwgMCwgMSwgMC40LCAxICk7XG5cbiAgICAgICAgICAgICAgICAvLyBNZXNoXG4gICAgICAgICAgICAgICAgdGhpcy5tZXNoID0gbWVzaC5jbG9uZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuYW5jaG9yID0gbmV3IFRIUkVFLk9iamVjdDNEKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5hbmNob3IuYWRkKCB0aGlzLm1lc2ggKTtcbiAgICAgICAgICAgICAgICB0aGlzLm1lc2gubWF0ZXJpYWwgPSBQYXJ0aWNsZS5tYXRlcmlhbC5jbG9uZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMubWVzaC5zY2FsZS54ID0gc2NhbGU7XG4gICAgICAgICAgICAgICAgdGhpcy5tZXNoLnNjYWxlLnkgPSBzY2FsZTtcbiAgICAgICAgICAgICAgICB0aGlzLm1lc2guc2NhbGUueiA9IHNjYWxlO1xuXG4gICAgICAgICAgICAgICAgdmFyIHJhbmdlTWF4WCA9IDYwO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5tZXNoLnBvc2l0aW9uLnNldCggcmFuZ2VNYXhYICogKDEgLSB0aGlzLnBvc2l0aW9uU2NhbGFyKSwgVy5yYW5kb21CZXR3ZWVuKCAtNTAsIDUwICksIDAgKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvL3RoaXMubWVzaC5wb3NpdGlvbi5zZXQoIHJhbmdlTWF4ICogcG9zaXRpb25TY2FsYXIsIDAsIDAgKTtcblxuICAgICAgICAgICAgICAgIHRoaXMubWVzaC5yb3RhdGlvbi54ID0gVy5yYW5kb21CZXR3ZWVuKCAtMTgwLCAxODAgKTtcbiAgICAgICAgICAgICAgICB0aGlzLm1lc2gucm90YXRpb24ueSA9IFcucmFuZG9tQmV0d2VlbiggLTE4MCwgMTgwICk7XG4gICAgICAgICAgICAgICAgdGhpcy5tZXNoLnJvdGF0aW9uLnogPSBXLnJhbmRvbUJldHdlZW4oIC0xODAsIDE4MCApO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5hbmNob3Iucm90YXRpb24ueSArPSAgVy5yYW5kb21CZXR3ZWVuKCAtMTgwLCAxODAgKTtcblxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIHZhciByYW5nZSA9IDEwMDtcbiAgICAgICAgICAgICAgICAvLyB0aGlzLm1lc2gucG9zaXRpb24uc2V0KCAoIE1hdGgucmFuZG9tKCkgLSAwLjUgKSAqIHJhbmdlLCAoIE1hdGgucmFuZG9tKCkgLSAwLjUgKSAqIHJhbmdlLCAoIE1hdGgucmFuZG9tKCkgLSAwLjUgKSAqIHJhbmdlICk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vICMjIyBTdGF0aWNcbiAgICAgICAgICAgIFBhcnRpY2xlLm1hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hQaG9uZ01hdGVyaWFsKCB7XG4gICAgICAgICAgICAgICAgY29sb3I6IDB4ZmZmZmZmLFxuICAgICAgICAgICAgICAgIHNoaW5pbmVzczogMC4wLFxuICAgICAgICAgICAgICAgIHNwZWN1bGFyOiAweGZmZmZmZixcbiAgICAgICAgICAgICAgICBlbnZNYXA6IHZpei5jdWJlQ2FtZXJhLnJlbmRlclRhcmdldCxcbiAgICAgICAgICAgICAgICByZWZsZWN0aXZpdHk6IDEuMCxcbiAgICAgICAgICAgICAgICBzaWRlOiBUSFJFRS5Eb3VibGVTaWRlXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgUGFydGljbGUuaW5pdGlhbFNjYWxlID0gMzAwO1xuXG4gICAgICAgICAgICAvLyAjIyMgTWV0aG9kXG4gICAgICAgICAgICBQYXJ0aWNsZS5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKCBkZWx0YU1TLCB0aW1lc3RhbXBNUyApIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFuY2hvci5yb3RhdGlvbi54ICs9IHZpei52ZWxvY2l0eVsgMCBdICogKCAxIC0gdGhpcy5wb3NpdGlvblNjYWxhciApICogMC40O1xuICAgICAgICAgICAgICAgIHRoaXMuYW5jaG9yLnJvdGF0aW9uLnkgKz0gdml6LnZlbG9jaXR5WyAxIF0gKiAoIDEgLSB0aGlzLnBvc2l0aW9uU2NhbGFyICkgKiAwLjQ7XG4gICAgICAgICAgICAgICAgdGhpcy5hbmNob3Iucm90YXRpb24ueiArPSB2aXoudmVsb2NpdHlbIDIgXSAqICggMSAtIHRoaXMucG9zaXRpb25TY2FsYXIgKSAqIDAuNDtcbiAgICAgICAgICAgICAgICB0aGlzLm1lc2gucm90YXRpb24ueCArPSAwLjAwMjtcbiAgICAgICAgICAgICAgICB0aGlzLm1lc2gucm90YXRpb24ueSArPSAwLjAwMTtcbiAgICAgICAgICAgICAgICB0aGlzLm1lc2gucm90YXRpb24ueiArPSAwLjAwMztcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vIExvYWRlclxuICAgICAgICAgICAgLy8gLS0tLS0tXG4gICAgICAgICAgICB2YXIgbG9hZGVyID0gbmV3IFRIUkVFLk9CSkxvYWRlcigpO1xuICAgICAgICAgICAgbG9hZGVyLmxvYWQoICcvb2JqL3BpbGxvdy1ib3gub2JqJywgb25PYmpMb2FkZWQgKTtcblxuICAgICAgICAgICAgLy8gU3dhcm0gQ3JlYXRpb25cbiAgICAgICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgIGZ1bmN0aW9uIG9uT2JqTG9hZGVkICggb2JqICkge1xuXG4gICAgICAgICAgICAgICAgdmFyIG1lc2ggPSBvYmouY2hpbGRyZW5bIDAgXTtcblxuICAgICAgICAgICAgICAgIC8vIFBhcnRpY2xlIENyZWF0aW9uXG4gICAgICAgICAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgICAgICAvLyBFYXNlIGluIHRoZSBjcmVhdGlvbiBvZiB0aGUgcGFydGljbGVzXG4gICAgICAgICAgICAgICAgdmFyIG1heFBhcnRpY2xlcyA9IDEwMDtcbiAgICAgICAgICAgICAgICB2YXIgbWluQ3JlYXRpb25UaW1lID0gNTtcbiAgICAgICAgICAgICAgICB2YXIgbWF4Q3JlYXRpb25UaW1lTVMgPSAyMDtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAoZnVuY3Rpb24gY3JlYXRlTW9yZSAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICggcGFydGljbGVzLmxlbmd0aCA8IG1heFBhcnRpY2xlcyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXJ0aWNsZSA9IG5ldyBQYXJ0aWNsZSggbWVzaCApO1xuICAgICAgICAgICAgICAgICAgICAgICAgdml6LnN3YXJtT2JqZWN0M0QuYWRkKCBwYXJ0aWNsZS5hbmNob3IgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRpY2xlcy5wdXNoKCBwYXJ0aWNsZSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCggY3JlYXRlTW9yZSwgVy5tYXAoIHBhcnRpY2xlcy5sZW5ndGggLyBtYXhQYXJ0aWNsZXMsIDAsIDEsIG1heENyZWF0aW9uVGltZU1TLCBtaW5DcmVhdGlvblRpbWUsIFcuaW50ZXJwb2xhdGlvbnMuZWFzZUluICkgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0oKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHJlc29sdmUoIHZpeiApO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBSZW5kZXIgTG9vcFxuICAgIC8vIC0tLS0tLS0tLS0tXG4gICAgZnVuY3Rpb24gbWFrZVJlbmRlckxvb3AgKCB2aXogKSB7XG4gICAgICAgIHJldHVybiBXLnByb21pc2UoIGZ1bmN0aW9uICggcmVzb2x2ZSwgcmVqZWN0ICkge1xuXG4gICAgICAgICAgICB2YXIgbGFzdFRpbWVzdGFtcE1TID0gMDtcbiAgICAgICAgICAgIHZhciBkZWx0YU1TID0gMDtcblxuICAgICAgICAgICAgKGZ1bmN0aW9uICBsb29wICggY3VycmVudFRpbWVzdGFtcE1TICkge1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIFJlY3VyXG4gICAgICAgICAgICAgICAgLy8gLS0tLS1cbiAgICAgICAgICAgICAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKCBsb29wICk7XG5cbiAgICAgICAgICAgICAgICAvLyBVcGRhdGUgdGltZXN0YW1wc1xuICAgICAgICAgICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAgICAgICAgIGRlbHRhTVMgPSBjdXJyZW50VGltZXN0YW1wTVMgLSBsYXN0VGltZXN0YW1wTVM7XG4gICAgICAgICAgICAgICAgbGFzdFRpbWVzdGFtcE1TID0gY3VycmVudFRpbWVzdGFtcE1TO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIEFjdGlvbmFibGVzXG4gICAgICAgICAgICAgICAgLy8gLS0tLS0tLS0tLS1cbiAgICAgICAgICAgICAgICB2aXoucHJlUmVuZGVyRm5zLmZvckVhY2goIGZuID0+IGZuKCBkZWx0YU1TLCBjdXJyZW50VGltZXN0YW1wTVMgKSApO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIFJlbmRlclxuICAgICAgICAgICAgICAgIC8vIC0tLS0tLVxuICAgICAgICAgICAgICAgIHZpei5yZW5kZXJlci5jbGVhcigpO1xuICAgICAgICAgICAgICAgIHZpei5yZW5kZXJlci5yZW5kZXIoIHZpei5zY2VuZSwgdml6LmNhbWVyYSApO1xuXG4gICAgICAgICAgICB9KCBsYXN0VGltZXN0YW1wTVMgKSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHJlc29sdmUoIHZpeiApO1xuICAgICAgICB9KTtcblxuICAgIH1cblxuICAgIC8vIFV0aWxzXG4gICAgLy8gPT09PT1cblxuICAgIC8vIFJlbmRlciBMb29wXG4gICAgLy8gLS0tLS0tLS0tLS1cbiAgICBmdW5jdGlvbiBhZGRQcmVSZW5kZXJGbiAoIHZpeiwgZm4gKSB7XG4gICAgICAgIHZpei5wcmVSZW5kZXJGbnMucHVzaCggZm4gKTtcbiAgICAgICAgcmV0dXJuIHZpejtcbiAgICB9XG5cbiAgICAvLyBDYW1lcmFcbiAgICAvLyAtLS0tLS1cbiAgICBmdW5jdGlvbiBzZXRDYW1lcmFQb3NpdGlvbiAoIHZpeiwgeCwgeSwgeiApIHtcbiAgICAgICAgdml6LmNhbWVyYS5wb3NpdGlvbi54ID0geDtcbiAgICAgICAgdml6LmNhbWVyYS5wb3NpdGlvbi55ID0geTtcbiAgICAgICAgdml6LmNhbWVyYS5wb3NpdGlvbi56ID0gejtcbiAgICAgICAgcmV0dXJuIHZpejtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzZXRWZWxvY2l0eSAoIHZpeiwgeCwgeSwgeiApIHtcbiAgICAgICAgaWYgKCBXLmlzRGVmaW5lZCggeCApICYmIHggIT09IG51bGwgKSB7IHZpei52ZWxvY2l0eVsgMCBdID0geDsgfVxuICAgICAgICBpZiAoIFcuaXNEZWZpbmVkKCB5ICkgJiYgeSAhPT0gbnVsbCApIHsgdml6LnZlbG9jaXR5WyAxIF0gPSB5OyB9XG4gICAgICAgIGlmICggVy5pc0RlZmluZWQoIHogKSAmJiB6ICE9PSBudWxsICkgeyB2aXoudmVsb2NpdHlbIDIgXSA9IHo7IH1cbiAgICAgICAgcmV0dXJuIHZpejtcbiAgICB9XG4gICAgXG4gICAgLy8gRXhwb3J0XG4gICAgLy8gPT09PT09ICAgIFxuICAgIHJldHVybiB7XG4gICAgICAgIG1ha2VWaXo6IG1ha2VWaXosXG4gICAgICAgIGluaXRWaXo6IGluaXRWaXosXG4gICAgICAgIHNldFZlbG9jaXR5OiBzZXRWZWxvY2l0eVxuICAgIH07XG4gICAgXG59KCkpO1xuXG5cblxuXG5cblxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9