"use strict";function makeWebSocketClient(e){return W.promise(function(n,t){console.log("Connecting to websocket client:",e.wsUrl),e.wsClient=new W.JSONSocketConnection({socketUrl:e.wsUrl});var r=once(function(){$("[data-disconnected-warning]").remove(),report("CONNECTED","to:",e.wsUrl),n(e)});e.wsClient.on("open",r),e.wsClient.on("error",makeReporter("Web Socket Error")),e.wsClient.on("close",makeReporter("Web Socket Close")),e.wsClient.openSocketConnection()})}function subscribeToHostControlMode(e){return W.promise(function(n,t){e.controlMode="",RestesqueUtil.subscribeWithInitialGet(e.wsClient,"/host/control/mode/",function(n){e.controlMode=n.getBody(),console.log("Control Mode Change to:",e.controlMode)}).success(function(){n(e)})})}function addPunterCid(e){return W.promise(function(n,t){e.punterCid=$("[data-punter-cid]").data("punterCid"),n(e)})}function makePunterVizs(e){return W.promise(function(n,t){$("[data-punter-viz]").toArray().map(function(n){e.punterViz=PunterViz.makeApp(),e.punterViz.containerEl=n;PunterViz.initApp(e.punterViz).error(function(e){console.error("Failed to create Punter app",e)}).success(function(n){console.log("Punter application made");var t=25.714285714,r=$(window).asEventStream("deviceorientation").map(function(e){return e.originalEvent.gamma});r.map(function(e){return-t>e?"backward":e>t?"forward":"none"}).skipDuplicates().throttle(100).onValue(function(n){"phone-"+e.punterCid===e.controlMode&&RestesqueUtil.post(e.wsClient,"/motor/rotation/direction/",n)}),r.map(function(e){return Math.abs(e)}).map(function(e){return e>90-t?"high":e>90-2*t?"medium":"low"}).throttle(100).onValue(function(n){"phone-"+e.punterCid===e.controlMode&&RestesqueUtil.post(e.wsClient,"/motor/rotation/speed/",n)})})}),n(e)})}function makeRestRadioButtons(e){return W.promise(function(n,t){$('[data-rest-type="radio-post"]').toArray().map($).map(function(n){var t=n.parent();t.on("click touchend",function(t){return t.preventDefault(),console.log("sending",n.val(),"to",n.data("restUri")),RestesqueUtil.post(e.wsClient,n.data("restUri"),n.val()),!1})}),$('[data-rest-type="feildset"]').toArray().map($).map(function(n){var t=n.find('input[type="radio"]').checkboxradio();console.log("got a field set",n.data("restUri")),RestesqueUtil.subscribeWithInitialGet(e.wsClient,n.data("restUri"),function(e){t.prop("checked",!1).checkboxradio("refresh").filter('input[value="'+e.getBody()+'"]').attr("checked","checked").checkboxradio("refresh").parent().find("label").removeClass("ui-radio-off").addClass("ui-radio-on")})}),n(e)})}function once(e){var n=!1;return function(){n||(e(),n=!0)}}function report(e,n){console.log("[",e,"]",W.rest(W.toArray(arguments)).join(" "))}function makeReporter(e,n){var t=arguments;return function(){report.apply(this,t);var e=arguments;return W.promise(function(n,t){n.apply(this,e)})}}var PunterViz=function(){function e(){return{containerEl:document.createElement("div"),backroundColor:6382180,preRenderFns:[],preCubeCamRenderFns:[],postCubeCamRenderFns:[]}}function n(e){return W.promise(function(n,t){e.camera=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,1,3e3),d(e,0,0,200),e.scene=new THREE.Scene,e.renderer=new THREE.WebGLRenderer({antialias:!1}),e.renderer.setPixelRatio(window.devicePixelRatio),e.renderer.setSize(window.innerWidth,window.innerHeight),e.renderer.setClearColor(e.backgroundColor),e.renderer.sortObjects=!1,e.containerEl.appendChild(e.renderer.domElement),n(e)})}function t(e){return W.promise(function(n,t){var r=document.createElement("video");r.autoplay=!0,navigator.webkitGetUserMedia({video:!0},function(e){r.src=URL.createObjectURL(e)},function(e){console.log("Failed to get a stream due to",e)}),e.webCamTexture=new THREE.Texture(r),e.webCamTexture.minFilter=THREE.LinearFilter,u(e,function(n,t){r.readyState===r.HAVE_ENOUGH_DATA&&(e.webCamTexture.needsUpdate=!0)}),n(e)})}function r(e){return W.promise(function(n,t){e.cubeCamera=new THREE.CubeCamera(1,3e3,256),e.cubeCamera.renderTarget.minFilter=THREE.LinearMipMapLinearFilter,u(e,function(n,t){e.preCubeCamRenderFns.forEach(function(e){return e(n,t)}),e.cubeCamera.updateCubeMap(e.renderer,e.scene),e.postCubeCamRenderFns.forEach(function(e){return e(n,t)})}),n(e)})}function o(e){return W.promise(function(n,t){e.webCamMaterial=new THREE.MeshBasicMaterial({map:e.webCamTexture,color:16777215,side:THREE.DoubleSide}),n(e)})}function i(e){return W.promise(function(n,t){function r(t){console.log(t.children[0]),e.webCamHedronMesh=t.children[0].clone(),e.webCamHedronMesh.material=e.webCamMaterial;var r=2800;e.webCamHedronMesh.scale.set(r,r,r);var o=W.randomBetween(2e-4,2e-5),i=W.randomBetween(2e-4,2e-5),a=W.randomBetween(2e-4,2e-5);u(e,function(n,t){e.webCamHedronMesh.rotation.x+=n*o,e.webCamHedronMesh.rotation.y+=n*i,e.webCamHedronMesh.rotation.z+=n*a}),e.scene.add(e.webCamHedronMesh),e.preCubeCamRenderFns.push(function(){e.webCamHedronMesh.visible=!0}),e.postCubeCamRenderFns.push(function(){e.webCamHedronMesh.visible=!0}),n(e)}var o=new THREE.OBJLoader;o.load("/obj/hedron.obj",r)})}function a(e){return W.promise(function(n,t){e.scene.add(new THREE.AmbientLight(2236962));var r=new THREE.DirectionalLight(16777215,2);r.position.set(2,1.2,10).normalize(),e.scene.add(r),r=new THREE.DirectionalLight(16777215,1),r.position.set(-2,1.2,-10).normalize(),e.scene.add(r),n(e)})}function s(e){return W.promise(function(n,t){function r(e){this.velocity=W.randomBetween(.2,1),this.mesh=e.clone(),this.mesh.material=r.material.clone(),this.mesh.scale.x=r.initialScale,this.mesh.scale.y=r.initialScale,this.mesh.scale.z=r.initialScale;var n=100;this.mesh.position.set((Math.random()-.5)*n,(Math.random()-.5)*n,(Math.random()-.5)*n),this.anchor=new THREE.Object3D,this.anchor.add(this.mesh)}function o(n){var t=n.children[0],o=100,a=5,s=100;!function c(){if(i.length<o){var n=new r(t);e.swarmObject3D.add(n.anchor),i.push(n),setTimeout(c,W.map(i.length/o,0,1,s,a,W.interpolations.easeIn))}}()}var i=[];e.swarmObject3D=new THREE.Object3D,e.scene.add(e.swarmObject3D),e.preCubeCamRenderFns.push(function(){e.swarmObject3D.visible=!1}),e.postCubeCamRenderFns.push(function(){e.swarmObject3D.visible=!0}),u(e,function(e,n){i.forEach(function(t){return t.update(e,n)})}),r.material=new THREE.MeshPhongMaterial({color:16777215,shininess:0,specular:16777215,envMap:e.cubeCamera.renderTarget,reflectivity:1,side:THREE.DoubleSide}),console.log("Set material to",r.material),r.initialScale=200,r.prototype.update=function(e,n){this.anchor.rotation.x+=.002,this.anchor.rotation.y+=this.velocity/10,this.anchor.rotation.z+=.001};var a=new THREE.OBJLoader;a.load("/obj/pillow-box.obj",o),n(e)})}function c(e){return W.promise(function(n,t){var r=0,o=0;!function i(n){window.requestAnimationFrame(i),o=n-r,r=n,e.preRenderFns.forEach(function(e){return e(o,n)}),e.renderer.clear(),e.renderer.render(e.scene,e.camera)}(r),n(e)})}function u(e,n){e.preRenderFns.push(n)}function d(e,n,t,r){e.camera.position.x=n,e.camera.position.y=t,e.camera.position.z=r}var l=W.composePromisers(n,t,o,r,i,s,a,c);return{makeApp:e,initApp:l}}(),makeApp=function(){return{wsUrl:W.join("https:"===document.location.protocol?"wss://":"ws://",document.location.host,"/")}},initApp=W.composePromisers(makeWebSocketClient,subscribeToHostControlMode,addPunterCid,makePunterVizs,makeRestRadioButtons);$(function(){initApp(makeApp()).success(function(e){report("OK","TheWorkers.net"),window.app=e})});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFsbC5qcyIsIm1haW4uanMiLCJwdW50ZXItdml6LmpzIl0sIm5hbWVzIjpbIm1ha2VXZWJTb2NrZXRDbGllbnQiLCJhcHAiLCJXIiwicHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJjb25zb2xlIiwibG9nIiwid3NVcmwiLCJ3c0NsaWVudCIsIkpTT05Tb2NrZXRDb25uZWN0aW9uIiwic29ja2V0VXJsIiwicmVzb2x2ZU9uRmlyc3RDb25uZWN0Iiwib25jZSIsIiQiLCJyZW1vdmUiLCJyZXBvcnQiLCJvbiIsIm1ha2VSZXBvcnRlciIsIm9wZW5Tb2NrZXRDb25uZWN0aW9uIiwic3Vic2NyaWJlVG9Ib3N0Q29udHJvbE1vZGUiLCJjb250cm9sTW9kZSIsIlJlc3Rlc3F1ZVV0aWwiLCJzdWJzY3JpYmVXaXRoSW5pdGlhbEdldCIsInBhY2tldCIsImdldEJvZHkiLCJzdWNjZXNzIiwiYWRkUHVudGVyQ2lkIiwicHVudGVyQ2lkIiwiZGF0YSIsIm1ha2VQdW50ZXJWaXpzIiwidG9BcnJheSIsIm1hcCIsImVsIiwicHVudGVyVml6IiwiUHVudGVyVml6IiwibWFrZUFwcCIsImNvbnRhaW5lckVsIiwiaW5pdEFwcCIsImVycm9yIiwiZXJyIiwiaW5pdGFsaXNlZFB1bnRlckFwcCIsInJvdGF0aW9uU3RlcCIsImdhbW1hU3RyZWFtIiwid2luZG93IiwiYXNFdmVudFN0cmVhbSIsImUiLCJvcmlnaW5hbEV2ZW50IiwiZ2FtbWEiLCJnIiwic2tpcER1cGxpY2F0ZXMiLCJ0aHJvdHRsZSIsIm9uVmFsdWUiLCJkaXJlY3Rpb24iLCJwb3N0IiwiTWF0aCIsImFicyIsInNwZWVkIiwibWFrZVJlc3RSYWRpb0J1dHRvbnMiLCIkZWwiLCIkd3JhcHBlckVsIiwicGFyZW50IiwicHJldmVudERlZmF1bHQiLCJ2YWwiLCJyYWRpb0VscyIsImZpbmQiLCJjaGVja2JveHJhZGlvIiwicHJvcCIsImZpbHRlciIsImF0dHIiLCJyZW1vdmVDbGFzcyIsImFkZENsYXNzIiwiZm4iLCJoYXNUcmlnZ2VyZWQiLCJzdGF0dXMiLCJzdHIiLCJyZXN0IiwiYXJndW1lbnRzIiwiam9pbiIsInJlcG9ydEFyZ3MiLCJhcHBseSIsInRoaXMiLCJjYWxsZWVBcmdzIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiYmFja3JvdW5kQ29sb3IiLCJwcmVSZW5kZXJGbnMiLCJwcmVDdWJlQ2FtUmVuZGVyRm5zIiwicG9zdEN1YmVDYW1SZW5kZXJGbnMiLCJtYWtlQ2FtZXJhU2NlbmVSZW5kZXJlciIsImNhbWVyYSIsIlRIUkVFIiwiUGVyc3BlY3RpdmVDYW1lcmEiLCJpbm5lcldpZHRoIiwiaW5uZXJIZWlnaHQiLCJzZXRDYW1lcmFQb3NpdGlvbiIsInNjZW5lIiwiU2NlbmUiLCJyZW5kZXJlciIsIldlYkdMUmVuZGVyZXIiLCJhbnRpYWxpYXMiLCJzZXRQaXhlbFJhdGlvIiwiZGV2aWNlUGl4ZWxSYXRpbyIsInNldFNpemUiLCJzZXRDbGVhckNvbG9yIiwiYmFja2dyb3VuZENvbG9yIiwic29ydE9iamVjdHMiLCJhcHBlbmRDaGlsZCIsImRvbUVsZW1lbnQiLCJtYWtlV2ViQ2FtVGV4dHVyZSIsIndlYkNhbUVsIiwiYXV0b3BsYXkiLCJuYXZpZ2F0b3IiLCJ3ZWJraXRHZXRVc2VyTWVkaWEiLCJ2aWRlbyIsInN0cmVhbSIsInNyYyIsIlVSTCIsImNyZWF0ZU9iamVjdFVSTCIsIndlYkNhbVRleHR1cmUiLCJUZXh0dXJlIiwibWluRmlsdGVyIiwiTGluZWFyRmlsdGVyIiwiYWRkUHJlUmVuZGVyRm4iLCJkZXRsYU1TIiwidGltZXN0YW1wTVMiLCJyZWFkeVN0YXRlIiwiSEFWRV9FTk9VR0hfREFUQSIsIm5lZWRzVXBkYXRlIiwibWFrZUN1YmVDYW0iLCJjdWJlQ2FtZXJhIiwiQ3ViZUNhbWVyYSIsInJlbmRlclRhcmdldCIsIkxpbmVhck1pcE1hcExpbmVhckZpbHRlciIsImRlbHRhTVMiLCJmb3JFYWNoIiwidXBkYXRlQ3ViZU1hcCIsIm1ha2VXZWJDYW1NYXRlcmlhbCIsIndlYkNhbU1hdGVyaWFsIiwiTWVzaEJhc2ljTWF0ZXJpYWwiLCJjb2xvciIsInNpZGUiLCJEb3VibGVTaWRlIiwibWFrZVdlYkNhbUhlZHJvbk1lc2giLCJvbk9iakxvYWRlZCIsIm9iaiIsImNoaWxkcmVuIiwid2ViQ2FtSGVkcm9uTWVzaCIsImNsb25lIiwibWF0ZXJpYWwiLCJzY2FsZSIsInNldCIsInJvdGF0aW9uWCIsInJhbmRvbUJldHdlZW4iLCJyb3RhdGlvblkiLCJyb3RhdGlvbloiLCJyb3RhdGlvbiIsIngiLCJ5IiwieiIsImFkZCIsInB1c2giLCJ2aXNpYmxlIiwibG9hZGVyIiwiT0JKTG9hZGVyIiwibG9hZCIsIm1ha2VMaWdodHMiLCJBbWJpZW50TGlnaHQiLCJkaXJlY3Rpb25hbExpZ2h0IiwiRGlyZWN0aW9uYWxMaWdodCIsInBvc2l0aW9uIiwibm9ybWFsaXplIiwibWFrZVN3YXJtIiwiUGFydGljbGUiLCJtZXNoIiwidmVsb2NpdHkiLCJpbml0aWFsU2NhbGUiLCJyYW5nZSIsInJhbmRvbSIsImFuY2hvciIsIk9iamVjdDNEIiwibWF4UGFydGljbGVzIiwibWluQ3JlYXRpb25UaW1lIiwibWF4Q3JlYXRpb25UaW1lTVMiLCJjcmVhdGVNb3JlIiwicGFydGljbGVzIiwibGVuZ3RoIiwicGFydGljbGUiLCJzd2FybU9iamVjdDNEIiwic2V0VGltZW91dCIsImludGVycG9sYXRpb25zIiwiZWFzZUluIiwidXBkYXRlIiwiTWVzaFBob25nTWF0ZXJpYWwiLCJzaGluaW5lc3MiLCJzcGVjdWxhciIsImVudk1hcCIsInJlZmxlY3Rpdml0eSIsInByb3RvdHlwZSIsIm1ha2VSZW5kZXJMb29wIiwibGFzdFRpbWVzdGFtcE1TIiwibG9vcCIsImN1cnJlbnRUaW1lc3RhbXBNUyIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsImNsZWFyIiwicmVuZGVyIiwiY29tcG9zZVByb21pc2VycyIsImxvY2F0aW9uIiwicHJvdG9jb2wiLCJob3N0Il0sIm1hcHBpbmdzIjoiQUFRQSxZQzBCQSxTQUFTQSxxQkFBc0JDLEdB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QTRCLHFCQUVsQzVDLEdBQUcsV0FDQ3dCLFFBQVNGLFdBQ1JWLFFBQVMsU0FBV3pCLEdBQ2pCZSxPQUFRLEtBQU0sa0JBQ2Q0QixPQUFPM0MsSUFBTUEiLCJmaWxlIjoiYWxsLmpzIiwic291cmNlc0NvbnRlbnQiOltudWxsLCIvKiBqc2hpbnQgZXNuZXh0OiB0cnVlICovXG5cbi8vIE1haW4uanNcbi8vID09PT09PT1cbi8vIEVudHJ5IHBvaW50IG9mIHRoZSBhcHBsaWNhdGlvbi5cblxuLy8gTWFrZSAmIEluaXRcbi8vID09PT09PT09PT09XG5cbnZhciBtYWtlQXBwID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB7XG4gICAgICAgIHdzVXJsOiBXLmpvaW4oIGRvY3VtZW50LmxvY2F0aW9uLnByb3RvY29sID09PSAnaHR0cHM6JyA/ICd3c3M6Ly8nIDogJ3dzOi8vJyxcbiAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQubG9jYXRpb24uaG9zdCwgLy9kb2N1bWVudC4nLy8vJy8vJ3dzczovLzE5Mi4xNjguMC43OjcwODAnXG4gICAgICAgICAgICAgICAgICAgICAgICcvJyApXG4gICAgfTtcbn07XG5cbnZhciBpbml0QXBwID0gVy5jb21wb3NlUHJvbWlzZXJzKCBtYWtlV2ViU29ja2V0Q2xpZW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YnNjcmliZVRvSG9zdENvbnRyb2xNb2RlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZFB1bnRlckNpZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYWtlUHVudGVyVml6cyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYWtlUmVzdFJhZGlvQnV0dG9ucyApO1xuXG4kKCBmdW5jdGlvbiAoKSB7XG4gICAgaW5pdEFwcCggbWFrZUFwcCgpIClcbiAgICAuc3VjY2VzcyggZnVuY3Rpb24gKCBhcHAgKSB7XG4gICAgICAgIHJlcG9ydCggJ09LJywgJ1RoZVdvcmtlcnMubmV0JyApO1xuICAgICAgICB3aW5kb3cuYXBwID0gYXBwO1xuICAgIH0pO1xufSk7XG5cbi8vIFByb21pc2Vyc1xuLy8gPT09PT09PT09XG5cbmZ1bmN0aW9uIG1ha2VXZWJTb2NrZXRDbGllbnQgKCBhcHAgKSB7XG4gICAgcmV0dXJuIFcucHJvbWlzZSggZnVuY3Rpb24gKCByZXNvbHZlLCByZWplY3QgKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCAnQ29ubmVjdGluZyB0byB3ZWJzb2NrZXQgY2xpZW50OicsIGFwcC53c1VybCApO1xuICAgICAgICBcbiAgICAgICAgYXBwLndzQ2xpZW50ID0gbmV3IFcuSlNPTlNvY2tldENvbm5lY3Rpb24oe1xuICAgICAgICAgICAgc29ja2V0VXJsOiBhcHAud3NVcmxcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICB2YXIgcmVzb2x2ZU9uRmlyc3RDb25uZWN0ID0gb25jZSggZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJCggJ1tkYXRhLWRpc2Nvbm5lY3RlZC13YXJuaW5nXScgKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIHJlcG9ydCggJ0NPTk5FQ1RFRCcsICd0bzonLCBhcHAud3NVcmwgKTtcbiAgICAgICAgICAgIHJlc29sdmUoIGFwcCApO1xuICAgICAgICB9KTtcblxuICAgICAgICBhcHAud3NDbGllbnQub24oICdvcGVuJywgcmVzb2x2ZU9uRmlyc3RDb25uZWN0ICk7XG4gICAgICAgIGFwcC53c0NsaWVudC5vbiggJ2Vycm9yJywgbWFrZVJlcG9ydGVyKCAnV2ViIFNvY2tldCBFcnJvcicgKSApO1xuICAgICAgICBhcHAud3NDbGllbnQub24oICdjbG9zZScsIG1ha2VSZXBvcnRlciggJ1dlYiBTb2NrZXQgQ2xvc2UnICkgKTtcbiAgICAgICAgYXBwLndzQ2xpZW50Lm9wZW5Tb2NrZXRDb25uZWN0aW9uKCk7XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIHN1YnNjcmliZVRvSG9zdENvbnRyb2xNb2RlICggYXBwICkge1xuICAgIHJldHVybiBXLnByb21pc2UoIGZ1bmN0aW9uICggcmVzb2x2ZSwgcmVqZWN0ICkge1xuICAgICAgICBhcHAuY29udHJvbE1vZGUgPSAnJztcbiAgICAgICAgUmVzdGVzcXVlVXRpbFxuICAgICAgICAgICAgLnN1YnNjcmliZVdpdGhJbml0aWFsR2V0KCBhcHAud3NDbGllbnQsICcvaG9zdC9jb250cm9sL21vZGUvJywgZnVuY3Rpb24gKCBwYWNrZXQgKSB7XG4gICAgICAgICAgICAgICAgYXBwLmNvbnRyb2xNb2RlID0gcGFja2V0LmdldEJvZHkoKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggJ0NvbnRyb2wgTW9kZSBDaGFuZ2UgdG86JywgYXBwLmNvbnRyb2xNb2RlICk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnN1Y2Nlc3MoIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXNvbHZlKCBhcHAgKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH0pO1xufVxuXG5mdW5jdGlvbiBhZGRQdW50ZXJDaWQgKCBhcHAgKSB7XG4gICAgcmV0dXJuIFcucHJvbWlzZSggZnVuY3Rpb24gKCByZXNvbHZlLCByZWplY3QgKSB7XG4gICAgICAgIGFwcC5wdW50ZXJDaWQgPSAkKCAnW2RhdGEtcHVudGVyLWNpZF0nICkuZGF0YSggJ3B1bnRlckNpZCcgKTtcbiAgICAgICAgcmVzb2x2ZSggYXBwICk7XG4gICAgfSk7XG59XG5cbi8vIFB1bnRlciBWaXpcbi8vIC0tLS0tLS0tLS1cblxuZnVuY3Rpb24gbWFrZVB1bnRlclZpenMgKCBhcHAgKSB7XG4gICAgcmV0dXJuIFcucHJvbWlzZSggZnVuY3Rpb24gKCByZXNvbHZlLCByZWplY3QgKSB7XG4gICAgICAgICQoIFwiW2RhdGEtcHVudGVyLXZpel1cIiApXG4gICAgICAgICAgICAudG9BcnJheSgpXG4gICAgICAgICAgICAubWFwKCBmdW5jdGlvbiAoIGVsICkge1xuICAgICAgICAgICAgICAgIC8vIE1ha2UgdGhlIHB1bnRlciBhcHBsaWNhdGlvblxuICAgICAgICAgICAgICAgIGFwcC5wdW50ZXJWaXogPSBQdW50ZXJWaXoubWFrZUFwcCgpO1xuICAgICAgICAgICAgICAgIC8vIEFkZCBvdXQgZG9tIGVsZW1lbnRcbiAgICAgICAgICAgICAgICBhcHAucHVudGVyVml6LmNvbnRhaW5lckVsID0gZWw7XG5cbiAgICAgICAgICAgICAgICAvLyBJbml0YWlsaXNlIGl0XG5cbiAgICAgICAgICAgICAgICB2YXIgRk9SV0FSRFNfSElHSCA9IFsgWyAnLycgXSBdIFxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIFB1bnRlclZpelxuICAgICAgICAgICAgICAgICAgICAuaW5pdEFwcCggYXBwLnB1bnRlclZpeiApXG4gICAgICAgICAgICAgICAgICAgIC5lcnJvciggZnVuY3Rpb24gKCBlcnIgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCAnRmFpbGVkIHRvIGNyZWF0ZSBQdW50ZXIgYXBwJywgZXJyICk7XG4gICAgICAgICAgICAgICAgICAgIH0pIFxuICAgICAgICAgICAgICAgICAgICAuc3VjY2VzcyggZnVuY3Rpb24gKCBpbml0YWxpc2VkUHVudGVyQXBwICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coICdQdW50ZXIgYXBwbGljYXRpb24gbWFkZScgKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJvdGF0aW9uU3RlcCA9IDI1LjcxNDI4NTcxNDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWRkIHRoZSByb3RhdGlvbiBjb250cm9sc1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZ2FtbWEgcmlnaHQgOTAsIGxlZnQgLTkwXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZ2FtbWFTdHJlYW0gPSAkKCB3aW5kb3cgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXNFdmVudFN0cmVhbSggJ2RldmljZW9yaWVudGF0aW9uJyApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5tYXAoIGUgPT4gZS5vcmlnaW5hbEV2ZW50LmdhbW1hICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFsgYmgsIGJtLCBibCwgbiwgZmwsIGZtLCBmaCBdXG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvcndhcmRzICYgQmFja3dhcmRzXG4gICAgICAgICAgICAgICAgICAgICAgICBnYW1tYVN0cmVhbVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5tYXAoIGZ1bmN0aW9uICggZyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBnIDwgLXJvdGF0aW9uU3RlcCApIHsgcmV0dXJuICdiYWNrd2FyZCc7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoIGcgPiByb3RhdGlvblN0ZXAgKSB7IHJldHVybiAnZm9yd2FyZCc7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7IHJldHVybiAnbm9uZSc7IH0gXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2tpcER1cGxpY2F0ZXMoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aHJvdHRsZSggMTAwIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAub25WYWx1ZSggZnVuY3Rpb24gKCBkaXJlY3Rpb24gKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggJ3Bob25lLScgKyBhcHAucHVudGVyQ2lkID09PSBhcHAuY29udHJvbE1vZGUgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZXN0ZXNxdWVVdGlsLnBvc3QoIGFwcC53c0NsaWVudCwgJy9tb3Rvci9yb3RhdGlvbi9kaXJlY3Rpb24vJywgZGlyZWN0aW9uICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3BlZWRcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhbW1hU3RyZWFtXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLm1hcCggZyA9PiBNYXRoLmFicyggZyApIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAubWFwKCBmdW5jdGlvbiAoIGcgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggZyA+IDkwIC0gcm90YXRpb25TdGVwICkgeyByZXR1cm4gJ2hpZ2gnOyB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKCBnID4gOTAgLSAoIHJvdGF0aW9uU3RlcCAqIDIgKSApIHsgcmV0dXJuICdtZWRpdW0nOyB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgeyByZXR1cm4gJ2xvdyc7IH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aHJvdHRsZSggMTAwIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAub25WYWx1ZSggZnVuY3Rpb24gKCBzcGVlZCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAncGhvbmUtJyArIGFwcC5wdW50ZXJDaWQgPT09IGFwcC5jb250cm9sTW9kZSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlc3Rlc3F1ZVV0aWwucG9zdCggYXBwLndzQ2xpZW50LCAnL21vdG9yL3JvdGF0aW9uL3NwZWVkLycsIHNwZWVkICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgcmVzb2x2ZSggYXBwICk7XG4gICAgfSk7XG59XG5cbi8vIGpRdWVyeSBNb2JpbGUgVWkgQmluZGluZ3Ncbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuZnVuY3Rpb24gbWFrZVJlc3RSYWRpb0J1dHRvbnMgKCBhcHAgKSB7XG4gICAgcmV0dXJuIFcucHJvbWlzZSggZnVuY3Rpb24gKCByZXNvbHZlLCByZWplY3QgKSB7XG4gICAgICAgIC8vIFJhZGlvIEJ1dHRvbnNcbiAgICAgICAgLy8gPT09PT09PT09PT09PVxuICAgICAgICAkKCAnW2RhdGEtcmVzdC10eXBlPVwicmFkaW8tcG9zdFwiXScgKVxuICAgICAgICAgICAgLnRvQXJyYXkoKVxuICAgICAgICAgICAgLm1hcCggJCApXG4gICAgICAgICAgICAubWFwKCBmdW5jdGlvbiAoICRlbCApIHtcbiAgICAgICAgICAgICAgICAvLyBEaXNhYmxlIHJlYWwgZXZlbnRzXG4gICAgICAgICAgICAgICAgdmFyICR3cmFwcGVyRWwgPSAkZWwucGFyZW50KCk7XG4gICAgICAgICAgICAgICAgJHdyYXBwZXJFbC5vbiggJ2NsaWNrIHRvdWNoZW5kJywgZnVuY3Rpb24gKCBlICkge1xuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnc2VuZGluZycsJGVsLnZhbCgpLCAndG8nLCAkZWwuZGF0YSggJ3Jlc3RVcmknICkgICk7XG4gICAgICAgICAgICAgICAgICAgIFJlc3Rlc3F1ZVV0aWwucG9zdCggYXBwLndzQ2xpZW50LCAkZWwuZGF0YSggJ3Jlc3RVcmknICksICRlbC52YWwoKSApO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAvLyBSYWRpbyBGaWVsZCBTZXRzXG4gICAgICAgIC8vID09PT09PT09PT09PT09PT1cbiAgICAgICAgJCggJ1tkYXRhLXJlc3QtdHlwZT1cImZlaWxkc2V0XCJdJyApXG4gICAgICAgICAgICAudG9BcnJheSgpXG4gICAgICAgICAgICAubWFwKCAkIClcbiAgICAgICAgICAgIC5tYXAoIGZ1bmN0aW9uICggJGVsICkge1xuXG4gICAgICAgICAgICAgICAgdmFyIHJhZGlvRWxzID0gJGVsLmZpbmQoICdpbnB1dFt0eXBlPVwicmFkaW9cIl0nICkuY2hlY2tib3hyYWRpbygpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCAgJ2dvdCBhIGZpZWxkIHNldCcsICRlbC5kYXRhKCAncmVzdFVyaScgKSApO1xuICAgICAgICAgICAgICAgIFJlc3Rlc3F1ZVV0aWwuc3Vic2NyaWJlV2l0aEluaXRpYWxHZXQoIGFwcC53c0NsaWVudCwgJGVsLmRhdGEoICdyZXN0VXJpJyApLCBmdW5jdGlvbiAoIHBhY2tldCApIHtcbiAgICAgICAgICAgICAgICAgICAgcmFkaW9FbHNcbiAgICAgICAgICAgICAgICAgICAgICAgIC5wcm9wKCAnY2hlY2tlZCcsIGZhbHNlIClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jaGVja2JveHJhZGlvKCAncmVmcmVzaCcgKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmZpbHRlciggJ2lucHV0W3ZhbHVlPVwiJysgcGFja2V0LmdldEJvZHkoKSArJ1wiXScgKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoICdjaGVja2VkJywgJ2NoZWNrZWQnIClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jaGVja2JveHJhZGlvKCAncmVmcmVzaCcgKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnBhcmVudCgpXG4gICAgICAgICAgICAgICAgICAgICAgICAuZmluZCggJ2xhYmVsJyApXG4gICAgICAgICAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoICd1aS1yYWRpby1vZmYnIClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcyggJ3VpLXJhZGlvLW9uJyApO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICByZXNvbHZlKCBhcHAgKTtcbiAgICB9KTtcbn1cblxuLy8gVXRpbHNcbi8vID09PT09XG5cbi8vIEZ1bmN0aW9uXG4vLyAtLS0tLS0tLVxuICAgIFxuZnVuY3Rpb24gb25jZSAoIGZuICkge1xuICAgIHZhciBoYXNUcmlnZ2VyZWQgPSBmYWxzZTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoICEgaGFzVHJpZ2dlcmVkICkge1xuICAgICAgICAgICAgZm4oKTtcbiAgICAgICAgICAgIGhhc1RyaWdnZXJlZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9O1xufVxuXG4vLyBSZXBvcnRpbmdcbi8vIC0tLS0tLS0tLVxuXG5mdW5jdGlvbiByZXBvcnQoIHN0YXR1cywgc3RyICkge1xuICAgIGNvbnNvbGUubG9nKCAnWycsIHN0YXR1cywgJ10nLCBXLnJlc3QoIFcudG9BcnJheSggYXJndW1lbnRzICkgKS5qb2luKCAnICcgKSApO1xufVxuXG5mdW5jdGlvbiBtYWtlUmVwb3J0ZXIoIHN0YXR1cywgc3RyICkge1xuICAgIHZhciByZXBvcnRBcmdzID0gYXJndW1lbnRzO1xuICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJlcG9ydC5hcHBseSggdGhpcywgcmVwb3J0QXJncyApO1xuICAgICAgICB2YXIgY2FsbGVlQXJncyA9IGFyZ3VtZW50cztcbiAgICAgICAgcmV0dXJuIFcucHJvbWlzZSggZnVuY3Rpb24gKCByZXNvbHZlLCByZWplY3QgKSB7XG4gICAgICAgICAgICByZXNvbHZlLmFwcGx5KCB0aGlzLCBjYWxsZWVBcmdzICk7XG4gICAgICAgIH0pO1xuICAgIH07XG59XG4iLCIvKiBqc2hpbnQgZXNuZXh0OiB0cnVlICovXG5cbi8vIFB1bnRlciBWaXpcbi8vID09PT09PT09PT1cbi8vIEEgdGhyZWUuanMgdmlzdWxpc2F0aW9uIHRvIGJlXG4vLyBydW4gb24gYW4gSFRDIHBob25lIGFuZCBjYXJyaWVkIGJ5XG4vLyBwdW50ZXJzIGludG8gdGhlIG1pcnJvciBib3guXG5cbnZhciBQdW50ZXJWaXogPSAoZnVuY3Rpb24gKCkge1xuXG4gICAgLy8gSW5pdCAmIG1ha2VcbiAgICAvLyA9PT09PT09PT09PVxuICAgIGZ1bmN0aW9uIG1ha2VBcHAgKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY29udGFpbmVyRWw6IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdkaXYnICksXG4gICAgICAgICAgICBiYWNrcm91bmRDb2xvcjogMHg2MTYyNjQsXG4gICAgICAgICAgICBwcmVSZW5kZXJGbnM6IFtdLFxuICAgICAgICAgICAgcHJlQ3ViZUNhbVJlbmRlckZuczogW10sXG4gICAgICAgICAgICBwb3N0Q3ViZUNhbVJlbmRlckZuczogW11cbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICB2YXIgaW5pdEFwcCA9IFcuY29tcG9zZVByb21pc2VycyggbWFrZUNhbWVyYVNjZW5lUmVuZGVyZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ha2VXZWJDYW1UZXh0dXJlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYWtlV2ViQ2FtTWF0ZXJpYWwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ha2VDdWJlQ2FtLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBtYWtlV2ViQ2FtQm94TWVzaCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFrZVdlYkNhbUhlZHJvbk1lc2gsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ha2VTd2FybSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFrZUxpZ2h0cyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFrZVJlbmRlckxvb3AgKTtcblxuICAgIC8vIFByb21pc2Vyc1xuICAgIC8vID09PT09PT09PVxuXG4gICAgLy8gQ2FtZXJhLCBTY2VuZSwgUmVuZGVyZXJcbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGZ1bmN0aW9uIG1ha2VDYW1lcmFTY2VuZVJlbmRlcmVyICggYXBwICkge1xuICAgICAgICByZXR1cm4gVy5wcm9taXNlKCBmdW5jdGlvbiAoIHJlc29sdmUsIHJlamVjdCApIHtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gQ2FtZXJhXG4gICAgICAgICAgICAvLyAtLS0tLS1cbiAgICAgICAgICAgIGFwcC5jYW1lcmEgPSBuZXcgVEhSRUUuUGVyc3BlY3RpdmVDYW1lcmEoIDcwLCB3aW5kb3cuaW5uZXJXaWR0aCAvIHdpbmRvdy5pbm5lckhlaWdodCwgMSwgMzAwMCApO1xuICAgICAgICAgICAgc2V0Q2FtZXJhUG9zaXRpb24oIGFwcCwgMCwgMCwgMjAwICk7XG5cbiAgICAgICAgICAgIC8vIFNjZW5lXG4gICAgICAgICAgICAvLyAtLS0tLVxuICAgICAgICAgICAgYXBwLnNjZW5lID0gbmV3IFRIUkVFLlNjZW5lKCk7XG5cbiAgICAgICAgICAgIC8vIFJlbmRlcmVyXG4gICAgICAgICAgICAvLyAtLS0tLS0tLVxuICAgICAgICAgICAgYXBwLnJlbmRlcmVyID0gbmV3IFRIUkVFLldlYkdMUmVuZGVyZXIoIHsgYW50aWFsaWFzOiBmYWxzZSB9ICk7XG5cdCAgICBhcHAucmVuZGVyZXIuc2V0UGl4ZWxSYXRpbyggd2luZG93LmRldmljZVBpeGVsUmF0aW8gKTtcblx0ICAgIGFwcC5yZW5kZXJlci5zZXRTaXplKCB3aW5kb3cuaW5uZXJXaWR0aCwgd2luZG93LmlubmVySGVpZ2h0ICk7XG4gICAgICAgICAgICBhcHAucmVuZGVyZXIuc2V0Q2xlYXJDb2xvciggYXBwLmJhY2tncm91bmRDb2xvciApO1xuXHQgICAgYXBwLnJlbmRlcmVyLnNvcnRPYmplY3RzID0gZmFsc2U7XG5cbiAgICAgICAgICAgIGFwcC5jb250YWluZXJFbC5hcHBlbmRDaGlsZCggYXBwLnJlbmRlcmVyLmRvbUVsZW1lbnQgKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcmVzb2x2ZSggYXBwICk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFdlYiBDYW1cbiAgICAvLyAtLS0tLS0tXG4gICAgLy8gTWFrZSB0aGUgd2ViIGNhbSBhdmFpbGFibGUgYXMgYSB0ZXh0dXJlXG4gICAgZnVuY3Rpb24gbWFrZVdlYkNhbVRleHR1cmUgKCBhcHAgKSB7XG4gICAgICAgIHJldHVybiBXLnByb21pc2UoIGZ1bmN0aW9uICggcmVzb2x2ZSwgcmVqZWN0ICkge1xuXG4gICAgICAgICAgICAvLyBXZWIgQ2FtIERPTSBFbGVtZW50XG4gICAgICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgICAgICB2YXIgd2ViQ2FtRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd2aWRlbycpO1xuICAgICAgICAgICAgd2ViQ2FtRWwuYXV0b3BsYXkgPSB0cnVlO1xuXG4gICAgICAgICAgICAvLyBXZWIgQ2FtIFN0cmVhbVxuICAgICAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgIG5hdmlnYXRvci53ZWJraXRHZXRVc2VyTWVkaWEoIHsgdmlkZW86dHJ1ZSB9LCBmdW5jdGlvbiggc3RyZWFtICl7XG4gICAgICAgICAgICAgICAgd2ViQ2FtRWwuc3JjID0gVVJMLmNyZWF0ZU9iamVjdFVSTCggc3RyZWFtICk7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbiggZXJyICl7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJGYWlsZWQgdG8gZ2V0IGEgc3RyZWFtIGR1ZSB0b1wiLCBlcnIpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIFdlYiBDYW0gVGV4dHVyZVxuICAgICAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgICAgICBhcHAud2ViQ2FtVGV4dHVyZSA9IG5ldyBUSFJFRS5UZXh0dXJlKCB3ZWJDYW1FbCApO1xuICAgICAgICAgICAgYXBwLndlYkNhbVRleHR1cmUubWluRmlsdGVyID0gVEhSRUUuTGluZWFyRmlsdGVyO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBSZW5kZXIgVXBkYXRlc1xuICAgICAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgIGFkZFByZVJlbmRlckZuKCBhcHAsIGZ1bmN0aW9uICggZGV0bGFNUywgdGltZXN0YW1wTVMgKSB7XG4gICAgICAgICAgICAgICAgaWYoIHdlYkNhbUVsLnJlYWR5U3RhdGUgPT09IHdlYkNhbUVsLkhBVkVfRU5PVUdIX0RBVEEgKXtcbiAgICAgICAgICAgICAgICAgICAgYXBwLndlYkNhbVRleHR1cmUubmVlZHNVcGRhdGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXNvbHZlKCBhcHAgKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQ3ViZSBDYW1lcmFcbiAgICAvLyAtLS0tLS0tLS0tLVxuICAgIC8vIENyZWF0ZSBhIGN1YmUgY2FtIGZvciBhIGR5bmFtaWMgZW52TWFwLlxuICAgIC8vIFRoaXMgYWxzbyBlbmFibGVzIHR3byBob29rczogYHByZUN1YmVDYW1SZW5kZXJBY3Rpb25zYCAmIGBwb3N0Q3ViZUNhbVJlbmRlckFjdGlvbnNgXG4gICAgLy8gaW4gdGhlIGFwcCBmb3IgdGhhdCBvYmplY3QzRCBpbiB0aGUgc2NlbmUgY2FuIGJlIHR1cm5lZCBvbiBhbmQgb2ZmIGR1cmluZ1xuICAgIC8vIHRoZSB3ZWJjYW1zIHJlbmRlclxuICAgIGZ1bmN0aW9uIG1ha2VDdWJlQ2FtICggYXBwICkgeyBcbiAgICAgICAgcmV0dXJuIFcucHJvbWlzZSggZnVuY3Rpb24gKCByZXNvbHZlLCByZWplY3QgKSB7XG5cbiAgICAgICAgICAgIGFwcC5jdWJlQ2FtZXJhID0gbmV3IFRIUkVFLkN1YmVDYW1lcmEoMSwgMzAwMCwgMjU2KTsgLy8gbmVhciwgZmFyLCByZXNvbHV0aW9uXG4gICAgICAgICAgICBhcHAuY3ViZUNhbWVyYS5yZW5kZXJUYXJnZXQubWluRmlsdGVyID0gVEhSRUUuTGluZWFyTWlwTWFwTGluZWFyRmlsdGVyOyAvLyBtaXBtYXAgZmlsdGVyXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGFkZFByZVJlbmRlckZuKCBhcHAsIGZ1bmN0aW9uICggZGVsdGFNUywgdGltZXN0YW1wTVMgKSB7ICAgIFxuICAgICAgICAgICAgICAgIC8vIFJlbmRlciB0aGUgY3ViZSBjYW1lcmEgdG8gY3ViZSBtYXBcbiAgICAgICAgICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgICAgICAgICAgYXBwLnByZUN1YmVDYW1SZW5kZXJGbnMuZm9yRWFjaCggZm4gPT4gZm4oIGRlbHRhTVMsIHRpbWVzdGFtcE1TICkgKTtcbiAgICAgICAgICAgICAgICBhcHAuY3ViZUNhbWVyYS51cGRhdGVDdWJlTWFwKCBhcHAucmVuZGVyZXIsIGFwcC5zY2VuZSApO1xuICAgICAgICAgICAgICAgIGFwcC5wb3N0Q3ViZUNhbVJlbmRlckZucy5mb3JFYWNoKCBmbiA9PiBmbiggZGVsdGFNUywgdGltZXN0YW1wTVMgKSApO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHJlc29sdmUoIGFwcCApO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBXZWIgQ2FtIE1hdGVyaWFsXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLVxuICAgIGZ1bmN0aW9uIG1ha2VXZWJDYW1NYXRlcmlhbCAoIGFwcCApIHtcbiAgICAgICAgcmV0dXJuIFcucHJvbWlzZSggZnVuY3Rpb24gKCByZXNvbHZlLCByZWplY3QgKSB7XG4gICAgICAgICAgICBhcHAud2ViQ2FtTWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoe1xuICAgICAgICAgICAgICAgIG1hcDogYXBwLndlYkNhbVRleHR1cmUsXG4gICAgICAgICAgICAgICAgY29sb3I6IDB4ZmZmZmZmLFxuXHQgICAgICAgIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmVzb2x2ZSggYXBwICk7XG4gICAgICAgIH0pO1xuXG4gICAgfVxuXG4gICAgLy8gV2ViIENhbSBCb3ggTWVzaFxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBDcmVhdGVzIGEgYm94IHdpdGggdGhlIHdlYiBjYW0gZGlzcGxheWVkXG4gICAgLy8gb24gdGhlIGluc2lkZSBvZiBlYWNoIG9mIGl0J3MgNiBzaWRlc1xuICAgIGZ1bmN0aW9uIG1ha2VXZWJDYW1Cb3hNZXNoICggYXBwICkge1xuICAgICAgICByZXR1cm4gVy5wcm9taXNlKCBmdW5jdGlvbiAoIHJlc29sdmUsIHJlamVjdCApIHtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgYXBwLndlYkNhbXZCb3hNZXNoID0gbmV3IFRIUkVFLk1lc2goIG5ldyBUSFJFRS5Cb3hHZW9tZXRyeSggMjAwMCwgMjAwMCwgMjAwMCApLCBhcHAud2ViQ2FtTWF0ZXJpYWwgKTtcblxuICAgICAgICAgICAgdmFyIHJvdGF0aW9uWCA9IFcucmFuZG9tQmV0d2VlbiggMC4wMDAyLCAwLjAwMDAyICk7XG4gICAgICAgICAgICB2YXIgcm90YXRpb25ZID0gVy5yYW5kb21CZXR3ZWVuKCAwLjAwMDIsIDAuMDAwMDIgKTtcbiAgICAgICAgICAgIHZhciByb3RhdGlvblogPSBXLnJhbmRvbUJldHdlZW4oIDAuMDAwMiwgMC4wMDAwMiApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBJZiB3ZSB3YW50IHRvIHJvdGF0ZSBpdFxuICAgICAgICAgICAgYWRkUHJlUmVuZGVyRm4oIGFwcCwgZnVuY3Rpb24gKCBkZWx0YU1TLCB0aW1lc3RhbXBNUyApIHtcbiAgICAgICAgICAgICAgICBhcHAud2ViQ2FtdkJveE1lc2gucm90YXRpb24ueCArPSAoIGRlbHRhTVMgKiByb3RhdGlvblggKTtcbiAgICAgICAgICAgICAgICBhcHAud2ViQ2FtdkJveE1lc2gucm90YXRpb24ueSArPSAoIGRlbHRhTVMgKiByb3RhdGlvblkgKTtcbiAgICAgICAgICAgICAgICBhcHAud2ViQ2FtdkJveE1lc2gucm90YXRpb24ueiArPSAoIGRlbHRhTVMgKiByb3RhdGlvblogKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG5cdCAgICBhcHAuc2NlbmUuYWRkKCBhcHAud2ViQ2FtdkJveE1lc2ggKTtcblxuICAgICAgICAgICAgLy8gU2hvdyBpdCBvbmx5IGZvciB0aGUgY3ViZSBjYW1cbiAgICAgICAgICAgIGFwcC5wcmVDdWJlQ2FtUmVuZGVyRm5zLnB1c2goIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBhcHAud2ViQ2FtdkJveE1lc2gudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgYXBwLnBvc3RDdWJlQ2FtUmVuZGVyRm5zLnB1c2goIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBhcHAud2ViQ2FtdkJveE1lc2gudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmVzb2x2ZSggYXBwICk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFdlYiBDYW0gSGVkcm9uIE1lc2hcbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgZnVuY3Rpb24gbWFrZVdlYkNhbUhlZHJvbk1lc2ggKCBhcHAgKSB7XG4gICAgICAgIHJldHVybiBXLnByb21pc2UoIGZ1bmN0aW9uICggcmVzb2x2ZSwgcmVqZWN0ICkge1xuXG4gICAgICAgICAgICAvLyBMb2FkZXJcbiAgICAgICAgICAgIC8vIC0tLS0tLVxuICAgICAgICAgICAgdmFyIGxvYWRlciA9IG5ldyBUSFJFRS5PQkpMb2FkZXIoKTtcbiAgICAgICAgICAgIGxvYWRlci5sb2FkKCAnL29iai9oZWRyb24ub2JqJywgb25PYmpMb2FkZWQgKTtcblxuICAgICAgICAgICAgLy8gU3dhcm0gQ3JlYXRpb25cbiAgICAgICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgIGZ1bmN0aW9uIG9uT2JqTG9hZGVkICggb2JqICkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCBvYmouY2hpbGRyZW5bIDAgXSApO1xuICAgICAgICAgICAgICAgIGFwcC53ZWJDYW1IZWRyb25NZXNoID0gb2JqLmNoaWxkcmVuWyAwIF0uY2xvbmUoKTsgLy9uZXcgVEhSRUUuTWVzaCggbmV3IFRIUkVFLkJveEdlb21ldHJ5KCAyMDAwLCAyMDAwLCAyMDAwICksIG1hdGVyaWFsICk7XG4gICAgICAgICAgICAgICAgYXBwLndlYkNhbUhlZHJvbk1lc2gubWF0ZXJpYWwgPSBhcHAud2ViQ2FtTWF0ZXJpYWw7XG4gICAgICAgICAgICAgICAgdmFyIHNjYWxlID0gMjgwMDtcbiAgICAgICAgICAgICAgICBhcHAud2ViQ2FtSGVkcm9uTWVzaC5zY2FsZS5zZXQoIHNjYWxlLCBzY2FsZSwgc2NhbGUgKTtcblxuICAgICAgICAgICAgICAgIHZhciByb3RhdGlvblggPSBXLnJhbmRvbUJldHdlZW4oIDAuMDAwMiwgMC4wMDAwMiApO1xuICAgICAgICAgICAgICAgIHZhciByb3RhdGlvblkgPSBXLnJhbmRvbUJldHdlZW4oIDAuMDAwMiwgMC4wMDAwMiApO1xuICAgICAgICAgICAgICAgIHZhciByb3RhdGlvblogPSBXLnJhbmRvbUJldHdlZW4oIDAuMDAwMiwgMC4wMDAwMiApO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIElmIHdlIHdhbnQgdG8gcm90YXRlIGl0XG4gICAgICAgICAgICAgICAgYWRkUHJlUmVuZGVyRm4oIGFwcCwgZnVuY3Rpb24gKCBkZWx0YU1TLCB0aW1lc3RhbXBNUyApIHtcbiAgICAgICAgICAgICAgICAgICAgYXBwLndlYkNhbUhlZHJvbk1lc2gucm90YXRpb24ueCArPSAoIGRlbHRhTVMgKiByb3RhdGlvblggKTtcbiAgICAgICAgICAgICAgICAgICAgYXBwLndlYkNhbUhlZHJvbk1lc2gucm90YXRpb24ueSArPSAoIGRlbHRhTVMgKiByb3RhdGlvblkgKTtcbiAgICAgICAgICAgICAgICAgICAgYXBwLndlYkNhbUhlZHJvbk1lc2gucm90YXRpb24ueiArPSAoIGRlbHRhTVMgKiByb3RhdGlvblogKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBcblx0ICAgICAgICBhcHAuc2NlbmUuYWRkKCBhcHAud2ViQ2FtSGVkcm9uTWVzaCApO1xuXG4gICAgICAgICAgICAgICAgLy8gU2hvdyBpdCBvbmx5IGZvciB0aGUgY3ViZSBjYW1cbiAgICAgICAgICAgICAgICBhcHAucHJlQ3ViZUNhbVJlbmRlckZucy5wdXNoKCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGFwcC53ZWJDYW1IZWRyb25NZXNoLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgYXBwLnBvc3RDdWJlQ2FtUmVuZGVyRm5zLnB1c2goIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgYXBwLndlYkNhbUhlZHJvbk1lc2gudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICByZXNvbHZlKCBhcHAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBMaWdodHNcbiAgICAvLyAtLS0tLS1cbiAgICBmdW5jdGlvbiBtYWtlTGlnaHRzICggYXBwICkge1xuICAgICAgICByZXR1cm4gVy5wcm9taXNlKCBmdW5jdGlvbiAoIHJlc29sdmUsIHJlamVjdCApIHtcbiAgICAgICAgICAgIGFwcC5zY2VuZS5hZGQoIG5ldyBUSFJFRS5BbWJpZW50TGlnaHQoIDB4MjIyMjIyICkgKTtcblxuICAgICAgICAgICAgdmFyIGRpcmVjdGlvbmFsTGlnaHQgPSBuZXcgVEhSRUUuRGlyZWN0aW9uYWxMaWdodCggMHhmZmZmZmYsIDIgKTtcblx0ICAgIGRpcmVjdGlvbmFsTGlnaHQucG9zaXRpb24uc2V0KCAyLCAxLjIsIDEwICkubm9ybWFsaXplKCk7XG5cdCAgICBhcHAuc2NlbmUuYWRkKCBkaXJlY3Rpb25hbExpZ2h0ICk7XG5cblx0ICAgIGRpcmVjdGlvbmFsTGlnaHQgPSBuZXcgVEhSRUUuRGlyZWN0aW9uYWxMaWdodCggMHhmZmZmZmYsIDEgKTtcblx0ICAgIGRpcmVjdGlvbmFsTGlnaHQucG9zaXRpb24uc2V0KCAtMiwgMS4yLCAtMTAgKS5ub3JtYWxpemUoKTtcblx0ICAgIGFwcC5zY2VuZS5hZGQoIGRpcmVjdGlvbmFsTGlnaHQgKTsgIFxuICAgICAgICAgICAgcmVzb2x2ZSggYXBwICk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFN3YXJtXG4gICAgLy8gLS0tLS1cbiAgICBmdW5jdGlvbiBtYWtlU3dhcm0gKCBhcHAgKSB7XG4gICAgICAgIHJldHVybiBXLnByb21pc2UoIGZ1bmN0aW9uICggcmVzb2x2ZSwgcmVqZWN0ICkge1xuICAgICAgICAgICAgXG4gICAgICAgICAgICB2YXIgcGFydGljbGVzID0gW107XG5cbiAgICAgICAgICAgIC8vIEFkZCB0byBTY2VuZVxuICAgICAgICAgICAgLy8gLS0tLS0tLS0tLS0tXG4gICAgICAgICAgICBhcHAuc3dhcm1PYmplY3QzRCA9IG5ldyBUSFJFRS5PYmplY3QzRCgpO1xuICAgICAgICAgICAgYXBwLnNjZW5lLmFkZCggYXBwLnN3YXJtT2JqZWN0M0QgKTtcbiAgICAgICAgICAgIGFwcC5wcmVDdWJlQ2FtUmVuZGVyRm5zLnB1c2goIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBhcHAuc3dhcm1PYmplY3QzRC52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGFwcC5wb3N0Q3ViZUNhbVJlbmRlckZucy5wdXNoKCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgYXBwLnN3YXJtT2JqZWN0M0QudmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gVXBkYXRpbmdcbiAgICAgICAgICAgIGFkZFByZVJlbmRlckZuKCBhcHAsIGZ1bmN0aW9uICggZGVsdGFNUywgdGltZXN0YW1wTVMgKSB7XG4gICAgICAgICAgICAgICAgcGFydGljbGVzLmZvckVhY2goIHBhcnRpY2xlID0+IHBhcnRpY2xlLnVwZGF0ZSggZGVsdGFNUywgdGltZXN0YW1wTVMgKSApO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIFBhcnRpY2xlIENsYXNzXG4gICAgICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLVxuICAgICAgICAgICAgZnVuY3Rpb24gUGFydGljbGUgKCBtZXNoICkge1xuXG4gICAgICAgICAgICAgICAgdGhpcy52ZWxvY2l0eSA9IFcucmFuZG9tQmV0d2VlbiggMC4yLCAxICk7XG5cbiAgICAgICAgICAgICAgICAvLyBNZXNoXG4gICAgICAgICAgICAgICAgdGhpcy5tZXNoID0gbWVzaC5jbG9uZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMubWVzaC5tYXRlcmlhbCA9IFBhcnRpY2xlLm1hdGVyaWFsLmNsb25lKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5tZXNoLnNjYWxlLnggPSBQYXJ0aWNsZS5pbml0aWFsU2NhbGU7XG4gICAgICAgICAgICAgICAgdGhpcy5tZXNoLnNjYWxlLnkgPSBQYXJ0aWNsZS5pbml0aWFsU2NhbGU7XG4gICAgICAgICAgICAgICAgdGhpcy5tZXNoLnNjYWxlLnogPSBQYXJ0aWNsZS5pbml0aWFsU2NhbGU7XG5cbiAgICAgICAgICAgICAgICAvLyBQb3NpdGlvblxuICAgICAgICAgICAgICAgIHZhciByYW5nZSA9IDEwMDtcbiAgICAgICAgICAgICAgICB0aGlzLm1lc2gucG9zaXRpb24uc2V0KCAoIE1hdGgucmFuZG9tKCkgLSAwLjUgKSAqIHJhbmdlLCAoIE1hdGgucmFuZG9tKCkgLSAwLjUgKSAqIHJhbmdlLCAoIE1hdGgucmFuZG9tKCkgLSAwLjUgKSAqIHJhbmdlICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHRoaXMuYW5jaG9yID0gbmV3IFRIUkVFLk9iamVjdDNEKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5hbmNob3IuYWRkKCB0aGlzLm1lc2ggKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gIyMjIFN0YXRpY1xuICAgICAgICAgICAgUGFydGljbGUubWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaFBob25nTWF0ZXJpYWwoIHtcblx0XHRjb2xvcjogMHhmZmZmZmYsXG5cdFx0c2hpbmluZXNzOiAwLjAsXG5cdFx0c3BlY3VsYXI6IDB4ZmZmZmZmLFxuXHRcdGVudk1hcDogYXBwLmN1YmVDYW1lcmEucmVuZGVyVGFyZ2V0LFxuICAgICAgICAgICAgICAgIHJlZmxlY3Rpdml0eTogMS4wLFxuICAgICAgICAgICAgICAgIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGVcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb25zb2xlLmxvZyggJ1NldCBtYXRlcmlhbCB0bycsIFBhcnRpY2xlLm1hdGVyaWFsICk7XG5cbiAgICAgICAgICAgIFBhcnRpY2xlLmluaXRpYWxTY2FsZSA9IDIwMDtcblxuICAgICAgICAgICAgLy8gIyMjIE1ldGhvZFxuICAgICAgICAgICAgUGFydGljbGUucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uICggZGVsdGFNUywgdGltZXN0YW1wTVMgKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hbmNob3Iucm90YXRpb24ueCArPSAwLjAwMjtcbiAgICAgICAgICAgICAgICB0aGlzLmFuY2hvci5yb3RhdGlvbi55ICs9IHRoaXMudmVsb2NpdHkgLyAxMDtcbiAgICAgICAgICAgICAgICB0aGlzLmFuY2hvci5yb3RhdGlvbi56ICs9IDAuMDAxO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLy8gTG9hZGVyXG4gICAgICAgICAgICAvLyAtLS0tLS1cbiAgICAgICAgICAgIHZhciBsb2FkZXIgPSBuZXcgVEhSRUUuT0JKTG9hZGVyKCk7XG4gICAgICAgICAgICBsb2FkZXIubG9hZCggJy9vYmovcGlsbG93LWJveC5vYmonLCBvbk9iakxvYWRlZCApO1xuXG4gICAgICAgICAgICAvLyBTd2FybSBDcmVhdGlvblxuICAgICAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAgICAgZnVuY3Rpb24gb25PYmpMb2FkZWQgKCBvYmogKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgbWVzaCA9IG9iai5jaGlsZHJlblsgMCBdO1xuXG4gICAgICAgICAgICAgICAgLy8gUGFydGljbGUgQ3JlYXRpb25cbiAgICAgICAgICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAgICAgICAgIC8vIEVhc2UgaW4gdGhlIGNyZWF0aW9uIG9mIHRoZSBwYXJ0aWNsZXNcbiAgICAgICAgICAgICAgICB2YXIgbWF4UGFydGljbGVzID0gMTAwO1xuICAgICAgICAgICAgICAgIHZhciBtaW5DcmVhdGlvblRpbWUgPSA1O1xuICAgICAgICAgICAgICAgIHZhciBtYXhDcmVhdGlvblRpbWVNUyA9IDEwMDtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAoZnVuY3Rpb24gY3JlYXRlTW9yZSAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICggcGFydGljbGVzLmxlbmd0aCA8IG1heFBhcnRpY2xlcyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXJ0aWNsZSA9IG5ldyBQYXJ0aWNsZSggbWVzaCApO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXBwLnN3YXJtT2JqZWN0M0QuYWRkKCBwYXJ0aWNsZS5hbmNob3IgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRpY2xlcy5wdXNoKCBwYXJ0aWNsZSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCggY3JlYXRlTW9yZSwgVy5tYXAoIHBhcnRpY2xlcy5sZW5ndGggLyBtYXhQYXJ0aWNsZXMsIDAsIDEsIG1heENyZWF0aW9uVGltZU1TLCBtaW5DcmVhdGlvblRpbWUsIFcuaW50ZXJwb2xhdGlvbnMuZWFzZUluICkgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0oKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHJlc29sdmUoIGFwcCApO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBSZW5kZXIgTG9vcFxuICAgIC8vIC0tLS0tLS0tLS0tXG4gICAgZnVuY3Rpb24gbWFrZVJlbmRlckxvb3AgKCBhcHAgKSB7XG4gICAgICAgIHJldHVybiBXLnByb21pc2UoIGZ1bmN0aW9uICggcmVzb2x2ZSwgcmVqZWN0ICkge1xuXG4gICAgICAgICAgICB2YXIgbGFzdFRpbWVzdGFtcE1TID0gMDtcbiAgICAgICAgICAgIHZhciBkZWx0YU1TID0gMDtcblxuICAgICAgICAgICAgKGZ1bmN0aW9uICBsb29wICggY3VycmVudFRpbWVzdGFtcE1TICkge1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIFJlY3VyXG4gICAgICAgICAgICAgICAgLy8gLS0tLS1cbiAgICAgICAgICAgICAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKCBsb29wICk7XG5cbiAgICAgICAgICAgICAgICAvLyBVcGRhdGUgdGltZXN0YW1wc1xuICAgICAgICAgICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAgICAgICAgIGRlbHRhTVMgPSBjdXJyZW50VGltZXN0YW1wTVMgLSBsYXN0VGltZXN0YW1wTVM7XG4gICAgICAgICAgICAgICAgbGFzdFRpbWVzdGFtcE1TID0gY3VycmVudFRpbWVzdGFtcE1TO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIEFjdGlvbmFibGVzXG4gICAgICAgICAgICAgICAgLy8gLS0tLS0tLS0tLS1cbiAgICAgICAgICAgICAgICBhcHAucHJlUmVuZGVyRm5zLmZvckVhY2goIGZuID0+IGZuKCBkZWx0YU1TLCBjdXJyZW50VGltZXN0YW1wTVMgKSApO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIFJlbmRlclxuICAgICAgICAgICAgICAgIC8vIC0tLS0tLVxuICAgICAgICAgICAgICAgIGFwcC5yZW5kZXJlci5jbGVhcigpO1xuXHRcdGFwcC5yZW5kZXJlci5yZW5kZXIoIGFwcC5zY2VuZSwgYXBwLmNhbWVyYSApO1xuXG4gICAgICAgICAgICB9KCBsYXN0VGltZXN0YW1wTVMgKSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHJlc29sdmUoIGFwcCApO1xuICAgICAgICB9KTtcblxuICAgIH1cblxuICAgIC8vIFV0aWxzXG4gICAgLy8gPT09PT1cblxuICAgIC8vIFJlbmRlciBMb29wXG4gICAgLy8gLS0tLS0tLS0tLS1cbiAgICBmdW5jdGlvbiBhZGRQcmVSZW5kZXJGbiAoIGFwcCwgZm4gKSB7XG4gICAgICAgIGFwcC5wcmVSZW5kZXJGbnMucHVzaCggZm4gKTtcbiAgICB9XG5cbiAgICAvLyBDYW1lcmFcbiAgICAvLyAtLS0tLS1cbiAgICBmdW5jdGlvbiBzZXRDYW1lcmFQb3NpdGlvbiAoIGFwcCwgeCwgeSwgeiApIHtcbiAgICAgICAgYXBwLmNhbWVyYS5wb3NpdGlvbi54ID0geDtcbiAgICAgICAgYXBwLmNhbWVyYS5wb3NpdGlvbi55ID0geTtcbiAgICAgICAgYXBwLmNhbWVyYS5wb3NpdGlvbi56ID0gejtcbiAgICB9XG4gXG4gICAgLy8gRXhwb3J0XG4gICAgLy8gPT09PT09ICAgIFxuICAgIHJldHVybiB7XG4gICAgICAgIG1ha2VBcHA6IG1ha2VBcHAsXG4gICAgICAgIGluaXRBcHA6IGluaXRBcHAgIFxuICAgIH07XG4gICAgXG59KCkpO1xuXG5cblxuXG5cblxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9